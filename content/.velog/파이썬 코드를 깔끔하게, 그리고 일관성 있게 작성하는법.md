---
title: '파이썬 코드를 깔끔하게, 그리고 일관성 있게 작성하는법'
date: '2021-11-29T23:56:34.516+09:00'
tags:
  - black
  - isort
  - python
  - vscode
  - '@all'
page: null
summary: black과 isort를 vscode에서 사용하자
---
스크립트를 작성하다보면 일관성있게 작성하기가 쉽지 않다.
```python
data = [
    (x, y)
    for x, y in zip(range(5), range(20, 24))
    if (x % 3 and y % 2) or (x % 5 and y % 7)
]
```
이렇게 작성하든
```python
data = [(x,y) for x,y in zip(range(5),range(20,24)) if (x%3 and y%2) or (x%5 and y%7)]
```
저렇게 작성하든 결국 결과는 같기 때문이다.

이는 특히 협업시 두드러지게 나타나고, 파이썬의 장점인 **실행할 수 있는 의사코드**라는 점이 많이 퇴색된다.

이러한 경우를 해결하기 위해, 그렇다면 **정해진 하나의 규칙으로, 전부 밀어버리면 되지 않냐**는 생각으로 만들어진 패키지가 있다. 바로 `black`이다.

## 코드를 일관성있게 만드는 black
***
설치도 사용도 간단하다. `pip install black`으로 설치가 가능하고, `python -m black {source_file_or_directory}`으로 실행이 가능하다.

**그런데 이것도 사실 꽤 귀찮다.** 스크립트를 수정하고 `black`을 계속 돌려줘야 하는데, 이걸 어떻게 다 기억하고 있을까.

그래서 많이 쓰이는 `vscode`에서는, 파이썬 스크립트를 저장할 때 자동으로 `black`이 적용되도록 하는 옵션이 따로 있다. 다음 값을 `settings.json`에 추가하면 된다.
```json
{
    "python.formatting.provider": "black",
    "editor.formatOnSave": true
}
```

이제 `vscode`에서 다음과 같은 코드를 작성하고
```python
def test1(a,  b):
    c=a+b
    return c

def test2(
    a,
    b
):
    c = (
        a*b
    )
    return c
```
저장을 하면 다음과 같이 변한다.
```python
def test1(a, b):
    c = a + b
    return c


def test2(a, b):
    c = a * b
    return c

```
`black`의 변환 규칙은 [여기](https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html)에서 확인 할 수 있다.

### 하지만 완벽하지는 않다.

하지만 `black`도 2% 부족한 부분이 있다. 각종 모듈을 import할 때, 해당 구문에 대한 정리가 단순히 88자 글자 제한을 넘기지 않는 정도에서 그치는 것이다.

만약 다음과 같은 import구문이 있다면
```python
from datetime import datetime
from anyio.abc import ObjectReceiveStream, ObjectSendStream
from random import uniform
from anyio import create_memory_object_stream, create_task_group, Semaphore, CapacityLimiter
```
`black`은 이렇게 까지만 수정된다.
```python
from datetime import datetime
from anyio.abc import ObjectReceiveStream, ObjectSendStream
from random import uniform
from anyio import (
    create_memory_object_stream,
    create_task_group,
    Semaphore,
    CapacityLimiter,
)
```
내가 import하는 모듈이 기본 라이브러리인지, 내가 따로 설치한 라이브러리인지, 로컬 패키지 인지 정리할 수 있다면 참 좋을텐데... 다행히 **그걸 위한 패키지가 있다.** 바로 `isort`다.

## import 구문도 빠짐없이 정리

`isort`의 readme 예시에 따르면, 다음과 같은 코드를
```python
from my_lib import Object

import os

from my_lib import Object3

from my_lib import Object2

import sys

from third_party import lib15, lib1, lib2, lib3, lib4, lib5, lib6, lib7, lib8, lib9, lib10, lib11, lib12, lib13, lib14

import sys

from __future__ import absolute_import

from third_party import lib3
```
다음과 같이 깔끔하게 정리해준다.
```python
from __future__ import absolute_import

import os
import sys

from third_party import (lib1, lib2, lib3, lib4, lib5, lib6, lib7, lib8,
                         lib9, lib10, lib11, lib12, lib13, lib14, lib15)

from my_lib import Object, Object2, Object3
```

정말 깔끔하게 변했다. 하지만 `from third_party import (...)`에서 확인할 수 있듯이, `black`의 규칙과 맞지 않는 부분이 있다. 다행히 최근 `isort`는 **`black`사용자를 위한 설정값을 따로 만들어놨다.**

나는 `vscode`에서 저장할 때 자동으로 적용되길 바라기 때문에, `settings.json`에 다음과 같은 값을 추가했다.
```json
{
    "python.sortImports.args": [
        "--profile",
        "black"
    ],
    "[python]": {
        "editor.codeActionsOnSave": {
            "source.organizeImports": true
        }
    }
}
```

이 설정값을 저장하고 나면, 이전 코드는 다음과 같이 변한다.
```python
from datetime import datetime
from random import uniform

from anyio import (
    CapacityLimiter,
    Semaphore,
    create_memory_object_stream,
    create_task_group,
)
from anyio.abc import ObjectReceiveStream, ObjectSendStream
```

## 결론
***
`vscode`에서 파이썬 코드를 깔끔하게 작성하고 싶다면, `black`과 `isort`를 이용하기 위해, `settings.json`에 다음 값을 추가하면 된다.
```json
{
    "python.formatting.provider": "black",
    "editor.formatOnSave": true,
    "python.sortImports.args": [
        "--profile",
        "black"
    ],
    "[python]": {
        "editor.codeActionsOnSave": {
            "source.organizeImports": true
        }
    }
}
```
