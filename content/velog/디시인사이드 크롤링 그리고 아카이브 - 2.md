---
title: '디시인사이드 크롤링 그리고 아카이브 - 2'
description: 'scrapy사용은 처음이니, 정직하게 튜토리얼을 참고해서, 첫 페이지를 읽어봅시다.scrapy는 잘 만들어진 프레임워크이기 때문에, django처럼 프로젝트를 생성해서 진행한다고 합니다.(이 명령은 이전의 다른 명령과 다르게, app/scripts에서 실행했습니다.)현'
date: 2022-01-06T13:32:03.126Z
tags: ['python', 'scrapy']
hide: true
---

scrapy사용은 처음이니, 정직하게 [튜토리얼](https://docs.scrapy.org/en/latest/intro/tutorial.html)을 참고해서, 첫 페이지를 읽어봅시다.
scrapy는 잘 만들어진 프레임워크이기 때문에, django처럼 프로젝트를 생성해서 진행한다고 합니다.

```console
scrapy startproject crawl
```

(이 명령은 이전의 다른 명령과 다르게, app/scripts에서 실행했습니다.)

현재 app/scripts/crawl의 디렉토리 구성은 다음과 같습니다.

```console
.
├── crawl
│   ├── __init__.py
│   ├── items.py
│   ├── middlewares.py
│   ├── pipelines.py
│   ├── settings.py
│   └── spiders
│       └── __init__.py
└── scrapy.cfg
```

크롤링 진행 대상은 [여기](https://gall.dcinside.com/mgallery/board/lists?id=githu)고,
여러가지 확인해보면
번호: tr.ub-content.us-post td.gall_num
일자: tr.ub-content.us-post td.gall_date::text
말머리: tr.ub-content.us-post td.gall_subject
제목, 댓글 수 관련: tr.ub-content.us-post td.gall_tit.ub-word
작성자: tr.ub-content.us-post td.gall_writer.ub-writer
으로 조회가 가능하다.

아직 글 내용까지 크롤링할 생각은 없으니,
글 목록을 정상적으로 가져올 수 있는지, 간단하게 작성해봅니다.

```python
# app/scripts/crawl/crawl/spiders.py
from datetime import datetime
from typing import Generator, Union

import scrapy as sc
from scrapy.http.response.html import HtmlResponse
from scrapy.selector import Selector, SelectorList


class git_spider(sc.Spider):
    name: str = "git"
    start_urls: list[str] = ["https://gall.dcinside.com/mgallery/board/lists?id=github"]

    def parse(
        self, response: HtmlResponse
    ) -> Generator[dict[str, Union[int, str, datetime]], None, None]:
        for title in response.css("tr.ub-content.us-post"):
            title: Selector

            try:
                _subject: Selector = title.css("td.gall_subject")[0]  # type: ignore
            except KeyError:
                continue
            _subject_text: Union[str, None] = _subject.css("td::text").get(None)

            if not _subject_text:
                continue

            _id: Union[str, None] = title.css("td.gall_num::text").get(None)
            _date: Union[str, None] = title.css("td.gall_date::text").get(None)

            if not _id or not _date:
                continue

            try:
                _date_object: datetime = datetime.strptime(_date, "%H:%M")
            except ValueError:
                _date_object = datetime.strptime(_date, "%y.%m.%d")
            else:
                today = datetime.today()
                _date_object = _date_object.replace(
                    year=today.year, month=today.month, day=today.day
                )

            _user_dict: dict[str, str] = title.css("td.gall_writer.ub-writer").attrib
            _user_name: str = _user_dict["data-nick"]
            _user_id_or_ip: str = _user_dict["data-uid"] or _user_dict["data-ip"]

            if not _user_name or not _user_id_or_ip:
                continue

            _title_sub_select: SelectorList = title.css("td.gall_tit.ub-word")  # type: ignore
            _title: Union[str, None] = _title_sub_select.css("a::text").get(None)
            _link: Union[str, None] = _title_sub_select.css("a::attr(href)").get(None)
            _reply_count: Union[str, None] = _title_sub_select.css("span::text").get(
                None
            )

            if not _title or not _link:
                continue
            _link = response.urljoin(_link)

            if not _reply_count:
                _reply_count = "0"
            _reply_count = _reply_count.strip("[]")

            yield dict(
                id=int(_id),
                date=_date_object,
                name=_user_name,
                idip=_user_id_or_ip,
                title=_title,
                reply=int(_reply_count),
                link=_link,
            )
```

vscode의 자동완성 기능을 활용하기 위해 타입힌트를 추가한 것 외에 특별하게 튜토리얼 밖의 내용을 사용한건 없습니다.

이제 api/scripts/crawl경로에서 다음과 같은 명령어를 실행하면

```console
scrapy crawl git -O test.json
```

다음과 같은 json을 얻게 됩니다.

```json
[
  {
    "id": 30579,
    "date": "2022-01-06 21:29:00",
    "name": "\u3147\u3147",
    "idip": "dclgr",
    "title": "\ub808\ud37c\ub7f0\uc2a4 \ucee4\ubba4\ub2c8\ud2f0 \ucc28\uc774\uac00 \ud63c\uc790 \uacf5\ubd80\ud558\ub294 \uc218\uc900\uc5d0\uc11c\ub294 \ubcc4 \uc0c1\uad00\uc5c6\uc5c8\ub294\ub370",
    "reply": 0,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30579&page=1"
  },
  {
    "id": 30578,
    "date": "2022-01-06 21:01:00",
    "name": "C++",
    "idip": "rustisbetterthancpp",
    "title": "Intellij \uc5b4\ub5a4 \uc0ac\uc57c \ud560\uae4c?",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30578&page=1"
  },
  {
    "id": 30577,
    "date": "2022-01-06 21:01:00",
    "name": "MetaFibonacci",
    "idip": "equivalence",
    "title": "\uc0c8\ud574 \uae30\ub150 \uc9112\uc758 \ubc18\ubcf5\ubb38 \uc5f0\uc2b5",
    "reply": 1,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30577&page=1"
  },
  {
    "id": 30576,
    "date": "2022-01-06 20:40:00",
    "name": "\u3147\u3147",
    "idip": "106.102",
    "title": "\uac74\uac15\uc0c1\uc758 \uc774\uc720\ub85c \ud1f4\uc0ac\ud558\uace0",
    "reply": 4,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30576&page=1"
  },
  {
    "id": 30575,
    "date": "2022-01-06 20:22:00",
    "name": "\uc6b0\ubb3c\uc548\uac1c\uad6c\ub9ac",
    "idip": "lastpenguin",
    "title": "\ub354\ub2dd\ud06c\ub8e8\uac70\ud604\uc0c1 \uc601\uc0c1\ubcf4\uc148",
    "reply": 1,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30575&page=1"
  },
  {
    "id": 30574,
    "date": "2022-01-06 19:57:00",
    "name": "\ub9b4\ubcf8\uaca7\uc774",
    "idip": "dtd0023",
    "title": "\uccab \ud574\ud53c\ud574\ud0b9 \uad6c\uc785\ud588\ub2e4",
    "reply": 4,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30574&page=1"
  },
  {
    "id": 30571,
    "date": "2022-01-06 19:41:00",
    "name": "\u3147\u3147",
    "idip": "59.30",
    "title": "${ }\ub97c \uc778\uc2dd\ubabb\ud558\ub294\ub370 \uc65c\uc774\ub7f4\uae4c\uc694 \uc120\uc0dd\ub2d8?",
    "reply": 9,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30571&page=1"
  },
  {
    "id": 30570,
    "date": "2022-01-06 19:39:00",
    "name": "\u3147\u3147",
    "idip": "116.121",
    "title": "KDE \ud658\uacbd\uc5d0 \uad1c\ucc2e\uc740 distro \ucd94\ucc9c\uc880",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30570&page=1"
  },
  {
    "id": 30569,
    "date": "2022-01-06 18:59:00",
    "name": "\u3147\u3147",
    "idip": "59.5",
    "title": "\uc6f9\uc740 \uc2e4\ub825\uc774 \uc88b\ub2e4\ub294 \uae30\uc900\uc774 \ubb50\ub0d0",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30569&page=1"
  },
  {
    "id": 30568,
    "date": "2022-01-06 18:55:00",
    "name": "\u3147\u3147",
    "idip": "61.24",
    "title": "\uc88b\uc740 \uae30\uc220\uc774 \ub3c8\uc774\ub418\ub294\uac8c \uc544\ub2c8\ub77c",
    "reply": 1,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30568&page=1"
  },
  {
    "id": 30567,
    "date": "2022-01-06 18:47:00",
    "name": "\u3147\u3147",
    "idip": "116.36",
    "title": "aws \ub8e8\ud2b8\ud0a4 \uc774\uc6a9\ud574\uc11c mfa\ub97c \uc9c0\uc6b8 \uc218 \uc788\ub098?",
    "reply": 2,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30567&page=1"
  },
  {
    "id": 30566,
    "date": "2022-01-06 18:46:00",
    "name": "\u3147\u3147",
    "idip": "106.101",
    "title": "\ud30c\uc774\uc36c\uc740 \ub290\ub9b0 \uc5b8\uc5b4\uc778\uac00",
    "reply": 6,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30566&page=1"
  },
  {
    "id": 30564,
    "date": "2022-01-06 18:01:00",
    "name": "\u3147\u3147",
    "idip": "wpgk3429",
    "title": "\uc800\uc7a5\ud560 \ub54c\ub9c8\ub2e4 cmd\uac00 \uae5c\ube61\uc774\ub294 \ubb38\uc81c",
    "reply": 2,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30564&page=1"
  },
  {
    "id": 30562,
    "date": "2022-01-06 17:57:00",
    "name": "\uc2a4\ub9c8\ud2b8\ud3f0\ud5e4\ube44\uc720\uc800",
    "idip": "galaxyowner4012",
    "title": "\uc544\uce58\ub294 Qt \uc571\uc5d0\uc11c kime\uc774 \uc548\ub428",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30562&page=1"
  },
  {
    "id": 30561,
    "date": "2022-01-06 17:50:00",
    "name": "\u3147\u3147",
    "idip": "183.102",
    "title": "\ub3c5\uc11c",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30561&page=1"
  },
  {
    "id": 30560,
    "date": "2022-01-06 17:45:00",
    "name": "\u3147\u3147",
    "idip": "183.102",
    "title": "\ub9c8\uc2a4\ucf54\ud2b8\ub294 \uc5ed\uc2dc \"GO\"\ub2e4",
    "reply": 2,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30560&page=1"
  },
  {
    "id": 30559,
    "date": "2022-01-06 17:44:00",
    "name": "\u3147\u3147",
    "idip": "121.166",
    "title": "\uc774\uc9c1\ud558\uba74 \uc5f0\ubd09\uc740 \uc804\uc9c1\uc7a5 \ub300\ube44 \ud37c\uc13c\ud2b8\ub85c \uc624\ub974\ub294\uac70\uc784?",
    "reply": 3,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30559&page=1"
  },
  {
    "id": 30558,
    "date": "2022-01-06 17:23:00",
    "name": "\u3147\u3147",
    "idip": "210.115",
    "title": "\uc2e4\ub9ac\ucf58\ub9e5\uc73c\ub85c \ud150\uc11c\ud50c\ub85c\uc6b0 \uc4f0\uc2dc\ub294\ubd84 \uc788\ub098\uc694?",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30558&page=1"
  },
  {
    "id": 30557,
    "date": "2022-01-06 17:23:00",
    "name": "\u3147\u3147",
    "idip": "106.101",
    "title": "\ub9ac\uc561\ud2b8 \uc2a4\ud1a0\uc5b4(\uc0c1\ud0dc\uad00\ub9ac) \uc5d0 \ub300\ud55c \uace0\ubbfc.(MobX)",
    "reply": 46,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30557&page=1"
  },
  {
    "id": 30556,
    "date": "2022-01-06 16:58:00",
    "name": "\u3147\u3147",
    "idip": "124.56",
    "title": "\ub7ec\ub9b0\uc774 iter\uad00\ub828 \uc9c8\ubb38\uc810;",
    "reply": 13,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30556&page=1"
  },
  {
    "id": 30555,
    "date": "2022-01-06 16:14:00",
    "name": "\u3147\u3147",
    "idip": "106.101",
    "title": "vscode spring boot (gradle) \ucf24 \ub54c\ub9c8\ub2e4 \uae68\uc9d0",
    "reply": 2,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30555&page=1"
  },
  {
    "id": 30554,
    "date": "2022-01-06 15:24:00",
    "name": "\u3147\u3147",
    "idip": "115.94",
    "title": "\ud29c\ub9c1\uba38\uc2e0 \uacf5\uc775",
    "reply": 9,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30554&page=1"
  },
  {
    "id": 30553,
    "date": "2022-01-06 15:21:00",
    "name": "\u3147\u3147",
    "idip": "175.211",
    "title": "\ud558\ub8e8\uc5d0 \uacf5\ubd80 \uc774\ub807\uac8c \ud558\uace0\uc788\ub294\ub370 \uc5b4\ub5b0?",
    "reply": 14,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30553&page=1"
  },
  {
    "id": 30552,
    "date": "2022-01-06 15:07:00",
    "name": "\u3137\u314d\u3145",
    "idip": "odri0220",
    "title": "Rust\uc5d0\uc11c runas\ub77c\ub294 \ud06c\ub808\uc774\ud2b8 \uc0ac\uc6a9\ud574\ubcf4\uc2e0\ubd84??",
    "reply": 0,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30552&page=1"
  },
  {
    "id": 30551,
    "date": "2022-01-06 15:00:00",
    "name": "\u3147\u3147\u3147",
    "idip": "211.186",
    "title": "\uc6f9\uc5d0\uc11c \uc790\ubc14\uc758 \uae30\uc220\uc801\uc778 \uc7a5\uc810\uc774 \uba38\uc784?",
    "reply": 6,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30551&page=1"
  },
  {
    "id": 30549,
    "date": "2022-01-06 14:23:00",
    "name": "\u3147\u3147",
    "idip": "223.39",
    "title": "VS\ub85c C++ \ucc98\uc74c \uc368\ubcf4\ub294\ub370 \uac10\ub3d9\uc774\ub2e4",
    "reply": 6,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30549&page=1"
  },
  {
    "id": 30548,
    "date": "2022-01-06 14:13:00",
    "name": "\u3147\u3147",
    "idip": "1.244",
    "title": "\uc790\ubc14 \ub9c8\uc2a4\ucf54\ud2b8",
    "reply": 7,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30548&page=1"
  },
  {
    "id": 30547,
    "date": "2022-01-06 13:46:00",
    "name": "\u3147\u3147",
    "idip": "183.102",
    "title": "\uc544\uce58 \uc124\uce58\ud558\uae30 \uc26c\uc6cc\uc84c\ub124",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30547&page=1"
  },
  {
    "id": 30546,
    "date": "2022-01-06 13:45:00",
    "name": "Sayori",
    "idip": "arwen02",
    "title": "\ucf54\ud2c0\ub9b0 \ub9c8\uc2a4\ucf54\ud2b8\uac00 \ub098\uc624\ub294 \uac8c\uc784",
    "reply": 0,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30546&page=1"
  },
  {
    "id": 30545,
    "date": "2022-01-06 13:43:00",
    "name": "\u3147\u3147",
    "idip": "1.244",
    "title": "\ucf54\ud2c0\ub9b0 \ub9c8\uc2a4\ucf54\ud2b8 \uacf5\uac1c",
    "reply": 13,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30545&page=1"
  },
  {
    "id": 30544,
    "date": "2022-01-06 13:34:00",
    "name": "facade",
    "idip": "facadefacade",
    "title": "\uc131\ub2a5\uc744 \uc704\ud574\uc11c \ud558\ub4dc\ub514\uc2a4\ud06c \ud5e4\ub4dc \uc6c0\uc9c1\uc784\uae4c\uc9c0 \uace0\ub824 \u3137\u3137",
    "reply": 3,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30544&page=1"
  },
  {
    "id": 30543,
    "date": "2022-01-06 13:16:00",
    "name": "\u3147\u3147",
    "idip": "106.244",
    "title": "\ud3f4\ub354 \uc774\ub984 \ubc14\uafb8\uae30 \uad00\ub828 \uc9c8\ubb38\uc774 \uc788\ub2e4",
    "reply": 0,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30543&page=1"
  },
  {
    "id": 30542,
    "date": "2022-01-06 13:12:00",
    "name": "\u3147\u3147",
    "idip": "124.56",
    "title": "\ub7ec\uc2a4\ud2b8 &str \uc9c8\ubb38\uc810",
    "reply": 7,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30542&page=1"
  },
  {
    "id": 30541,
    "date": "2022-01-06 12:40:00",
    "name": "\u3147\u3147",
    "idip": "118.235",
    "title": "\uc911\uad6d\uc815\ub3c4\ub418\uba74 \ud2b8\ub798\ud53d \uc5b4\ub5bb\uac8c \ucc98\ub9ac\ud560\uae4c",
    "reply": 10,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30541&page=1"
  },
  {
    "id": 30540,
    "date": "2022-01-06 12:34:00",
    "name": "\u3147\u3147",
    "idip": "220.94",
    "title": "\uc528\ubc1c 4\uc6d4\ubd80\ud130 \uc804\uba74\ucd9c\uadfc\uc774\ub178",
    "reply": 2,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30540&page=1"
  },
  {
    "id": 30539,
    "date": "2022-01-06 12:21:00",
    "name": "\u3147\u3147",
    "idip": "223.39",
    "title": "\ubb34\uc9c0\uc131\uc73c\ub85c \uc5bc\uad74 \ucca0\ud310\uae54\uace0 \ub3c8\ubc8c\uac70\uba74",
    "reply": 4,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30539&page=1"
  },
  {
    "id": 30538,
    "date": "2022-01-06 12:15:00",
    "name": "\u3147\u3147",
    "idip": "223.38",
    "title": "golang \ub2e8\uc810 \ub9d0\ud574\ubd04",
    "reply": 6,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30538&page=1"
  },
  {
    "id": 30537,
    "date": "2022-01-06 12:15:00",
    "name": "\uc2a4\ub9c8\ud2b8\ud3f0\ud5e4\ube44\uc720\uc800",
    "idip": "galaxyowner4012",
    "title": "\ub370\ube44\uc548 \ud14c\uc2a4\ud305 DVD \uc774\ubbf8\uc9c0\uc640 netinst \uc774\ubbf8\uc9c0 \ubc1b\ub294\ubc95",
    "reply": 0,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30537&page=1"
  },
  {
    "id": 30536,
    "date": "2022-01-06 12:11:00",
    "name": "\u3141\u3134\u3147",
    "idip": "218.155",
    "title": "\uc791\uc740 \ubaa8\ubc14\uc77c \uac8c\uc784 \ud558\ub098 \ub9cc\ub4e4\ub824\uace0 \ud558\uac70\ub4e0..",
    "reply": 4,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30536&page=1"
  },
  {
    "id": 30535,
    "date": "2022-01-06 12:11:00",
    "name": "\u3147\u3147",
    "idip": "121.141",
    "title": "\uc2a4\ud504\ub9c1/\uc778\ud154\ub9ac\uc81c\uc774 \uc9c8\ubb38\ub3c4 \ubc1b\ub098\uc694",
    "reply": 5,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30535&page=1"
  },
  {
    "id": 30534,
    "date": "2022-01-06 12:07:00",
    "name": "\u3147\u3147",
    "idip": "223.38",
    "title": "ChangeFlow \uc4f0\ub294 \uc0ac\ub78c \uc788\uc74c?",
    "reply": 0,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30534&page=1"
  },
  {
    "id": 30533,
    "date": "2022-01-06 12:01:00",
    "name": "\u3147\u3147",
    "idip": "125.251",
    "title": "emacs\ub294 \uc65c \uac80\uc0c9\ub7c9 \uc6b4\uc9c0\ud568?",
    "reply": 7,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30533&page=1"
  },
  {
    "id": 30532,
    "date": "2022-01-06 12:00:00",
    "name": "\u3147\u3147",
    "idip": "39.7",
    "title": "\ub300\uccb4 \uc548\ub4dcios\ub9cc\uc774 \uac00\ub2a5\ud55c \ub124\uc774\ud2f0\ube0c \uae30\ub2a5\uc774 \ubb54\ub370??",
    "reply": 2,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30532&page=1"
  },
  {
    "id": 30531,
    "date": "2022-01-06 11:54:00",
    "name": "\u3147\u3147",
    "idip": "yoyo5809",
    "title": "\ud3f0\uc73c\ub85c \uc54c\ub9ac\ubbf8 \uac19\uc740\uac70 \ub9cc\ub4e4\uace0 \uc2f6\uc744\ub54c \uc5b4\uca54\uae4c?",
    "reply": 0,
    "link": "https://gall.dcinside.com/mgallery/board/view/?id=github&no=30531&page=1"
  }
]
```

그런데 전 json이 필요한게 아니고
db에서 관리할 예정이기 때문에 이걸 좀 수정하거나
scrapy에 쓸만한 다른 기능이 있는지 확인하겠습니다.

약간 읽어보니 item pipeline이 있는데, 이 기능을 쓰면 될거 같습니다.

갑자기 문명이 땡겨서 오늘은 여기까지
