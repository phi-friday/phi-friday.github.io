<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="author" content="phi.friday@gmail.com, phi"/><meta name="robots" content="index,follow,noarchive"/><meta name="google-site-verification" content="lW107Dj5ageygd67UUzTm-kGls5d-THy9jJQZqLoauw"/><title>phi.log</title><link href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" rel="stylesheet"/><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/e61452b80f7f8356.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e61452b80f7f8356.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c0b66b64eb886a29.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c0b66b64eb886a29.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-5752944655d749a0.js" defer=""></script><script src="/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/_next/static/chunks/main-5dc3bdee87ff18dd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f6271bdec05edb1f.js" defer=""></script><script src="/_next/static/chunks/996-f3cf67c2e3ac5e06.js" defer=""></script><script src="/_next/static/chunks/756-1349105dbea71525.js" defer=""></script><script src="/_next/static/chunks/224-ddba219ecdd5c904.js" defer=""></script><script src="/_next/static/chunks/pages/posts/@tag/%5B...tag%5D-5364b6481a3135f4.js" defer=""></script><script src="/_next/static/MQ_lMVQgBI0RkmUA6wvVT/_buildManifest.js" defer=""></script><script src="/_next/static/MQ_lMVQgBI0RkmUA6wvVT/_ssgManifest.js" defer=""></script><script src="/_next/static/MQ_lMVQgBI0RkmUA6wvVT/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><style>
      #nprogress {
        pointer-events: none;
      }
      #nprogress .bar {
        background: #29D;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
      }
      #nprogress .peg {
        display: block;
        position: absolute;
        right: 0px;
        width: 100px;
        height: 100%;
        box-shadow: 0 0 10px #29D, 0 0 5px #29D;
        opacity: 1;
        -webkit-transform: rotate(3deg) translate(0px, -4px);
        -ms-transform: rotate(3deg) translate(0px, -4px);
        transform: rotate(3deg) translate(0px, -4px);
      }
      #nprogress .spinner {
        display: block;
        position: fixed;
        z-index: 1031;
        top: 15px;
        right: 15px;
      }
      #nprogress .spinner-icon {
        width: 18px;
        height: 18px;
        box-sizing: border-box;
        border: solid 2px transparent;
        border-top-color: #29D;
        border-left-color: #29D;
        border-radius: 50%;
        -webkit-animation: nprogresss-spinner 400ms linear infinite;
        animation: nprogress-spinner 400ms linear infinite;
      }
      .nprogress-custom-parent {
        overflow: hidden;
        position: relative;
      }
      .nprogress-custom-parent #nprogress .spinner,
      .nprogress-custom-parent #nprogress .bar {
        position: absolute;
      }
      @-webkit-keyframes nprogress-spinner {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes nprogress-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style><div class="container" style="max-width:900px;min-width:400px"><div class="container default_app"><header><div class="container"><nav class="navbar-light fixed-top navbar navbar-expand-sm bg-light" role="navigation"><div class="container" style="max-width:900px"><div class="container-fluid"><ul class="navbar-nav w-100"><li class="nav-item"><a data-test="nav-link" class="nav-link" href="/"><div class="text-nowrap nav_text__4OEN1"><i class="fa fa-home"></i> Home</div></a></li><li class="nav-item"><a data-test="nav-link" class="nav-link" href="/posts/@tag"><div class="text-nowrap nav_text__4OEN1"><i class="fa fa-hashtag"></i> Post</div></a></li><li class="nav-item"><a data-test="nav-link" class="nav-link" href="/posts/@page"><div class="text-nowrap nav_text__4OEN1"><i class="fa fa-blog"></i> Page</div></a></li><div class="container d-flex justify-content-end align-self-center"><div class="row"><div class="col"><form class="input-group w-auto" method="get" action="https://www.google.com/search" target="_blank" style="min-width:230px"><input type="hidden" name="sitesearch" value="phi-friday.github.io"/><input type="search" class="form-control" placeholder="Search in Google" aria-label="Search" name="q" maxLength="255"/><button class="ripple ripple-surface btn btn-outline-primary" role="button"><i class="fa fa-search"></i></button></form></div></div></div></ul></div></div></nav></div></header><main><div class="container"><div class="row"><div><span><span class="badge bg-light mx-1 text-dark">@all<!-- --> <span class="badge bg-danger">25</span></span></span><span><span class="badge bg-primary mx-1">#python<!-- --> <span class="badge bg-danger">21</span></span></span><span><span class="badge bg-light mx-1 text-dark">#fastapi<!-- --> <span class="badge bg-danger">14</span></span></span><span><span class="badge bg-light mx-1 text-dark">#sqlmodel<!-- --> <span class="badge bg-danger">8</span></span></span><span><span class="badge bg-light mx-1 text-dark">#fastapi-users<!-- --> <span class="badge bg-danger">4</span></span></span><span><span class="badge bg-light mx-1 text-dark">#crud<!-- --> <span class="badge bg-danger">4</span></span></span><span><span class="badge bg-light mx-1 text-dark">#returns<!-- --> <span class="badge bg-danger">3</span></span></span><span><span class="badge bg-light mx-1 text-dark">#í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°<!-- --> <span class="badge bg-danger">3</span></span></span><span><span class="badge bg-light mx-1 text-dark">#windows<!-- --> <span class="badge bg-danger">3</span></span></span><span><span class="badge bg-light mx-1 text-dark">#wsl<!-- --> <span class="badge bg-danger">3</span></span></span><span><span class="badge bg-light mx-1 text-dark">#tdd<!-- --> <span class="badge bg-danger">2</span></span></span><span><span class="badge bg-light mx-1 text-dark">#anyio<!-- --> <span class="badge bg-danger">2</span></span></span><span><span class="badge bg-light mx-1 text-dark">#async<!-- --> <span class="badge bg-danger">2</span></span></span><span><span class="badge bg-light mx-1 text-dark">#vim<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#js<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#ts<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#nextjs<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#velog<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#github<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#restful<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#pytest<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#alembic<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#postgres<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#black<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#isort<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#vscode<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#asyncio<!-- --> <span class="badge bg-danger">1</span></span></span><span><span class="badge bg-light mx-1 text-dark">#trio<!-- --> <span class="badge bg-danger">1</span></span></span></div></div><div class="row"><div class="container"><div class="card border border-1 shadow-3 my-3 hover-shadow"><div class="card-header"><div><span><span class="badge bg-primary mx-1">#python<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#returns<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°<!-- --> </span></span></div></div><div class="card-body"><h5 class="card-title">returnsë¡œ íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ì 2 - ROP</h5><p class="card-subtitle"><p class="card-text text-muted"><h6><time dateTime="2022-09-13T22:22:07.993+09:00">ì‘ì„±ì¼: 2022ë…„ 9ì›” 13ì¼</time></h6></p></p><p class="card-text">íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ë©´ vscodeê°€ ì°©í•´ì§„ë‹¤</p></div></div><div class="card border border-1 shadow-3 my-3 hover-shadow"><div class="card-header"><div><span><span class="badge bg-primary mx-1">#python<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#returns<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°<!-- --> </span></span></div></div><div class="card-body"><h5 class="card-title">returnsë¡œ íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ì 1 - ì£¼ìš” ê¸°ëŠ¥ë“¤</h5><p class="card-subtitle"><p class="card-text text-muted"><h6><time dateTime="2022-09-09T23:18:43.310+09:00">ì‘ì„±ì¼: 2022ë…„ 9ì›” 9ì¼</time></h6></p></p><p class="card-text">íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ë©´ vscodeê°€ ì°©í•´ì§„ë‹¤</p></div></div><div class="card border border-1 shadow-3 my-3 hover-shadow"><div class="card-header"><div><span><span class="badge bg-primary mx-1">#python<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#returns<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°<!-- --> </span></span></div></div><div class="card-body"><h5 class="card-title">returnsë¡œ íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ì 0</h5><p class="card-subtitle"><p class="card-text text-muted"><h6><time dateTime="2022-09-09T02:10:44.645+09:00">ì‘ì„±ì¼: 2022ë…„ 9ì›” 9ì¼</time></h6></p></p><p class="card-text">íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ë©´ vscodeê°€ ì°©í•´ì§„ë‹¤</p></div></div><div class="card border border-1 shadow-3 my-3 hover-shadow"><div class="card-header"><div><span><span class="badge bg-light mx-1 text-dark">#fastapi<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#fastapi-users<!-- --> </span></span><span><span class="badge bg-primary mx-1">#python<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#sqlmodel<!-- --> </span></span></div></div><div class="card-body"><h5 class="card-title">fastapi íŠœí† ë¦¬ì–¼ -8.2- FastAPI Users v10 ëŒ€ì‘</h5><p class="card-subtitle"><p class="card-text text-muted"><h6><time dateTime="2022-05-07T23:00:58.369+09:00">ì‘ì„±ì¼: 2022ë…„ 5ì›” 7ì¼</time></h6></p></p><p class="card-text">fastapi ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ê³µë¶€í• ê²¸, ì°¸ê³ í• ë§Œí•œ ì¢‹ì€ ì˜ˆì œê°€ ìˆì–´ì„œ ì´ ì‹œë¦¬ì¦ˆë¥¼ ì•½ê°„ì˜ ë³€ê²½ì„ ì£¼ê³  ë”°ë¼ê°€ë³´ë ¤ í•œë‹¤.</p></div></div><div class="card border border-1 shadow-3 my-3 hover-shadow"><div class="card-header"><div><span><span class="badge bg-light mx-1 text-dark">#fastapi<!-- --> </span></span><span><span class="badge bg-primary mx-1">#python<!-- --> </span></span><span><span class="badge bg-light mx-1 text-dark">#sqlmodel<!-- --> </span></span></div></div><div class="card-body"><h5 class="card-title">fastapi íŠœí† ë¦¬ì–¼ -8.1- SQLModel AsyncSession ê´€ë ¨ íƒ€ì… ë¬¸ì œ ì„ì‹œ í•´ê²° + ì¶”ê°€ ìˆ˜ì •</h5><p class="card-subtitle"><p class="card-text text-muted"><h6><time dateTime="2022-05-07T22:08:12.781+09:00">ì‘ì„±ì¼: 2022ë…„ 5ì›” 7ì¼</time></h6></p></p><p class="card-text">fastapi ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ê³µë¶€í• ê²¸, ì°¸ê³ í• ë§Œí•œ ì¢‹ì€ ì˜ˆì œê°€ ìˆì–´ì„œ ì´ ì‹œë¦¬ì¦ˆë¥¼ ì•½ê°„ì˜ ë³€ê²½ì„ ì£¼ê³  ë”°ë¼ê°€ë³´ë ¤ í•œë‹¤.</p></div></div></div></div><div class="row"><ul class="pagination justify-content-center"><li class="page-item disabled"><a class="page-link" href="/posts/@tag/python/1"><i class="fa fa-angle-double-left"></i></a></li><li class="page-item disabled"><a class="page-link" href="/posts/@tag/python/0"><i class="fa fa-angle-left"></i></a></li><li class="page-item active"><a class="page-link">1</a></li><li class="page-item" href="/posts/@tag/python/2"><a class="page-link">2</a></li><li class="page-item" href="/posts/@tag/python/3"><a class="page-link">3</a></li><li class="page-item" href="/posts/@tag/python/4"><a class="page-link">4</a></li><li class="page-item" href="/posts/@tag/python/5"><a class="page-link">5</a></li><li class="page-item disabled"><a class="page-link" href="/posts/@tag/python/6"><i class="fa fa-angle-right"></i></a></li><li class="page-item"><a class="page-link" href="/posts/@tag/python/5"><i class="fa fa-angle-double-right"></i></a></li></ul></div></div></main><footer class="text-center text-muted"></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tag":"python","page":1,"max_page":5,"tag_counter":[["@all",25],["python",21],["fastapi",14],["sqlmodel",8],["fastapi-users",4],["crud",4],["returns",3],["í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°",3],["windows",3],["wsl",3],["tdd",2],["anyio",2],["async",2],["vim",1],["js",1],["ts",1],["nextjs",1],["velog",1],["github",1],["restful",1],["pytest",1],["alembic",1],["postgres",1],["black",1],["isort",1],["vscode",1],["asyncio",1],["trio",1]],"posts":[{"name":"returns2","content":"\n# `ROP`\n## `ROP`ì— ëŒ€í•œ ê°„ëµí•œ ì„¤ëª…\n\u003e ì˜¤ê°œë…ì´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë‹ˆ, ë”°ë¡œ ë” ê²€ìƒ‰í•´ì„œ ì•Œì•„ë³´ê¸°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.\n\n`ROP`ëŠ” __Railway oriented programming__ ì˜ ì•½ì–´ë¡œ, ì§ì—­í•˜ë©´ __ì² ë„ ì§€í–¥ í”„ë¡œê·¸ë˜ë°__ ì´ë‹¤. ì´ë¦„ ê·¸ëŒ€ë¡œ `input`ê³¼ `output`ë¥¼ ì ì ˆí•œ ì² ë„(í•¨ìˆ˜)ë¡œ ì´ì–´ì¤€ë‹¤.\n\nì „í†µì ì¸ ë°©ì‹ì—ì„œëŠ”, ê° ì² ë„(í•¨ìˆ˜)ë§ˆë‹¤ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ ì‹¤ì‹œí•˜ì—¬ ì—ëŸ¬ì— ëŒ€ì‘í•˜ì§€ë§Œ, í”„ë¡œê·¸ë¨ì˜ ê·œëª¨ê°€ ì»¤ì§ˆìˆ˜ë¡ ìœ ì§€ë³´ìˆ˜ì— ì–´ë ¤ì›€ì´ ë°œìƒí•œë‹¤.\n\nì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ê° ì² ë„(í•¨ìˆ˜)ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ëŠ” í”„ë¡œê·¸ë¨ì˜ ì˜¤ì‘ë™ì„ ìœ ë°œí•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì í•©í•œ `output`ìœ¼ë¡œ ê°„ì£¼í•˜ë©°, ë‹¤ìŒ ì² ë„(í•¨ìˆ˜)ì—ì„œ `input`ìœ¼ë¡œ í™œìš©í•œë‹¤.\n\nì¦‰, ê° ì² ë„(í•¨ìˆ˜)ì˜ `input`ê³¼ `output`ì€ ê°œë°œìê°€ ì˜ë„í•œ ì •ìƒì ì¸ ê°’ê³¼ ì˜ë„í•˜ì§€ ì•Šì€ ë¹„ì •ìƒì ì¸ ê°’(ì—ëŸ¬)ìœ¼ë¡œ êµ¬ë¶„ëœë‹¤.\n\nì´ë ‡ê²Œ ì‘ì„±ëœ í”„ë¡œê·¸ë¨ì€ ê° ì² ë„(í•¨ìˆ˜)ë³„ ì˜ˆì™¸ì²˜ë¦¬ê°€ ì—†ë”ë¼ë„, ê° ì² ë„(í•¨ìˆ˜)ë³„ `output`ì˜ ìƒíƒœë¥¼ êµ¬ë¶„ì§€ì„ ìˆ˜ ìˆê³ , `output`ì€ ë‹¨ ë‘ê°€ì§€ë¡œ êµ¬ë¶„ë˜ë¯€ë¡œ, ë‹¤ìŒ ì² ë„(í•¨ìˆ˜)ì˜ `input`ìœ¼ë¡œ í™œìš©í•˜ëŠ”ë° ìˆì–´ì„œ ê¹”ë”í•œ ì¡°ì‘ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤. \n\n\u003e ìœ„ ê¸€ì„ í¬í•¨í•œ ì´ì „ í¬ìŠ¤íŠ¸ê¹Œì§€ __ì •ìƒ__ ìƒíƒœì™€ __ë¹„ì •ìƒ__ ìƒíƒœë¡œ êµ¬ë¶„ì§€ì–´ í‘œí˜„í•˜ì˜€ìœ¼ë‚˜, `returns`ì˜ `container`ì™€ ìš©ì–´ë¥¼ ì¼ì¹˜í•˜ê¸° ìœ„í•´, ì´í›„ ê¸€ ë¶€í„°ëŠ” __ì„±ê³µ__ ê³¼ __ì‹¤íŒ¨__ ë¡œ ëŒ€ì‹ í•©ë‹ˆë‹¤.\n\n## `returns`ê°€ ì œì‹œí•˜ëŠ” `ROP`\n`returns`ì—ì„œ ë¯¸ë¦¬ ì •ì˜ëœ `container`ëŠ” `alt`, `map`, `lash`, `bind` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í•¨ìˆ˜(ì² ë„)ë¥¼ ì‡ê²Œ í•œë‹¤.\n\n* `alt`: __ì‹¤íŒ¨__ ë¥¼ ì‚¬ìš©í•˜ì—¬, __ì‹¤íŒ¨__ ë¡œ ì‡ëŠ”ë‹¤.\n* `map`: __ì„±ê³µ__ ì„ ì‚¬ìš©í•˜ì—¬, __ì„±ê³µ__ ìœ¼ë¡œ ì‡ëŠ”ë‹¤. \n* `lash`: __ì‹¤íŒ¨__ ë¥¼ ì‚¬ìš©í•˜ì—¬, __ì„±ê³µ__ ë˜ëŠ” __ì‹¤íŒ¨__ ë¡œ ì‡ëŠ”ë‹¤.\n* `bind`: __ì„±ê³µ__ ì„ ì‚¬ìš©í•˜ì—¬, __ì„±ê³µ__ ë˜ëŠ” __ì‹¤íŒ¨__ ë¡œ ì‡ëŠ”ë‹¤.\n\në‹¤ë§Œ ëª¨ë“  `container`ê°€ ìœ„ì™€ ê°™ì€ ë©”ì†Œë“œë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. `returns.interfaces` ëª¨ë“ˆì—ëŠ” ì´ëŸ¬í•œ ë©”ì†Œë“œì— ëŒ€í•œ ì¸í„°í˜ì´ìŠ¤ê°€ ì •ì˜ë˜ì–´ ìˆê³ , í•´ë‹¹í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œì¡±í•˜ëŠ” `container`ê°€ ìœ„ì™€ ê°™ì€ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\n\n\u003e `map`ê³¼ `bind`ì— ëŒ€í•œ ê°„ëµí•œ ì„¤ëª…ê³¼ ì˜ˆì œëŠ” ì´ì „ í¬ìŠ¤íŠ¸ì— í¬í•¨ë˜ì–´ ìˆê³ , `alt`ì™€ `lash`ëŠ” `input`ì˜ ìƒíƒœì—ë§Œ ì°¨ì´ê°€ ìˆìœ¼ë¯€ë¡œ ìƒëµí•œë‹¤.\n\n# `container`ì—ì„œ ì‹¤ì œ ê°’ì„ ì¶”ì¶œí•˜ëŠ” ë°©ë²•\n```python\nfrom returns.maybe import Maybe\nfrom returns.primitives.exceptions import UnwrapFailedError\nfrom returns.result import ResultE\n\nassert ResultE.from_value(1).unwrap() == 1\ntry:\n    result = ResultE.from_failure(1).unwrap()\nexcept Exception as exc:\n    result = exc\nassert isinstance(result, UnwrapFailedError)\nassert ResultE.from_value(1).value_or(2) == 1\nassert ResultE.from_failure(1).value_or(2) == 2\n\nassert Maybe.from_optional(1).unwrap() == 1\ntry:\n    result = Maybe.from_optional(None).unwrap()\nexcept Exception as exc:\n    result = exc\nassert isinstance(result, UnwrapFailedError)\nassert Maybe.from_optional(1).value_or(2) == 1\nassert Maybe.from_optional(None).value_or(2) == 2\nassert Maybe.from_optional(1).or_else_call(lambda: 2) == 1\nassert Maybe.from_optional(None).or_else_call(lambda: 2) == 2\n```\n`Container`ë¡œ ê°ì‹¸ì§„ ë‚´ë¶€ì˜ ê°’ì„ ì¶”ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” `unwrap` ë˜ëŠ” `value_or` ë˜ëŠ” 'or_else_call` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.\n\n* `unwrap` ë©”ì†Œë“œëŠ” __ì„±ê³µ__ ì¼ ë•Œë§Œ ì •ìƒì ìœ¼ë¡œ ì¶”ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.\n\n* `value_or`ëŠ” __ì‹¤íŒ¨__ ì¼ ë•Œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ê²Œ ë§Œë“ ë‹¤.\n\n* `or_else_call`ëŠ” __ì‹¤íŒ¨__ ì¼ ë•Œ ë°˜í™˜í•  ê°’ì„ ì§€ì—°ì‹œí‚¬ ìˆ˜ ìˆë‹¤.\n\u003e `or_else_call` ë©”ì†Œë“œëŠ” `Maybe`ì—ëŠ” ìˆê³  `Result`ì—ëŠ” ì—†ë‹¤. `Result`ì—ì„œëŠ” `alt`ê°€ ìˆê¸° ë•Œë¬¸ì´ë‹¤.\n\u003e\n\u003e ë˜í•œ `unwrap`ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°ë„ ìˆë‹¤. `IO`ê°€ ëŒ€í‘œì ì´ë‹¤.\n\n# ì›ë¬¸\n[Railway oriented programming](https://returns.readthedocs.io/en/latest/pages/railway.html)","mtime":"2022-09-13T22:23:54.967+09:00","href":"python/returns2","data":{"title":"returnsë¡œ íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ì 2 - ROP","tags":["python","returns","í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°","@all"],"page":"dry-python/returns","summary":"íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ë©´ vscodeê°€ ì°©í•´ì§„ë‹¤","date":"2022-09-13T22:22:07.993+09:00"}},{"name":"returns1","content":"\n# `returns`ì˜ ì£¼ìš” ê¸°ëŠ¥ë“¤\n\n`returns`ëŠ” íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ë©´ì„œ ìƒì„±í•˜ëŠ” ê°’ì„ `Container`ë¡œ ê°ì‹¸ê³ , ì´ ê°’ì„ ê°œë°œìê°€ ì£¼ë„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ìœ ë„í•œë‹¤.\n\nê¸°ë³¸ì ìœ¼ë¡œ ì™„ì„±ëœ í˜•íƒœë¡œ ì œê³µë˜ëŠ” `Container`ëŠ” `Maybe`, `Result`, `IO`, `Future`, `RequiresContext`ê°€ ìˆê³ , ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš° ì‚¬ìš©ëœë‹¤.\n\n* `Maybe`: `None` ì¼ ìˆ˜ ìˆëŠ” ê°’\n* `Result`: ì—ëŸ¬ê°€ ë°œìƒ í•  ìˆ˜ ìˆëŠ” ê°’\n* `IO`: `IO` ì‘ì—…ê³¼ ê´€ë ¨ëœ ê°’\n* `Future`: ë¹„ë™ê¸° ì‘ì—…ê³¼ ê´€ë ¨ëœ ê°’\n* `RequiresContext`: í•¨ìˆ˜ì˜ ì˜ì¡´ì„±ê³¼ ê´€ë ¨ëœ ê°’\n\n\u003e `IOResult`, `RequiresContextFutureResult` ë“± ê²°í•©ëœ í˜•íƒœë¡œ ì œê³µí•˜ê¸°ë„ í•œë‹¤. ë¬¼ë¡  ê°œë°œìê°€ ì§ì ‘ ìƒˆë¡œìš´ `Container`ë¥¼ ì •ì˜í•  ìˆ˜ë„ ìˆë‹¤.\n\nì´ëŸ¬í•œ `Container`ë“¤ì€ `map`, `alt`, `bind`, `lash` ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ì—¬ ìµœì¢… ê²°ê³¼ë¬¼ë¡œ ì•ˆì „í•˜ê²Œ ë„ë‹¬í•˜ê³ , ê°œë°œìëŠ” ê·¸ `Container`ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ , ê·¸ ê°’ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.\n\n## `Container`ì˜ ë‚´ë¶€ ê°’ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” `map`\nì„¤ëª…ë³´ë‹¤ëŠ” ì½”ë“œë¥¼ ì§ì ‘ í™•ì¸í•˜ëŠ”ê²Œ ë” ë¹ ë¥´ë‹¤.\n```python\nfrom returns.maybe import Maybe, Nothing, Some\nfrom returns.result import Failure, ResultE, Success\n\n\ndef div_3(value: float) -\u003e float:\n    return value / 3\n\n\ndummy_exc = Exception(\"error\")\nsuccess_value: ResultE[int] = ResultE.from_value(1)\nmaybe_value: Maybe[int] = Maybe.from_optional(1)\nfailure_value: ResultE[int] = ResultE.from_failure(dummy_exc)\nmaybe_non_value: Maybe[int] = Maybe.from_optional(None)\n\nassert success_value == Success(1)\nassert failure_value == Failure(dummy_exc)\nassert maybe_value == Some(1)\nassert maybe_non_value == Nothing\n\nsuccess_result = success_value.map(div_3)\nfailure_result = failure_value.map(div_3)\nmaybe_result = maybe_value.map(div_3)\nmaybe_non_result = maybe_non_value.map(div_3)\n\nassert success_result == Success(div_3(1))\nassert failure_result is failure_value\nassert maybe_result == Some(div_3(1))\nassert maybe_non_result is Nothing\n\nassert success_result.unwrap() == div_3(1)\nassert failure_result.failure() is dummy_exc\nassert maybe_result.value_or(None) == div_3(1)\nassert maybe_non_result.value_or(\"test\") == \"test\"\n```\n`Container`ì˜ ë‚´ë¶€ ê°’ì„ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë¥¼ `map`ë©”ì†Œë“œì˜ ì¸ìˆ˜ë¡œ ì „ë‹¬í•˜ë©´, ê·¸ `Container`ì˜ ìƒíƒœê°€ ì •ìƒì¼ ë•Œë§Œ ì‘ë™í•˜ê³ , ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ì•„ë¬´ ì¼ë„ í•˜ì§€ ì•ŠëŠ”ë‹¤.\n\nì¦‰, `map`ì€ ì •ìƒì ì¸ ìƒíƒœì¸ `Container`ì˜ ê°’ë§Œ ë³€í™”ì‹œí‚¤ëŠ” ë©”ì†Œë“œë‹¤.\n\n`map`ì— ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ìˆœìˆ˜í•¨ìˆ˜ë¥¼ ê°€ì •í•˜ê³  ì‚¬ìš©ë˜ê¸°ì—, í•¨ìˆ˜ ì‹¤í–‰ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•˜ë”ë¼ë„ `Result` ê°ì²´ë¡œ ê°ì‹¸ì§€ì§€ ì•Šê³  ì‘ë™ì„ ë©ˆì¶œ ê²ƒì´ë‹¤.\n\nê·¸ë ‡ë‹¤ë©´ ë¹„ì •ìƒ ìƒíƒœì˜ `Container` ë‚´ë¶€ì˜ ê°’ì„ ë³€í™”ì‹œí‚¤ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? ê·¸ë•ŒëŠ” `alt` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.\n\n## `Container`ì˜ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ëŠ” `bind`\n```python\nfrom returns.maybe import Maybe, Nothing, Some, maybe\nfrom returns.result import Failure, ResultE, Success, safe\n\n\ndef div_3_v1(value: int) -\u003e ResultE[float]:\n    try:\n        return Success(3 / value)\n    except Exception as exc:\n        return Failure(exc)\n\n\n@safe\ndef div_3_v2(value: int) -\u003e float:\n    return 3 / value\n\n\ndef div_3_v3(value: int) -\u003e Maybe[float]:\n    try:\n        return Some(3 / value)\n    except:\n        return Nothing\n\n\n@maybe\ndef div_3_v4(value: int) -\u003e float | None:\n    return 3 / value\n\n\ndummy_exc = Exception(\"error\")\nsuccess_value: ResultE[int] = ResultE.from_value(0)\nmaybe_value: Maybe[int] = Maybe.from_optional(1)\nfailure_value: ResultE[int] = ResultE.from_failure(dummy_exc)\nmaybe_non_value: Maybe[int] = Maybe.from_optional(None)\n\nassert success_value == Success(0)\nassert failure_value == Failure(dummy_exc)\nassert maybe_value == Some(1)\nassert maybe_non_value == Nothing\n\nsuccess_result = success_value.bind(div_3_v1)\nfailure_result = failure_value.bind(div_3_v2)\nmaybe_result = maybe_value.bind(div_3_v3)\nmaybe_non_result = maybe_non_value.bind(div_3_v4)\n\nassert str(success_result) == \"\u003cFailure: division by zero\u003e\"\nassert failure_result is failure_value\nassert maybe_result == div_3_v4(1)\nassert maybe_non_result is Nothing\n\nassert repr(success_result.failure()) == \"ZeroDivisionError('division by zero')\"\nassert failure_result.failure() is dummy_exc\nassert maybe_result.value_or(None) == 3\nassert maybe_non_result.value_or(\"test\") == \"test\"\n```\n`bind`ëŠ” `Container`ì˜ ê°’ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ `Container`ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤. ê·¸ í•¨ìˆ˜ê°€ ì–´ë–»ê²Œ ì •ì˜ëëŠ”ê°€ì— ë”°ë¼ ì •ìƒ ìƒíƒœì˜ `Container`ë¥¼ ë°˜í™˜í•  ìˆ˜ë„ ìˆê³ , ë¹„ì •ìƒ ìƒíƒœì˜ `Container`ë¥¼ ë°˜í™˜í•  ìˆ˜ë„ ìˆë‹¤.\n\nì¦‰, `bind`ëŠ” ì •ìƒì ì¸ ìƒíƒœì¸ Containerì˜ ê°’ê³¼ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ë©”ì†Œë“œë‹¤.\n\nì´ëŸ¬í•œ í•¨ìˆ˜ë¥¼ `div_3_v1`ì´ë‚˜ `div_3_v3`ì²˜ëŸ¼ ì¼ì¼ì´ ì •ì˜í•˜ëŠ” ê²ƒì€ ì†ì´ ë§ì´ ê°€ëŠ” ì‘ì—…ì´ë¯€ë¡œ, ê°€ëŠ¥í•˜ë‹¤ë©´ `div_3_v2`ì´ë‚˜ `div_3_v4`ì²˜ëŸ¼ `safe`ë‚˜ `maybe`ì™€ ê°™ì€ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥í•œë‹¤.\n\n`map`ê³¼ `alt`ì²˜ëŸ¼ `bind`ì—ë„ ëŒ€ì‘í•˜ëŠ” ë©”ì†Œë“œê°€ ìˆëŠ”ë°, ë°”ë¡œ `lash`ë‹¤. `lash`ëŠ” ë¹„ì •ìƒ ìƒíƒœì˜ ì»¨í…Œì´ë„ˆë¥¼ ì •ìƒ ìƒíƒœì˜ ì»¨í…Œì´ë„ˆë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤. ë¬¼ë¡  ë¹„ì •ìƒ ìƒíƒœë¥¼ ìœ ì§€í•  ìˆ˜ë„ ìˆë‹¤.\n\n## ì—¬ëŸ¬ê°œì˜ `Container`ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ë°©ë²•\n\n`Container` ê°ê°ì— ëŒ€í•´ `map`, `bind` ë“±ì„ ì‚¬ìš©í•˜ì—¬ ê°’ê³¼ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì€ ì•Œê² ì§€ë§Œ, ë‘ê°œ ì´ìƒì˜ `Container`ë¥¼ ë³µí•©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?\n\nì—¬ëŸ¬ ë°©ë²•ì´ ìˆê² ì§€ë§Œ, ê·¸ ì¤‘ ì„¸ê°€ì§€ë§Œ ì•Œì•„ë³´ì.\n\u003e `returns`ëŠ” `mypy`ë¥¼ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•˜ê¸°ì—, `pylance`ì—ì„œëŠ” ì •ìƒì ìœ¼ë¡œ íƒ€ì…ì¶”ë¡ ì´ ë˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìˆë‹¤.\n\u003e\n\u003e ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ë¬¸ì œê°€ ì—†ì—ˆëŠ”ë°, í›„ìˆ í•  `curry`ê°€ ê·¸ëŸ¬í–ˆë‹¤.\n### ê°œë³„ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•\n```python\nfrom returns.curry import curry, partial\nfrom returns.io import IO\n\n\ndef sum_v1(left: float, right: float) -\u003e float:\n    return left + right\n\n\nsum_v2 = curry(sum_v1)\n\nleft: IO[float] = IO(1.0)\nright: IO[float] = IO(2.0)\n\nassert right.apply(left.apply(IO(sum_v2))) == IO(3.0) # pylanceì—ì„œ ë¬¸ì œ ë°œìƒ\nassert right.apply(left.apply(IO(lambda x: partial(sum_v1, x)))) == IO(3.0)\nassert right.apply(left.apply(IO(lambda x: lambda y: sum_v1(x, y)))) == IO(3.0)\nassert sum_v2(1.0)(2.0) == 3 # pylanceì—ì„œ ë¬¸ì œ ë°œìƒ\n```\n\n`returns`ì—ì„œ ì œê³µí•˜ëŠ” `curry`ë¥¼ ì‚¬ìš©í•˜ë©´, ì—¬ëŸ¬ê°œì˜ ì¸ìë¥¼ í•„ìš”ë¡œ í•˜ëŠ” í•¨ìˆ˜ì— ì¸ìë¥¼ ì „ë‹¬í•  ë•Œ, í•œë²ˆì— ëª¨ë‘ ì „ë‹¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ë¬¼ë¡  `lambda`ì™€ `partial`ì„ ì‚¬ìš©í•´ì„œ ì§ì ‘ êµ¬í˜„í•´ë„ ë¬¸ì œ ì—†ë‹¤.\n\nì—¬ê¸°ì„œ ì‚¬ìš©ë˜ëŠ” `partial`ì€ `functools`ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤. ì°¨ì´ê°€ ìˆë‹¤ë©´ `returns`ì˜ `partial`ì€ ì¢€ ë” íƒ€ì…ì¶”ë¡ ì„ ë˜‘ë˜‘í•˜ê²Œ í•´ì¤€ë‹¤.\n\n\u003e ì„±ëŠ¥ì€ `lambda`ë¡œ ì§ì ‘ êµ¬í˜„í•˜ëŠ”ê²Œ ë” ë‚«ë‹¤ê³  í•œë‹¤..\n### `Iterable`ë¡œ ë¬¶ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•\n```python\nfrom typing import Callable\n\nfrom returns.curry import partial\nfrom returns.io import IO\nfrom returns.iterables import Fold\n\n\ndef sum_v1(left: float, right: float) -\u003e float:\n    return left + right\n\n\ndef sum_v2(value: float) -\u003e Callable[[float], float]:\n    return partial(sum_v1, value)\n\n\ndef get_one() -\u003e IO[float]:\n    return IO(1)\n\n\nassert Fold.loop([get_one() for _ in range(10)], IO(5), sum_v2) == IO(10 + 5)\nassert Fold.loop([get_one() for _ in range(5)], IO(7), sum_v2) == IO(5 + 7)\n```\n`Fold.loop`ëŠ” `Iterable`ë¡œ ë¬¶ì—¬ì§„ `Container`ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ìœ ìš©í•œ í´ë˜ìŠ¤ë©”ì†Œë“œë‹¤. ë‚´ë¶€ ì•Œê³ ë¦¬ì¦˜ì€ ë‹¨ìˆœí•˜ë©°, ë‹¤ìŒê³¼ ê°™ë‹¤.\n\u003e 1. `Iterable[Container[T]]`ì—ì„œ `Container[T]` í•˜ë‚˜ë¥¼ ì„ íƒí•œë‹¤.\n\u003e \n\u003e 2. ì„ íƒí•œ `Container[T]`ë¡œ `Callable[[R], R]` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. (`T`ê°€ ì•„ë‹ˆë‹¤!)\n\u003e\n\u003e 3. ì´ˆê¸°ê°’ìœ¼ë¡œ ì§€ì •ëœ `Container[R]`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ì´ˆê¸°ê°’ `Container[R]`ì„ ìƒì„±í•œë‹¤.\n\u003e\n\u003e 4. ë°˜ë³µ\n\n### ì—¬ëŸ¬ê°œë¡œ ë‚˜ëˆ ì§„ `Container`ë¥¼ í•˜ë‚˜ë¡œ í•©ì¹˜ëŠ” ë°©ë²•\n```python\nfrom returns.converters import maybe_to_result\nfrom returns.iterables import Fold\nfrom returns.maybe import Maybe, Nothing, Some, maybe\nfrom returns.result import Failure, Result, Success\n\ninit_data = dict(zip(list(\"abc\"), range(3)))\n\n\n@maybe\ndef get(key: str) -\u003e int | None:\n    return init_data.get(key)\n\n\nvalues_abc: list[Maybe[int]] = [get(key) for key in \"abc\"]\nvalues_abcd: list[Maybe[int]] = [get(key) for key in \"abcd\"]\nresult_abc: list[Result[int, None]] = [maybe_to_result(x) for x in values_abc]\nresult_abcd: list[Result[int, None]] = [maybe_to_result(x) for x in values_abcd]\n\nassert Fold.collect(values_abc, Some(())) == Some((0, 1, 2))\nassert Fold.collect(result_abc, Success(())) == Success((0, 1, 2))\nassert Fold.collect(values_abc, Some((100,))) == Some((100, 0, 1, 2))\nassert Fold.collect(result_abc, Success((200,))) == Success((200, 0, 1, 2))\n\nassert Fold.collect(values_abcd, Some(())) is Nothing\nassert Fold.collect(result_abcd, Success(())) == Failure(None)\n\nassert Fold.collect_all(values_abcd, Some(())) == Some((0, 1, 2))\nassert Fold.collect_all(result_abcd, Success(())) == Success((0, 1, 2))\nassert Fold.collect_all(values_abcd, Some((10, 20))) == Some((10, 20, 0, 1, 2))\nassert Fold.collect_all(result_abcd, Success((10, 20))) == Success((10, 20, 0, 1, 2))\n```\n\n`Fold.collect`ë¥¼ ì‚¬ìš©í•˜ë©´, ëª¨ë“  `Container`ê°€ ì •ìƒì¸ ê²½ìš°ì— ëŒ€í•´ì„œë§Œ ìˆ˜ì§‘ì„ ì§„í–‰í•˜ê³ ,\n\n`Fold.collect_all`ë¥¼ ì‚¬ìš©í•˜ë©´, ë¹„ì •ìƒ ìƒíƒœì˜ `Container`ë¥¼ ì œì™¸í•˜ê³  ìˆ˜ì§‘ì„ ì§„í–‰í•œë‹¤.\n\n# ì›ë¬¸\n[Container: the concept](https://returns.readthedocs.io/en/latest/pages/container.html)\n","mtime":"2022-09-13T20:54:28.507+09:00","href":"python/returns1","data":{"title":"returnsë¡œ íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ì 1 - ì£¼ìš” ê¸°ëŠ¥ë“¤","tags":["python","returns","í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°","@all"],"page":"dry-python/returns","summary":"íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ë©´ vscodeê°€ ì°©í•´ì§„ë‹¤","date":"2022-09-09T23:18:43.310+09:00"}},{"name":"returns0","content":"\n# 2% ë¶€ì¡±í•œ `python`ì˜ `type-hint`\n`python`ì—ì„œ `type-hint` ì§€ì›ì´ ì ì  ê°•ë ¥í•´ì§€ê³ , ì´ë¥¼ ë°˜ì˜í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ëŠ˜ì–´ë‚˜ë‹¤ ë³´ë‹ˆ, ë‚˜ë„ `type-hint`ë¥¼ ì ìš©í•´ê°€ë©° ê°œë°œì„ í•˜ê³  ìˆë‹¤.\n\ní•˜ì§€ë§Œ ì•„ì§ ëª‡ëª‡ ì•„ì‰¬ìš´ ë¶€ë¶„ì´ ë³´ì´ëŠ”ë°,\n\níŠ¹ì • í´ë˜ìŠ¤ ë©”ì†Œë“œì˜ ë¦¬í„´ê°’ì„ ê·¸ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë‚˜íƒ€ë‚´ë ¤ í•  ë•Œ, `TypeVar`ë¥¼ ì‚¬ìš©í•´ì„œ `bound`ë¥¼ ì¼ì¼ì´ ì§€ì •í•´ì¤˜ì„œ ë‚˜íƒ€ë‚´ì•¼ í•œë‹¤ë˜ê°€..\n\u003e ì´ì „ì—ëŠ” `TypeVar`ë¥¼ ì‚¬ìš©í•´ì•¼ í–ˆì§€ë§Œ, ì´ì œëŠ” PEP 673ì´ ë°˜ì˜ëœ `typing_extensions`ì˜ `Self`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.\n\u003e\n\u003e í•˜ì§€ë§Œ ì•„ì§ ë§ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ `Self`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì§€ëŠ” ì•Šë‹¤.(ì´ë¯¸ `TypeVar`ë¡œ ë§ì€ ë¶€ë¶„ì´ ì‘ì„±ë˜ì–´ ìˆìœ¼ë¯€ë¡œ)\n\në‚˜ì¤‘ì— ì •ì˜ë  í´ë˜ìŠ¤ë¥¼ `type-hint`ë¡œ ì‚¬ìš©í•˜ë ¤ë©´ ë¬¸ìì—´ë¡œ í‘œí˜„í•´ì•¼ í•œë‹¤ë˜ê°€..\n\u003e 3.11ì—ì„œ ìˆ˜ì •ë  ì˜ˆì •ì´ê³ , `__future__` ì—ì„œ `annotation` ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ë©´ ë¯¸ë¦¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\n\n`TypeVar`ë¡œ ì •ì˜ëœ ê°’ì„ ì´ìš©í•´ì„œ ìƒìœ„ ì œë„¤ë¦­ì„ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤ë˜ê°€..\n```python\nfrom typing import TypeVar, Generic\n\n_T = TypeVar(\"_T\")\n_Test = TypeVar(\"_Test\", bound=\"Test\")\n\nclass Test(Generic[_T]):\n    def __init__(self, data: _T):\n        self.data = data\n\ndef test(value: _T[int]) -\u003e _T[int]:\n    ...\n# TypeError: 'TypeVar' object is not subscriptable\n```\n\nì“°ë‹¤ë³´ë‹ˆ ë­”ê°€ ëŒ€ë¶€ë¶„ `TypeVar` ê´€ë ¨ì¸ë°, ì´ ì¤‘ì—ì„œ `TypeVar`ë¥¼ ì‚¬ìš©í•œ ìƒìœ„ ì œë„¤ë¦­ê³¼ ê´€ë ¨í•´ì„œ ì¢€ ë” ì•Œì•„ë´¤ë”ë‹ˆ, ì œí•œì ìœ¼ë¡œë‚˜ë§ˆ ì´ë¥¼ í•´ê²°í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆì—ˆëŠ”ë°, ê·¸ê²Œ ë°”ë¡œ [returns](https://github.com/dry-python/returns)ë‹¤.\n\n\u003e ì•ì„œ ìƒìœ„ ì œë„¤ë¦­ì´ë¼ í‘œí˜„í•œ ê²ƒì€, ì¼ë°˜ì ìœ¼ë¡œ __Higher Kinded Type__ ì´ë¼ê³  í•˜ëŠ” ê²ƒ ê°™ë‹¤.\n\n# í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì— ì í•©í•œ `returns`\në¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„ì´ ë²”ìš©ì ìœ¼ë¡œ ì“°ì´ëŠ” `return`ê³¼ ë„ˆë¬´ ìœ ì‚¬í•´ì„œ, ì œëŒ€ë¡œ ê²€ìƒ‰ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. ë§ˆì¹˜ êµ¬ê¸€ì˜ `go`ë¥¼ ë³´ëŠ” ë“¯ í•˜ë‹¤..\n\në‹¤í–‰íˆ `returns` ìì²´ [ë¬¸ì„œ](https://returns.readthedocs.io/en/latest/index.html)ê°€ ì•„ì£¼ ì˜ ë§Œë“¤ì–´ì ¸ ìˆì–´ì„œ, ì´í•´í•˜ëŠ”ë° í° ë¬¸ì œëŠ” ì—†ì—ˆë‹¤.\n\në˜í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ëŠ¥ì´ ê°„ë‹¨í•˜ë©´ì„œë„ ê°•ë ¥í•´ì„œ, `type-hint` ì™¸ì—ë„ ì“¸ë°ê°€ ë§ì•„ë³´ì¸ë‹¤. íŠ¹íˆ, í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì„ í•˜ê³ ì í•œë‹¤ë©´ ê½¤ ìœ ìš©í•˜ì§€ ì•Šì„ê¹Œ, ì‹¶ì—ˆëŠ”ë° `readme`ì—ì„œ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì„ ìœ„í•´ ë§Œë“¤ì–´ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ê³  ì§ì ‘ ì†Œê°œí•˜ê³  ìˆë‹¤.\n\u003e _Brings functional programming to Python land_\n\nì²˜ìŒì—ëŠ” ë‹¨ìˆœíˆ __Higher Kinded Type__ ë¥¼ ìœ„í•´ ì•Œì•„ë´¤ëŠ”ë°, ì´ì œëŠ” ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë©´ ì˜ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œ ê³ ë¯¼í•˜ê²Œ ëë‹¤.\n\n`returns`ì˜ ëŒ€í‘œì ì¸ ê¸°ëŠ¥ ë‘ê°€ì§€ë§Œ ë¯¸ë¦¬ ì†Œê°œí•˜ìë©´,\n\n## `Optional`ì„ ëŒ€ì‹  í•  `Maybe`\n\n```python\nfrom returns.maybe import Maybe, maybe\n\n\n@maybe\ndef one_or_none(value: int) -\u003e int | None:\n    if value == 1:\n        return value\n    return None\n\n\nmaybe_one0: Maybe[int] = one_or_none(1)\nmaybe_one1: Maybe[int] = one_or_none(2)\n# or\n# maybe_one0: Maybe[int] = Maybe.from_optional(1)\n# maybe_one1: Maybe[int] = Maybe.from_optional(None)\n\nmaybe_str0 = maybe_one0.bind_optional(str)\nmaybe_str1 = maybe_one1.bind_optional(str)\n\nassert maybe_str0.value_or(\"error\") == \"1\"\nassert maybe_str1.value_or(\"error\") == \"error\"\n```\nì›ë˜ë¼ë©´ `if`ë¬¸ì„ ì‚¬ìš©í•´ì„œ `None` íƒ€ì… í™•ì¸ì„ í•˜ê³  ì§„í–‰í–ˆê² ì§€ë§Œ,\n\n`Maybe`ëŠ” ë§ˆì¹˜ `js`ì˜ `some_object?.some_attr`ê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì „ê°œí•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.\n\n\n## `try`, `except`ë¥¼ ëŒ€ì‹ í•  `Result`\n```python\nfrom returns.converters import result_to_maybe\nfrom returns.result import Result, safe\n\n\n@safe\ndef div(left: float, right: float) -\u003e float:\n    # if right == 0:\n    # raise ZeroDivisionError\n    return left / right\n\n\nresult0: Result[float, Exception] = div(2, 3)\n# or\n# result0: Result[float, ZeroDivisionError]\n# or\n# from returns.result import ResultE\n# result0: ResultE[float] = div(2, 3)\nresult1: Result[float, Exception] = div(4, 0)\n\nassert (\n    result_to_maybe(result0.map(lambda x: x**2).alt(str)).value_or(\"error\")\n) == 4 / 9\n\nassert (\n    result_to_maybe(result1.map(lambda x: x**2).alt(str)).value_or(\"error\")\n) == \"error\"\n```\n\nì—ëŸ¬ì— ëŒ€í•´ ë¯¸ë¦¬ ê³ ë¯¼ í•  í•„ìš” ì—†ì´, ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” `map`, `bind`, `alt`, `lash` ë“±ì˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.\n\nì˜¬ë°”ë¥¸ íƒ€ì…ì´ ì•„ë‹ˆë¼ë©´ ì‘ë™í•˜ì§€ ì•Šê³ , ì¶”ê°€ì ì¸ ì—ëŸ¬ë„ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.\n\nìœ„ ì˜ˆì‹œì—ì„œëŠ” ë¬¸ìì—´ `error`ë¥¼ í‘œì‹œí–ˆì§€ë§Œ, ì›í•œë‹¤ë©´ ê·¸ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ë„ ìˆë‹¤.\n\n# ì•ìœ¼ë¡œ\nì‹œê°„ì´ ë  ë•Œ, `returns`ì˜ ê³µì‹ ë¬¸ì„œë¥¼ ë‚˜ë¦„ëŒ€ë¡œ ì •ë¦¬í•´ì„œ í¬ìŠ¤íŒ…ì„ í•˜ê³ ì í•œë‹¤. í•˜ì§€ë§Œ ì´ê²ƒë„ ë‹¤ë¥¸ ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ í•˜ë‹¤ê°€ ì¤‘ë‹¨ë  ìˆ˜ ìˆë‹¤..\n","mtime":"2022-09-13T20:54:24.447+09:00","href":"python/returns0","data":{"title":"returnsë¡œ íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ì 0","tags":["python","returns","í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°","@all"],"page":"dry-python/returns","summary":"íŒŒì´ì¬ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ë§Œë“¤ë©´ vscodeê°€ ì°©í•´ì§„ë‹¤","date":"2022-09-09T02:10:44.645+09:00"}},{"name":"fastapi íŠœí† ë¦¬ì–¼ -8.2- FastAPI Users v10 ëŒ€ì‘","content":"\n**`fastapi`** ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ê³µë¶€í• ê²¸, ì°¸ê³ í• ë§Œí•œ ì¢‹ì€ [ì˜ˆì œ](https://www.jeffastor.com/blog/populating-cleaning-jobs-with-user-offers-in-fastapi)ê°€ ìˆì–´ì„œ ì´ ì‹œë¦¬ì¦ˆë¥¼ ì•½ê°„ì˜ ë³€ê²½ì„ ì£¼ê³  ë”°ë¼ê°€ë³´ë ¤ í•œë‹¤.\nì§€ë‚œë²ˆì²˜ëŸ¼ ì–´ì©Œë‹¤ ê·¸ë§Œë‘˜ ìˆ˜ë„ ìˆê¸´ í•˜ì§€ë§Œ...\n\n---\n\n## `Breaking` `changes`\n\nì´í‹€ì „ **`fastapi-users`** ì— í° ë³€í™”ê°€ ìƒê²¼ë‹¤. `v10` ë¦´ë¦¬ì¦ˆê°€ ê³µê°œëëŠ”ë°, `db` ëª¨ë¸ê³¼ ì—¬ëŸ¬ ì œë„¤ë¦­ íƒ€ì…ì— ëŒ€í•œ ë³€í™”ê°€ ìƒê²¨ì„œ, `v10`ì„ ì´ìš©í•˜ë ¤ë©´ ëŒ€ì‘ íŒ¨ì¹˜ê°€ í•„ìˆ˜ì ì¸ ìƒí™©..\n\nì•„ë˜ëŠ” í•´ë‹¹ ë¦´ë¦¬ì¦ˆì— ëŒ€í•œ ì „ë¬¸ì´ë‹¤.\n\n\u003e ### [Breaking changes](https://github.com/fastapi-users/fastapi-users/releases/tag/v10.0.0)\n\u003e\n\u003e Version 10 marks important changes in how we manage User models and their ID.\n\u003e\n\u003e Before, we were relying only on Pydantic models to work with users. In particular the current_user dependency would return you an instance of UserDB, a Pydantic model. This proved to be quite problematic with some ORM if you ever needed to retrieve relationship data or make specific requests.\n\u003e\n\u003e Now, FastAPI Users is designed to always return you a native object for your ORM model, whether it's an SQLAlchemy model or a Beanie document. Pydantic models are now only used for validation and serialization inside the API.\n\u003e\n\u003e Before, we were forcing the use of UUID as primary key ID; a consequence of the design above. This proved to be quite problematic on some databases, like MongoDB which uses a special ObjectID format by default. Some SQL folks also prefer to use traditional auto-increment integers.\n\u003e\n\u003e Now, FastAPI Users is designed to use generic ID type. It means that you can use any type you want for your user's ID. By default, SQLAlchemy adapter still use UUID; but you can quite easily switch to another thing, like an integer. Beanie adapter for MongoDB will use native ObjectID by default, but it also can be overriden.\n\n### ìœ ì € ëª¨ë¸ ìƒì„± ë° ìˆ˜ì •\n\nê¸°ì¡´ `fastapi_users.models` ì—ì„œ `fastapi_users.schemas`ë¡œ ë°”ë€ ê²ƒ ì™¸ì— í¬ê²Œ ë‹¬ë¼ì§„ ê²ƒì€ ì—†ë‹¤. ì‚¬ì‹¤ ì´ì „ì— ì–˜ê¸°í–ˆë˜ `user` ì™€ `user_model`ì„ í†µí•©í•˜ëŠ” ì‘ì—…ì„ ì´ë¯¸ í•œ ë‹¤ìŒ `v10` ë¦´ë¦¬ì¦ˆë¥¼ í™•ì¸í–ˆê¸°ì— ë”ìš± ê·¸ë ‡ê²Œ ëŠê»´ì¡Œë‹¤...\n\n```python\n# backend/app/models/user.py\nfrom typing import TypeVar\n\nfrom fastapi_users import schemas\nfrom pydantic import EmailStr\nfrom pydantic import Field as _Field\nfrom sqlmodel import Field, select\n\nfrom ..db.session import async_session\nfrom .core import base_model, datetime_model, uuid_id_model\n\nmin_name_length = 4\nmax_name_length = 20\n\n\n_T = TypeVar(\"_T\", bound=\"user\")\nid_model = uuid_id_model\nuser_id_type = id_model.id_type\n\n\nclass user(id_model, datetime_model, base_model, table=True):\n    __tablename__: str = \"users\"\n\n    name: str = Field(min_length=min_name_length, max_length=max_name_length)\n    hashed_password: str = Field(max_length=2**10)\n    email: EmailStr = Field(index=True)\n    is_active: bool = True\n    is_superuser: bool = False\n    is_verified: bool = False\n\n    @classmethod\n    async def get_from_email(\n        cls: type[_T], session: async_session, email: str\n    ) -\u003e _T | None:\n        is_user_cur = await session.exec(select(cls).where(cls.email == email))\n        return is_user_cur.first()\n\n    def __init__(self, *args, **kwargs):\n        super().__init__(*args, **kwargs)\n        self.validate(self)\n\n\nclass user_read(schemas.BaseUser[user_id_type], datetime_model):\n    name: str = _Field(min_length=min_name_length, max_length=max_name_length)\n\n\nclass user_create(schemas.BaseUserCreate):\n    name: str = _Field(min_length=min_name_length, max_length=max_name_length)\n\n\nclass user_update(schemas.BaseUserUpdate):\n    name: str = _Field(min_length=min_name_length, max_length=max_name_length)\n```\n\n### ì¸ì¦ ëª¨ë“ˆ ì œë„¤ë¦­ íƒ€ì… ë®ì–´ì”Œìš°ê¸°\n\n**`fastapi-users`** ì—ì„œ ì›í•˜ëŠ” í˜•íƒœëŠ” `SQLAlchemyBaseUserTable`ë¥¼ ìƒì†í•œ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ì§€ë§Œ, **`sqlmodel`** ë„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  **`fastapi-users`** ì˜ íƒ€ì… íŒíŠ¸ë„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ê¸°ì—, ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì—®ì–´ì¤„ ìƒˆë¡œìš´ ì œë„¤ë¦­ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.\n`# type: ignore`ë¥¼ ë‚¨ë°œí•˜ê¸°ì— ê·¸ë‹¤ì§€ ì¢‹ì€ ëª¨ìŠµì´ë¼ê³  ìƒê°ë˜ì§€ ì•Šì§€ë§Œ, ì´ê±° ì™¸ì— ë‹¹ì¥ ìƒê°ë‚˜ëŠ” ë°©ë²•ì´ ì—†ê¸°ì— ì¼ë‹¨ ë„˜ì–´ê°€ì.\n\n```bash\nâ¯ mkdir backend/app/services/authentication\nâ¯ mv backend/app/services/authentication.py backend/app/services/authentication/authentication.py\nâ¯ touch backend/app/services/authentication/__init__.py backend/app/services/authentication/convert.py\n```\n\n```python\n# backend/app/services/authentication/__init__.py\nfrom .authentication import *\n```\n\n```python\n# backend/app/services/authentication/convert.py\nfrom typing import Generic, TypeVar\n\nfrom fastapi_users import BaseUserManager, FastAPIUsers\nfrom fastapi_users.authentication import AuthenticationBackend, JWTStrategy, Strategy\nfrom fastapi_users.db import SQLAlchemyUserDatabase\n\nfrom ...models.core import base_model\nfrom ...models.user import user\n\nuser_id_type = user.id_type\n_T = TypeVar(\"_T\", bound=base_model)\n_D = TypeVar(\"_D\")\n\n# fmt: off\nclass user_db_class(SQLAlchemyUserDatabase[_T, _D], Generic[_T, _D]): ... # type: ignore\nclass strategy_class(Strategy[_T, _D], Generic[_T, _D]): ... # type: ignore\nclass jwt_strategy_class(JWTStrategy[_T, _D], Generic[_T, _D]): ... # type: ignore\nclass auth_backend_class(AuthenticationBackend[_T, _D], Generic[_T, _D]): ... # type: ignore\nclass user_manager_class(BaseUserManager[_T, _D], Generic[_T, _D]): ...  # type: ignore\nclass fastapi_users_class(FastAPIUsers[_T, _D], Generic[_T, _D]): ...  # type: ignore\n# fmt: on\n\n\nuser_manager_type = user_manager_class[user, user_id_type]\nstrategy_type = strategy_class[user, user_id_type]\n```\n\n### ë³€ê²½ì  ì¸ì¦ ëª¨ë“ˆì— ì ìš©\n\n```python\n# backend/app/services/authentication/authentication.py\nimport re\nfrom dataclasses import dataclass\nfrom re import Pattern\nfrom typing import AsyncGenerator, Sequence\n\nfrom fastapi import Depends, Request\nfrom fastapi_users import IntegerIDMixin, InvalidPasswordException\nfrom fastapi_users.authentication import BearerTransport, Transport\n\nfrom ...core import config\nfrom ...db.session import async_session, get_session\nfrom ...models import user\nfrom .convert import (\n    auth_backend_class,\n    fastapi_users_class,\n    jwt_strategy_class,\n    strategy_class,\n    strategy_type,\n    user_db_class,\n    user_id_type,\n    user_manager_class,\n    user_manager_type,\n)\n\n\nasync def get_user_db(\n    session: async_session = Depends(get_session),\n) -\u003e AsyncGenerator[user_db_class[user.user, user_id_type], None]:\n    yield user_db_class(session, user.user)\n\n\ndef create_transport() -\u003e Transport:\n    return BearerTransport(tokenUrl=config.TOKEN_PREFIX)\n\n\ndef create_strategy() -\u003e strategy_class[user.user, user_id_type]:\n    return jwt_strategy_class(  # type: ignore\n        secret=str(config.SECRET_KEY),\n        lifetime_seconds=config.ACCESS_TOKEN_EXPIRE_SECONDS,\n        token_audience=[config.JWT_AUDIENCE],\n        algorithm=config.JWT_ALGORITHM,\n    )\n\n\ndef create_backend() -\u003e list[auth_backend_class[user.user, user_id_type]]:\n    transport = create_transport()\n    return [\n        auth_backend_class(\n            name=config.AUTH_BACKEND_NAME,\n            transport=transport,\n            get_strategy=create_strategy,\n        )\n    ]\n\n\nclass UserManager(IntegerIDMixin, user_manager_class[user.user, user_id_type]):\n    reset_password_token_secret = str(config.SECRET_KEY)\n    verification_token_secret = str(config.SECRET_KEY)\n\n    min_password_length: int = 10\n    max_password_length: int = 30\n    re_password_need_list: list[Pattern] = [\n        re.compile(r\"[a-zA-Z]\"),\n        re.compile(r\"[0-9]\"),\n        re.compile(r\"[\\{\\}\\[\\]\\/?.,;:|\\)*~`!^\\-_+\u003c\u003e@\\#$%\u0026\\\\\\=\\(\\'\\\"]\"),\n    ]\n    re_password_deny_list: list[Pattern] = []\n\n    async def validate_password(\n        self, password: str, user: user.user_create | user.user\n    ) -\u003e None:\n        if len(password) \u003c self.min_password_length:\n            raise InvalidPasswordException(\n                reason=f\"Password should be at least {self.min_password_length} characters\"\n            )\n        elif len(password) \u003e self.max_password_length:\n            raise InvalidPasswordException(\n                reason=f\"Password should be at most {self.max_password_length} characters\"\n            )\n\n        for pattern in self.re_password_deny_list:\n            if pattern.search(password):\n                raise InvalidPasswordException(\n                    reason=f\"Password should not include {pattern.pattern}\"\n                )\n\n        for pattern in self.re_password_need_list:\n            if not pattern.search(password):\n                raise InvalidPasswordException(\n                    reason=f\"Password must include {pattern.pattern}\"\n                )\n\n    async def on_after_register(self, user: user.user, request: Request | None = None):\n        print(f\"User {user.id} has registered.\")\n\n    async def on_after_forgot_password(\n        self, user: user.user, token: str, request: Request | None = None\n    ):\n        print(f\"User {user.id} has forgot their password. Reset token: {token}\")\n\n    async def on_after_request_verify(\n        self, user: user.user, token: str, request: Request | None = None\n    ):\n        print(f\"Verification requested for user {user.id}. Verification token: {token}\")\n\n\nasync def get_user_manager(\n    user_db=Depends(get_user_db),\n) -\u003e AsyncGenerator[UserManager, None]:\n    yield UserManager(user_db)\n\n\ndef create_fastapi_users(\n    *backends: auth_backend_class[user.user, user_id_type],\n) -\u003e fastapi_users_class[user.user, user_id_type]:\n    return fastapi_users_class(\n        get_user_manager=get_user_manager, auth_backends=backends\n    )\n\n\n@dataclass(frozen=True)\nclass fastapi_user_class:\n    users: fastapi_users_class[user.user, user_id_type]\n\n    @classmethod\n    def init(cls) -\u003e \"fastapi_user_class\":\n        users = create_fastapi_users(*create_backend())\n        return cls(users=users)\n\n    @property\n    def backends(self) -\u003e Sequence[auth_backend_class[user.user, user_id_type]]:\n        return self.users.authenticator.backends  # type: ignore\n\n    @property\n    def user_manager_depends(self) -\u003e user_manager_type:\n        return Depends(self.users.get_user_manager)\n\n    def strategy_depends(self, num: int = 0, /) -\u003e strategy_type:\n        backend = self.backends[num]\n        return Depends(backend.get_strategy)\n```\n\nê½¤ ë§ì´ ë°”ë€Œê¸´ í–ˆì§€ë§Œ, ì‹¤ì œë¡œ ì‚¬ìš©í• ë•ŒëŠ” ì´ë¦„ì •ë„ë§Œ ë°”ë€Œì§€ ì‚¬ìš©ë²• ìì²´ëŠ” ë³€í•œê²Œ ì—†ë‹¤. ë°”ë€ ì´ë¦„ì— ë§ì¶°ì„œ ë¼ìš°í„°ì™€ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì£¼ë©´, ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\n\nì´ë²ˆ ê¸°íšŒì— í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì–¼ë§ˆë‚˜ ì¢‹ì€ê±´ì§€ ì•Œê²Œëë‹¤.. ê¸´ê°€ë¯¼ê°€í• ë•Œ `pytest --tb=short` í•œë°©ì´ë©´ ì˜ë¬¸ì´ í•´ê²°ëœë‹¤.\n\nì‚¬ì‹¤ ë³€ê²½í• ê²Œ í•˜ë‚˜ ë” ë‚¨ê¸´ í–ˆì§€ë§Œ, ì´ê±° ì•„ì§ ì‹œë„í•´ë³´ì§€ ì•Šì•˜ë‹¤.\ní˜„ì¬ í—¤ë”ë¥¼ ì‚¬ìš©í•œ ì¸ì¦ ë°©ì‹ì¸ë°, ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ê³ , `access-token`ê³¼ `refresh-token`ì„ ì‚¬ìš©í•œ ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•´ë³´ë ¤ í•œë‹¤. ë‹¤ë§Œ **`fastapi-users`** ìì²´ì ìœ¼ë¡œëŠ” ì§€ì›í•˜ì§€ ì•Šê¸°ì—, ì§ì ‘ ì‘ì„±í•  í•„ìš”ê°€ ìˆì–´ì„œ ì•½ê°„ ê³ ë¯¼ì´ í•„ìš”í• ë“¯.\n","mtime":"2022-08-13T00:12:20.000+09:00","href":"velog/fastapi íŠœí† ë¦¬ì–¼ -8.2- FastAPI Users v10 ëŒ€ì‘","data":{"title":"fastapi íŠœí† ë¦¬ì–¼ -8.2- FastAPI Users v10 ëŒ€ì‘","date":"2022-05-07T23:00:58.369+09:00","tags":["fastapi","fastapi-users","python","sqlmodel","@all"],"page":"fastapi íŠœí† ë¦¬ì–¼","summary":"fastapi ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ê³µë¶€í• ê²¸, ì°¸ê³ í• ë§Œí•œ ì¢‹ì€ ì˜ˆì œê°€ ìˆì–´ì„œ ì´ ì‹œë¦¬ì¦ˆë¥¼ ì•½ê°„ì˜ ë³€ê²½ì„ ì£¼ê³  ë”°ë¼ê°€ë³´ë ¤ í•œë‹¤."}},{"name":"fastapi íŠœí† ë¦¬ì–¼ -8.1- SQLModel AsyncSession ê´€ë ¨ íƒ€ì… ë¬¸ì œ ì„ì‹œ í•´ê²° + ì¶”ê°€ ìˆ˜ì •","content":"\n**`fastapi`** ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ê³µë¶€í• ê²¸, ì°¸ê³ í• ë§Œí•œ ì¢‹ì€ [ì˜ˆì œ](https://www.jeffastor.com/blog/populating-cleaning-jobs-with-user-offers-in-fastapi)ê°€ ìˆì–´ì„œ ì´ ì‹œë¦¬ì¦ˆë¥¼ ì•½ê°„ì˜ ë³€ê²½ì„ ì£¼ê³  ë”°ë¼ê°€ë³´ë ¤ í•œë‹¤.\nì§€ë‚œë²ˆì²˜ëŸ¼ ì–´ì©Œë‹¤ ê·¸ë§Œë‘˜ ìˆ˜ë„ ìˆê¸´ í•˜ì§€ë§Œ...\n\n---\n\n## `Session`ì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ë³µë¶™\n\nì´ì „ê¹Œì§€ ê¸€ì—ì„œ ê³„ì†í•´ì„œ `AsyncSession`ì˜ íƒ€ì… ê´€ë ¨ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ê²Œ ë„ˆë¬´ ì§œì¦ë‚˜ì„œ, ì„ì‹œë¡œ ë•œë¹µìš© í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.\n\n````python\n# backend/app/db/session.py\n(...)\n\n_TSelectParam = TypeVar(\"_TSelectParam\")\n\nclass async_session(AsyncSession):\n    # sqlmodel.orm.session.Session\n    @overload\n    async def exec(\n        self,\n        statement: Select[_TSelectParam],\n        *,\n        params: Optional[Union[Mapping[str, Any], Sequence[Mapping[str, Any]]]] = None,\n        execution_options: Mapping[str, Any] = util.EMPTY_DICT,\n        bind_arguments: Optional[Mapping[str, Any]] = None,\n        _parent_execute_state: Optional[Any] = None,\n        _add_event: Optional[Any] = None,\n        **kw: Any,\n    ) -\u003e Result[_TSelectParam]:\n        ...\n\n    @overload\n    async def exec(\n        self,\n        statement: SelectOfScalar[_TSelectParam],\n        *,\n        params: Optional[Union[Mapping[str, Any], Sequence[Mapping[str, Any]]]] = None,\n        execution_options: Mapping[str, Any] = util.EMPTY_DICT,\n        bind_arguments: Optional[Mapping[str, Any]] = None,\n        _parent_execute_state: Optional[Any] = None,\n        _add_event: Optional[Any] = None,\n        **kw: Any,\n    ) -\u003e ScalarResult[_TSelectParam]:\n        ...\n\n    async def exec(\n        self,\n        statement: Union[\n            Select[_TSelectParam],\n            SelectOfScalar[_TSelectParam],\n            Executable[_TSelectParam],\n        ],\n        *,\n        params: Optional[Union[Mapping[str, Any], Sequence[Mapping[str, Any]]]] = None,\n        execution_options: Mapping[str, Any] = util.EMPTY_DICT,\n        bind_arguments: Optional[Mapping[str, Any]] = None,\n        _parent_execute_state: Optional[Any] = None,\n        _add_event: Optional[Any] = None,\n        **kw: Any,\n    ) -\u003e Union[Result[_TSelectParam], ScalarResult[_TSelectParam]]:\n        \"\"\"\n        sqlmodel.orm.session.Session\n        \"\"\"\n        return await super().exec(\n            statement,  # type: ignore\n            params=params,\n            execution_options=execution_options,\n            bind_arguments=bind_arguments,\n            _parent_execute_state=_parent_execute_state,\n            _add_event=_add_event,\n            **kw,\n        )\n\n    async def execute(\n        self,\n        statement: _Executable,\n        params: Optional[Union[Mapping[str, Any], Sequence[Mapping[str, Any]]]] = None,\n        execution_options: Optional[Mapping[str, Any]] = util.EMPTY_DICT,\n        bind_arguments: Optional[Mapping[str, Any]] = None,\n        _parent_execute_state: Optional[Any] = None,\n        _add_event: Optional[Any] = None,\n        **kw: Any,\n    ) -\u003e Result[Any]:\n        \"\"\"\n        sqlmodel.orm.session.Session\n        ***\n\n        ğŸš¨ You probably want to use `session.exec()` instead of `session.execute()`.\n\n        This is the original SQLAlchemy `session.execute()` method that returns objects\n        of type `Row`, and that you have to call `scalars()` to get the model objects.\n\n        For example:\n\n        ```Python\n        heroes = session.execute(select(Hero)).scalars().all()\n        ```\n\n        instead you could use `exec()`:\n\n        ```Python\n        heroes = session.exec(select(Hero)).all()\n        ```\n        \"\"\"\n        return await super().execute(  # type: ignore\n            statement,\n            params=params,\n            execution_options=execution_options,\n            bind_arguments=bind_arguments,\n            _parent_execute_state=_parent_execute_state,\n            _add_event=_add_event,\n            **kw,\n        )\n\n    async def get(\n        self,\n        entity: Type[_TSelectParam],\n        ident: Any,\n        options: Optional[Sequence[Any]] = None,\n        populate_existing: bool = False,\n        with_for_update: Optional[Union[Literal[True], Mapping[str, Any]]] = None,\n        identity_token: Optional[Any] = None,\n    ) -\u003e Optional[_TSelectParam]:\n        \"\"\"\n        sqlmodel.orm.session.Session\n        \"\"\"\n        return await super().get(\n            entity,\n            ident,\n            options=options,\n            populate_existing=populate_existing,\n            with_for_update=with_for_update,\n            identity_token=identity_token,\n        )\n````\n\nì£¼ì„ì„ ë³´ë©´ ì•Œê² ì§€ë§Œ, ê·¸ëƒ¥ `sqlmodel.orm.session.Session` ê°ì²´ì˜ ê° ë©”ì†Œë“œì˜ íƒ€ì… íŒíŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™”ë‹¤. ì´ì— ë§ì¶°ì„œ ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ì˜ `AsyncSession`ë„ ëª¨ë‘ `async_session`ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³€í™˜í•´ì¤€ë‹¤. ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•´ë³´ë©´ ë¬¸ì œì—†ì´ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\n\n---\n\n## `datetime_model` ê´€ë ¨ ë¬¸ì œ í•´ê²°\n\n`datetime_model`ì˜ `datetime_attrs` ì†ì„±ì´ ì˜ë„í•œëŒ€ë¡œ ì¶œë ¤ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì–´ì„œ ì¶”ê°€ë¡œ ìˆ˜ì •í–ˆë‹¤. `cls.__fields__.keys()` ë¥¼ `datetime_model.__fields__.keys()`ë¡œ ìˆ˜ì •í•œ ê²ƒì™¸ì— ëª¨ë‘ ë™ì¼í•˜ë‹¤.\n\n```python\n# backend/app/models/core.py\n(...)\n\nclass datetime_model(fix_return_type_model):\n    created_at: datetime = Field(default_factory=datetime.now)\n    updated_at: datetime = Field(default_factory=datetime.now)\n\n    def update(self: _D) -\u003e _D:\n        self.updated_at = datetime.now()\n        return self\n\n    @classmethod\n    @property\n    def datetime_attrs(cls) -\u003e set[str]:\n        return set(datetime_model.__fields__.keys())\n```\n\n## `id_model` ì„¸ë¶„í™”\n\nê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ `id_model`ì„ `int_id_model`ê³¼ `uuid_id_model`ë¡œ ì„¸ë¶„í™”í•´ì„œ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.\n\n```python\n# backend/app/models/core.py\nfrom uuid import uuid4\nfrom pydantic import UUID4\n\n(...)\n\nclass id_model(fix_return_type_model):\n    @classmethod\n    @property\n    def id_type(cls) -\u003e Any:\n        return cls.__fields__[\"id\"].type_\n\n\nclass int_id_model(id_model):\n    id: int | None = Field(None, primary_key=True)\n\n\nclass uuid_id_model(id_model):\n    id: UUID4 | None = Field(default_factory=uuid4, primary_key=True)\n```\n\n## `dependencies` ëª¨ë“ˆ ìƒì„±\n\nê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ `get_session`ì´ë‚˜ `get_current_user`ê°™ì€ `Depends`ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë˜ í•¨ìˆ˜ë¥¼ ë”°ë¡œ ê´€ë¦¬í•˜ê¸°ë¡œ í–ˆë‹¤.\n\n```python\n# backend/app/dependencies/database.py\nfrom typing import AsyncIterator\n\nfrom fastapi import Depends, Request\nfrom sqlalchemy.ext.asyncio.engine import AsyncEngine\n\nfrom ..db.session import async_session\n\n\nasync def get_database(request: Request) -\u003e AsyncEngine:\n    if (engine := getattr(request.app.state, \"_db\", None)) is None:\n        raise AttributeError(\"there is no database engine in request as state\")\n    return engine\n\n\nasync def get_session(\n    engine: AsyncEngine = Depends(get_database),\n) -\u003e AsyncIterator[async_session]:\n    async with async_session(engine, autoflush=False, autocommit=False) as session:\n        yield session\n```\n\n```python\n# backend/app/dependencies/auth.py\nfrom ..services.authentication import fastapi_user_class\n\nfastapi_user = fastapi_user_class.init()\n\nget_current_user = fastapi_user.users.current_user(\n    optional=False, active=True, verified=False, superuser=False\n)\nget_user_manager = fastapi_user.get_user_manager\nget_backend = fastapi_user.get_backend\nget_transport = fastapi_user.get_transport\nget_strategy = fastapi_user.get_strategy\n```\n\n```python\n# backend/app/services/authentication/authentication.py\n(...)\n\n@dataclass(frozen=True)\nclass fastapi_user_class:\n    users: fastapi_users_class[user.user, user_id_type]\n    named_backends: dict[str, auth_backend_type] = field(default_factory=dict)\n\n    @classmethod\n    def init(cls) -\u003e \"fastapi_user_class\":\n        users = create_fastapi_users(*create_backend())\n        return cls(users=users)\n\n    @property\n    def backends(self) -\u003e Sequence[auth_backend_type]:\n        return self.users.authenticator.backends  # type: ignore\n\n    @property\n    def get_user_manager(self):\n        return self.users.get_user_manager\n\n    def find_backend(self, _val: str, /) -\u003e auth_backend_type:\n        for backend in self.backends:\n            if backend.name == _val:\n                return backend\n        raise IndexError(f\"there is not auth_backend name: {_val}\")\n\n    def get_backend(self, _val: int | str = 0, /) -\u003e auth_backend_type:\n        if isinstance(_val, int):\n            return self.backends[_val]\n\n        if (backend := self.named_backends.get(_val)) is None:\n            backend = self.named_backends[_val] = self.find_backend(_val)\n        return backend\n\n    def get_transport(self, _val: int | str = 0, /) -\u003e Transport:\n        backend = self.get_backend(_val)\n        return backend.transport\n\n    def get_strategy(self, _val: int | str = 0, /):\n        backend = self.get_backend(_val)\n        return backend.get_strategy\n```\n","mtime":"2022-08-13T00:12:20.000+09:00","href":"velog/fastapi íŠœí† ë¦¬ì–¼ -8.1- SQLModel AsyncSession ê´€ë ¨ íƒ€ì… ë¬¸ì œ ì„ì‹œ í•´ê²° + ì¶”ê°€ ìˆ˜ì •","data":{"title":"fastapi íŠœí† ë¦¬ì–¼ -8.1- SQLModel AsyncSession ê´€ë ¨ íƒ€ì… ë¬¸ì œ ì„ì‹œ í•´ê²° + ì¶”ê°€ ìˆ˜ì •","date":"2022-05-07T22:08:12.781+09:00","tags":["fastapi","python","sqlmodel","@all"],"page":"fastapi íŠœí† ë¦¬ì–¼","summary":"fastapi ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ê³µë¶€í• ê²¸, ì°¸ê³ í• ë§Œí•œ ì¢‹ì€ ì˜ˆì œê°€ ìˆì–´ì„œ ì´ ì‹œë¦¬ì¦ˆë¥¼ ì•½ê°„ì˜ ë³€ê²½ì„ ì£¼ê³  ë”°ë¼ê°€ë³´ë ¤ í•œë‹¤."}}]},"__N_SSG":true},"page":"/posts/@tag/[...tag]","query":{"tag":["python"]},"buildId":"MQ_lMVQgBI0RkmUA6wvVT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>