<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="author" content="phi.friday@gmail.com, phi"/><meta name="robots" content="index,follow,noarchive"/><meta name="google-site-verification" content="lW107Dj5ageygd67UUzTm-kGls5d-THy9jJQZqLoauw"/><title>phi.log - 파이썬 코드를 깔끔하게, 그리고 일관성 있게 작성하는법</title><link href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" rel="stylesheet"/><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/e61452b80f7f8356.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e61452b80f7f8356.css" data-n-g=""/><link rel="preload" href="/_next/static/css/1f4d813b299120ae.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1f4d813b299120ae.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-5752944655d749a0.js" defer=""></script><script src="/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/_next/static/chunks/main-5dc3bdee87ff18dd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f6271bdec05edb1f.js" defer=""></script><script src="/_next/static/chunks/996-f3cf67c2e3ac5e06.js" defer=""></script><script src="/_next/static/chunks/756-1349105dbea71525.js" defer=""></script><script src="/_next/static/chunks/3-4b8664ceef873544.js" defer=""></script><script src="/_next/static/chunks/224-ddba219ecdd5c904.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5B...name%5D-98f81935dc747879.js" defer=""></script><script src="/_next/static/MQ_lMVQgBI0RkmUA6wvVT/_buildManifest.js" defer=""></script><script src="/_next/static/MQ_lMVQgBI0RkmUA6wvVT/_ssgManifest.js" defer=""></script><script src="/_next/static/MQ_lMVQgBI0RkmUA6wvVT/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><style>
      #nprogress {
        pointer-events: none;
      }
      #nprogress .bar {
        background: #29D;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
      }
      #nprogress .peg {
        display: block;
        position: absolute;
        right: 0px;
        width: 100px;
        height: 100%;
        box-shadow: 0 0 10px #29D, 0 0 5px #29D;
        opacity: 1;
        -webkit-transform: rotate(3deg) translate(0px, -4px);
        -ms-transform: rotate(3deg) translate(0px, -4px);
        transform: rotate(3deg) translate(0px, -4px);
      }
      #nprogress .spinner {
        display: block;
        position: fixed;
        z-index: 1031;
        top: 15px;
        right: 15px;
      }
      #nprogress .spinner-icon {
        width: 18px;
        height: 18px;
        box-sizing: border-box;
        border: solid 2px transparent;
        border-top-color: #29D;
        border-left-color: #29D;
        border-radius: 50%;
        -webkit-animation: nprogresss-spinner 400ms linear infinite;
        animation: nprogress-spinner 400ms linear infinite;
      }
      .nprogress-custom-parent {
        overflow: hidden;
        position: relative;
      }
      .nprogress-custom-parent #nprogress .spinner,
      .nprogress-custom-parent #nprogress .bar {
        position: absolute;
      }
      @-webkit-keyframes nprogress-spinner {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes nprogress-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style><div class="container" style="max-width:900px;min-width:400px"><div class="container default_app"><header><div class="container"><nav class="navbar-light fixed-top navbar navbar-expand-sm bg-light" role="navigation"><div class="container" style="max-width:900px"><div class="container-fluid"><ul class="navbar-nav w-100"><li class="nav-item"><a data-test="nav-link" class="nav-link" href="/"><div class="text-nowrap nav_text__4OEN1"><i class="fa fa-home"></i> Home</div></a></li><li class="nav-item"><a data-test="nav-link" class="nav-link" href="/posts/@tag"><div class="text-nowrap nav_text__4OEN1"><i class="fa fa-hashtag"></i> Post</div></a></li><li class="nav-item"><a data-test="nav-link" class="nav-link" href="/posts/@page"><div class="text-nowrap nav_text__4OEN1"><i class="fa fa-blog"></i> Page</div></a></li><div class="container d-flex justify-content-end align-self-center"><div class="row"><div class="col"><form class="input-group w-auto" method="get" action="https://www.google.com/search" target="_blank" style="min-width:230px"><input type="hidden" name="sitesearch" value="phi-friday.github.io"/><input type="search" class="form-control" placeholder="Search in Google" aria-label="Search" name="q" maxLength="255"/><button class="ripple ripple-surface btn btn-outline-primary" role="button"><i class="fa fa-search"></i></button></form></div></div></div></ul></div></div></nav></div></header><main><div class="container"><article><div class="row"><div class="display-6 mb-3">파이썬 코드를 깔끔하게, 그리고 일관성 있게 작성하는법</div><h6 class="mb-0 text-muted text-end"><time dateTime="2021-11-29T23:56:34.516+09:00">작성일: 2021년 11월 29일 23시 56분 34초</time></h6><h6 class="mt-0 text-muted text-end"><time dateTime="2022-08-13T00:12:20.000+09:00">수정일: 2022년 8월 13일 24시 12분 20초</time></h6><div class="d-flex justify-content-end"><div><span><span class="badge bg-info mx-1">#black<!-- --> </span></span><span><span class="badge bg-info mx-1">#isort<!-- --> </span></span><span><span class="badge bg-info mx-1">#python<!-- --> </span></span><span><span class="badge bg-info mx-1">#vscode<!-- --> </span></span></div></div></div><div class="row"><div class="mt-3 mb-5 border-top"></div></div><div class="row"><div><div class="toolbar"><div></div></div><div class="markdown-body"><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#코드를-일관성있게-만드는-black">코드를 일관성있게 만드는 black</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#하지만-완벽하지는-않다">하지만 완벽하지는 않다.</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#import-구문도-빠짐없이-정리">import 구문도 빠짐없이 정리</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#결론">결론</a></li></ol></nav><p>스크립트를 작성하다보면 일관성있게 작성하기가 쉽지 않다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span>data </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span>    </span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span> y</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span>    </span><span class="token" style="color:#cc7832">for</span><span> x</span><span class="token" style="color:#a9b7c6">,</span><span> y </span><span class="token" style="color:#cc7832">in</span><span> </span><span class="token" style="color:#e8bf6a">zip</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#e8bf6a">range</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">5</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#e8bf6a">range</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">20</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">24</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span>    </span><span class="token" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x </span><span class="token" style="color:#a9b7c6">%</span><span> </span><span class="token" style="color:#6897bb">3</span><span> </span><span class="token" style="color:#cc7832">and</span><span> y </span><span class="token" style="color:#a9b7c6">%</span><span> </span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">or</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x </span><span class="token" style="color:#a9b7c6">%</span><span> </span><span class="token" style="color:#6897bb">5</span><span> </span><span class="token" style="color:#cc7832">and</span><span> y </span><span class="token" style="color:#a9b7c6">%</span><span> </span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span><span></span><span class="token" style="color:#a9b7c6">]</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>이렇게 작성하든</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span>data </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span>y</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">for</span><span> x</span><span class="token" style="color:#a9b7c6">,</span><span>y </span><span class="token" style="color:#cc7832">in</span><span> </span><span class="token" style="color:#e8bf6a">zip</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#e8bf6a">range</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">5</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#e8bf6a">range</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">20</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">24</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">%</span><span class="token" style="color:#6897bb">3</span><span> </span><span class="token" style="color:#cc7832">and</span><span> y</span><span class="token" style="color:#a9b7c6">%</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">or</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">%</span><span class="token" style="color:#6897bb">5</span><span> </span><span class="token" style="color:#cc7832">and</span><span> y</span><span class="token" style="color:#a9b7c6">%</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">]</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>저렇게 작성하든 결국 결과는 같기 때문이다.</p>
<p>이는 특히 협업시 두드러지게 나타나고, 파이썬의 장점인 <strong>실행할 수 있는 의사코드</strong>라는 점이 많이 퇴색된다.</p>
<p>이러한 경우를 해결하기 위해, 그렇다면 <strong>정해진 하나의 규칙으로, 전부 밀어버리면 되지 않냐</strong>는 생각으로 만들어진 패키지가 있다. 바로 <code>black</code>이다.</p>
<h2 id="코드를-일관성있게-만드는-black">코드를 일관성있게 만드는 black</h2>
<hr/>
<p>설치도 사용도 간단하다. <code>pip install black</code>으로 설치가 가능하고, <code>python -m black {source_file_or_directory}</code>으로 실행이 가능하다.</p>
<p><strong>그런데 이것도 사실 꽤 귀찮다.</strong> 스크립트를 수정하고 <code>black</code>을 계속 돌려줘야 하는데, 이걸 어떻게 다 기억하고 있을까.</p>
<p>그래서 많이 쓰이는 <code>vscode</code>에서는, 파이썬 스크립트를 저장할 때 자동으로 <code>black</code>이 적용되도록 하는 옵션이 따로 있다. 다음 값을 <code>settings.json</code>에 추가하면 된다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-json" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span>    </span><span class="token" style="color:#9876aa">&quot;python.formatting.provider&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;black&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span>    </span><span class="token" style="color:#9876aa">&quot;editor.formatOnSave&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">true</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">json</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>이제 <code>vscode</code>에서 다음과 같은 코드를 작성하고</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">test1</span><span class="token" style="color:#a9b7c6">(</span><span>a</span><span class="token" style="color:#a9b7c6">,</span><span>  b</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span>    c</span><span class="token" style="color:#a9b7c6">=</span><span>a</span><span class="token" style="color:#a9b7c6">+</span><span>b
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> c
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span><span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">test2</span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span><span>    a</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span>    b
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span><span></span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span><span>    c </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">10</span><span>        a</span><span class="token" style="color:#a9b7c6">*</span><span>b
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">11</span><span>    </span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">12</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> c</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>저장을 하면 다음과 같이 변한다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">test1</span><span class="token" style="color:#a9b7c6">(</span><span>a</span><span class="token" style="color:#a9b7c6">,</span><span> b</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span>    c </span><span class="token" style="color:#a9b7c6">=</span><span> a </span><span class="token" style="color:#a9b7c6">+</span><span> b
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> c
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span><span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">test2</span><span class="token" style="color:#a9b7c6">(</span><span>a</span><span class="token" style="color:#a9b7c6">,</span><span> b</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span><span>    c </span><span class="token" style="color:#a9b7c6">=</span><span> a </span><span class="token" style="color:#a9b7c6">*</span><span> b
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> c
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p><code>black</code>의 변환 규칙은 <a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html">여기</a>에서 확인 할 수 있다.</p>
<h3 id="하지만-완벽하지는-않다">하지만 완벽하지는 않다.</h3>
<p>하지만 <code>black</code>도 2% 부족한 부분이 있다. 각종 모듈을 import할 때, 해당 구문에 대한 정리가 단순히 88자 글자 제한을 넘기지 않는 정도에서 그치는 것이다.</p>
<p>만약 다음과 같은 import구문이 있다면</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#cc7832">from</span><span> datetime </span><span class="token" style="color:#cc7832">import</span><span> datetime
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span></span><span class="token" style="color:#cc7832">from</span><span> anyio</span><span class="token" style="color:#a9b7c6">.</span><span>abc </span><span class="token" style="color:#cc7832">import</span><span> ObjectReceiveStream</span><span class="token" style="color:#a9b7c6">,</span><span> ObjectSendStream
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span></span><span class="token" style="color:#cc7832">from</span><span> random </span><span class="token" style="color:#cc7832">import</span><span> uniform
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span></span><span class="token" style="color:#cc7832">from</span><span> anyio </span><span class="token" style="color:#cc7832">import</span><span> create_memory_object_stream</span><span class="token" style="color:#a9b7c6">,</span><span> create_task_group</span><span class="token" style="color:#a9b7c6">,</span><span> Semaphore</span><span class="token" style="color:#a9b7c6">,</span><span> CapacityLimiter</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p><code>black</code>은 이렇게 까지만 수정된다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#cc7832">from</span><span> datetime </span><span class="token" style="color:#cc7832">import</span><span> datetime
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span></span><span class="token" style="color:#cc7832">from</span><span> anyio</span><span class="token" style="color:#a9b7c6">.</span><span>abc </span><span class="token" style="color:#cc7832">import</span><span> ObjectReceiveStream</span><span class="token" style="color:#a9b7c6">,</span><span> ObjectSendStream
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span></span><span class="token" style="color:#cc7832">from</span><span> random </span><span class="token" style="color:#cc7832">import</span><span> uniform
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span></span><span class="token" style="color:#cc7832">from</span><span> anyio </span><span class="token" style="color:#cc7832">import</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span><span>    create_memory_object_stream</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span><span>    create_task_group</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span><span>    Semaphore</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span><span>    CapacityLimiter</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span><span></span><span class="token" style="color:#a9b7c6">)</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>내가 import하는 모듈이 기본 라이브러리인지, 내가 따로 설치한 라이브러리인지, 로컬 패키지 인지 정리할 수 있다면 참 좋을텐데... 다행히 <strong>그걸 위한 패키지가 있다.</strong> 바로 <code>isort</code>다.</p>
<h2 id="import-구문도-빠짐없이-정리">import 구문도 빠짐없이 정리</h2>
<p><code>isort</code>의 readme 예시에 따르면, 다음과 같은 코드를</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#cc7832">from</span><span> my_lib </span><span class="token" style="color:#cc7832">import</span><span> Object
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span></span><span class="token" style="color:#cc7832">import</span><span> os
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span><span></span><span class="token" style="color:#cc7832">from</span><span> my_lib </span><span class="token" style="color:#cc7832">import</span><span> Object3
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span><span></span><span class="token" style="color:#cc7832">from</span><span> my_lib </span><span class="token" style="color:#cc7832">import</span><span> Object2
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span><span></span><span class="token" style="color:#cc7832">import</span><span> sys
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">10</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">11</span><span></span><span class="token" style="color:#cc7832">from</span><span> third_party </span><span class="token" style="color:#cc7832">import</span><span> lib15</span><span class="token" style="color:#a9b7c6">,</span><span> lib1</span><span class="token" style="color:#a9b7c6">,</span><span> lib2</span><span class="token" style="color:#a9b7c6">,</span><span> lib3</span><span class="token" style="color:#a9b7c6">,</span><span> lib4</span><span class="token" style="color:#a9b7c6">,</span><span> lib5</span><span class="token" style="color:#a9b7c6">,</span><span> lib6</span><span class="token" style="color:#a9b7c6">,</span><span> lib7</span><span class="token" style="color:#a9b7c6">,</span><span> lib8</span><span class="token" style="color:#a9b7c6">,</span><span> lib9</span><span class="token" style="color:#a9b7c6">,</span><span> lib10</span><span class="token" style="color:#a9b7c6">,</span><span> lib11</span><span class="token" style="color:#a9b7c6">,</span><span> lib12</span><span class="token" style="color:#a9b7c6">,</span><span> lib13</span><span class="token" style="color:#a9b7c6">,</span><span> lib14
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">12</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">13</span><span></span><span class="token" style="color:#cc7832">import</span><span> sys
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">14</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">15</span><span></span><span class="token" style="color:#cc7832">from</span><span> __future__ </span><span class="token" style="color:#cc7832">import</span><span> absolute_import
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">16</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">17</span><span></span><span class="token" style="color:#cc7832">from</span><span> third_party </span><span class="token" style="color:#cc7832">import</span><span> lib3</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>다음과 같이 깔끔하게 정리해준다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#cc7832">from</span><span> __future__ </span><span class="token" style="color:#cc7832">import</span><span> absolute_import
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span></span><span class="token" style="color:#cc7832">import</span><span> os
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span></span><span class="token" style="color:#cc7832">import</span><span> sys
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span><span></span><span class="token" style="color:#cc7832">from</span><span> third_party </span><span class="token" style="color:#cc7832">import</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>lib1</span><span class="token" style="color:#a9b7c6">,</span><span> lib2</span><span class="token" style="color:#a9b7c6">,</span><span> lib3</span><span class="token" style="color:#a9b7c6">,</span><span> lib4</span><span class="token" style="color:#a9b7c6">,</span><span> lib5</span><span class="token" style="color:#a9b7c6">,</span><span> lib6</span><span class="token" style="color:#a9b7c6">,</span><span> lib7</span><span class="token" style="color:#a9b7c6">,</span><span> lib8</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span><span>                         lib9</span><span class="token" style="color:#a9b7c6">,</span><span> lib10</span><span class="token" style="color:#a9b7c6">,</span><span> lib11</span><span class="token" style="color:#a9b7c6">,</span><span> lib12</span><span class="token" style="color:#a9b7c6">,</span><span> lib13</span><span class="token" style="color:#a9b7c6">,</span><span> lib14</span><span class="token" style="color:#a9b7c6">,</span><span> lib15</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span><span></span><span class="token" style="color:#cc7832">from</span><span> my_lib </span><span class="token" style="color:#cc7832">import</span><span> Object</span><span class="token" style="color:#a9b7c6">,</span><span> Object2</span><span class="token" style="color:#a9b7c6">,</span><span> Object3</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>정말 깔끔하게 변했다. 하지만 <code>from third_party import (...)</code>에서 확인할 수 있듯이, <code>black</code>의 규칙과 맞지 않는 부분이 있다. 다행히 최근 <code>isort</code>는 <strong><code>black</code>사용자를 위한 설정값을 따로 만들어놨다.</strong></p>
<p>나는 <code>vscode</code>에서 저장할 때 자동으로 적용되길 바라기 때문에, <code>settings.json</code>에 다음과 같은 값을 추가했다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-json" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span>    </span><span class="token" style="color:#9876aa">&quot;python.sortImports.args&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span>        </span><span class="token" style="color:#6a8759">&quot;--profile&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span>        </span><span class="token" style="color:#6a8759">&quot;black&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span><span>    </span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span><span>    </span><span class="token" style="color:#9876aa">&quot;[python]&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span><span>        </span><span class="token" style="color:#9876aa">&quot;editor.codeActionsOnSave&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span><span>            </span><span class="token" style="color:#9876aa">&quot;source.organizeImports&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">true</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span><span>        </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">10</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">11</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">json</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<p>이 설정값을 저장하고 나면, 이전 코드는 다음과 같이 변한다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#cc7832">from</span><span> datetime </span><span class="token" style="color:#cc7832">import</span><span> datetime
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span></span><span class="token" style="color:#cc7832">from</span><span> random </span><span class="token" style="color:#cc7832">import</span><span> uniform
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span></span><span class="token" style="color:#cc7832">from</span><span> anyio </span><span class="token" style="color:#cc7832">import</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span><span>    CapacityLimiter</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span><span>    Semaphore</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span><span>    create_memory_object_stream</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span><span>    create_task_group</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span><span></span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">10</span><span></span><span class="token" style="color:#cc7832">from</span><span> anyio</span><span class="token" style="color:#a9b7c6">.</span><span>abc </span><span class="token" style="color:#cc7832">import</span><span> ObjectReceiveStream</span><span class="token" style="color:#a9b7c6">,</span><span> ObjectSendStream</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">python</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre>
<h2 id="결론">결론</h2>
<hr/>
<p><code>vscode</code>에서 파이썬 코드를 깔끔하게 작성하고 싶다면, <code>black</code>과 <code>isort</code>를 이용하기 위해, <code>settings.json</code>에 다음 값을 추가하면 된다.</p>
<pre style="padding:unset" node="[object Object]"><div class="code-toolbar"><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b;font-size:16px"><code class="language-json" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">1</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">2</span><span>    </span><span class="token" style="color:#9876aa">&quot;python.formatting.provider&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;black&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">3</span><span>    </span><span class="token" style="color:#9876aa">&quot;editor.formatOnSave&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">true</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">4</span><span>    </span><span class="token" style="color:#9876aa">&quot;python.sortImports.args&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">5</span><span>        </span><span class="token" style="color:#6a8759">&quot;--profile&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">6</span><span>        </span><span class="token" style="color:#6a8759">&quot;black&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">7</span><span>    </span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">8</span><span>    </span><span class="token" style="color:#9876aa">&quot;[python]&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">9</span><span>        </span><span class="token" style="color:#9876aa">&quot;editor.codeActionsOnSave&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">10</span><span>            </span><span class="token" style="color:#9876aa">&quot;source.organizeImports&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">true</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">11</span><span>        </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">12</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#808080">13</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></pre><div class="toolbar" style="opacity:1"><div class="btn-group btn-group-sm" role="group"><button class="ripple ripple-surface btn btn-outline-light" disabled="" role="button"><span class="text-capitalize">json</span></button><button class="ripple ripple-surface btn btn-dark" role="button"><i class="fas fa-copy text-light"></i></button></div></div></div></pre></div></div></div><div class="row"><div class="mt-5 mb-3 border-bottom"></div></div><div class="row"><span class="d-flex justify-content-between"><span><h6 class=""><i class="fa fa-angle-left mx-2"></i>파이썬으로 동시성 프로그래밍을 쉽게 하는법...</h6></span><span><h6 class="">fastapi 튜토리얼 -1- 초기 설정<i class="fa fa-angle-right mx-2"></i></h6></span></span><div class="mt-3"><div><section style="width:100%"></section></div></div></div></article></div></main><footer class="text-center text-muted"></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"name":"파이썬 코드를 깔끔하게, 그리고 일관성 있게 작성하는법","content":"스크립트를 작성하다보면 일관성있게 작성하기가 쉽지 않다.\n```python\ndata = [\n    (x, y)\n    for x, y in zip(range(5), range(20, 24))\n    if (x % 3 and y % 2) or (x % 5 and y % 7)\n]\n```\n이렇게 작성하든\n```python\ndata = [(x,y) for x,y in zip(range(5),range(20,24)) if (x%3 and y%2) or (x%5 and y%7)]\n```\n저렇게 작성하든 결국 결과는 같기 때문이다.\n\n이는 특히 협업시 두드러지게 나타나고, 파이썬의 장점인 **실행할 수 있는 의사코드**라는 점이 많이 퇴색된다.\n\n이러한 경우를 해결하기 위해, 그렇다면 **정해진 하나의 규칙으로, 전부 밀어버리면 되지 않냐**는 생각으로 만들어진 패키지가 있다. 바로 `black`이다.\n\n## 코드를 일관성있게 만드는 black\n***\n설치도 사용도 간단하다. `pip install black`으로 설치가 가능하고, `python -m black {source_file_or_directory}`으로 실행이 가능하다.\n\n**그런데 이것도 사실 꽤 귀찮다.** 스크립트를 수정하고 `black`을 계속 돌려줘야 하는데, 이걸 어떻게 다 기억하고 있을까.\n\n그래서 많이 쓰이는 `vscode`에서는, 파이썬 스크립트를 저장할 때 자동으로 `black`이 적용되도록 하는 옵션이 따로 있다. 다음 값을 `settings.json`에 추가하면 된다.\n```json\n{\n    \"python.formatting.provider\": \"black\",\n    \"editor.formatOnSave\": true\n}\n```\n\n이제 `vscode`에서 다음과 같은 코드를 작성하고\n```python\ndef test1(a,  b):\n    c=a+b\n    return c\n\ndef test2(\n    a,\n    b\n):\n    c = (\n        a*b\n    )\n    return c\n```\n저장을 하면 다음과 같이 변한다.\n```python\ndef test1(a, b):\n    c = a + b\n    return c\n\n\ndef test2(a, b):\n    c = a * b\n    return c\n\n```\n`black`의 변환 규칙은 [여기](https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html)에서 확인 할 수 있다.\n\n### 하지만 완벽하지는 않다.\n\n하지만 `black`도 2% 부족한 부분이 있다. 각종 모듈을 import할 때, 해당 구문에 대한 정리가 단순히 88자 글자 제한을 넘기지 않는 정도에서 그치는 것이다.\n\n만약 다음과 같은 import구문이 있다면\n```python\nfrom datetime import datetime\nfrom anyio.abc import ObjectReceiveStream, ObjectSendStream\nfrom random import uniform\nfrom anyio import create_memory_object_stream, create_task_group, Semaphore, CapacityLimiter\n```\n`black`은 이렇게 까지만 수정된다.\n```python\nfrom datetime import datetime\nfrom anyio.abc import ObjectReceiveStream, ObjectSendStream\nfrom random import uniform\nfrom anyio import (\n    create_memory_object_stream,\n    create_task_group,\n    Semaphore,\n    CapacityLimiter,\n)\n```\n내가 import하는 모듈이 기본 라이브러리인지, 내가 따로 설치한 라이브러리인지, 로컬 패키지 인지 정리할 수 있다면 참 좋을텐데... 다행히 **그걸 위한 패키지가 있다.** 바로 `isort`다.\n\n## import 구문도 빠짐없이 정리\n\n`isort`의 readme 예시에 따르면, 다음과 같은 코드를\n```python\nfrom my_lib import Object\n\nimport os\n\nfrom my_lib import Object3\n\nfrom my_lib import Object2\n\nimport sys\n\nfrom third_party import lib15, lib1, lib2, lib3, lib4, lib5, lib6, lib7, lib8, lib9, lib10, lib11, lib12, lib13, lib14\n\nimport sys\n\nfrom __future__ import absolute_import\n\nfrom third_party import lib3\n```\n다음과 같이 깔끔하게 정리해준다.\n```python\nfrom __future__ import absolute_import\n\nimport os\nimport sys\n\nfrom third_party import (lib1, lib2, lib3, lib4, lib5, lib6, lib7, lib8,\n                         lib9, lib10, lib11, lib12, lib13, lib14, lib15)\n\nfrom my_lib import Object, Object2, Object3\n```\n\n정말 깔끔하게 변했다. 하지만 `from third_party import (...)`에서 확인할 수 있듯이, `black`의 규칙과 맞지 않는 부분이 있다. 다행히 최근 `isort`는 **`black`사용자를 위한 설정값을 따로 만들어놨다.**\n\n나는 `vscode`에서 저장할 때 자동으로 적용되길 바라기 때문에, `settings.json`에 다음과 같은 값을 추가했다.\n```json\n{\n    \"python.sortImports.args\": [\n        \"--profile\",\n        \"black\"\n    ],\n    \"[python]\": {\n        \"editor.codeActionsOnSave\": {\n            \"source.organizeImports\": true\n        }\n    }\n}\n```\n\n이 설정값을 저장하고 나면, 이전 코드는 다음과 같이 변한다.\n```python\nfrom datetime import datetime\nfrom random import uniform\n\nfrom anyio import (\n    CapacityLimiter,\n    Semaphore,\n    create_memory_object_stream,\n    create_task_group,\n)\nfrom anyio.abc import ObjectReceiveStream, ObjectSendStream\n```\n\n## 결론\n***\n`vscode`에서 파이썬 코드를 깔끔하게 작성하고 싶다면, `black`과 `isort`를 이용하기 위해, `settings.json`에 다음 값을 추가하면 된다.\n```json\n{\n    \"python.formatting.provider\": \"black\",\n    \"editor.formatOnSave\": true,\n    \"python.sortImports.args\": [\n        \"--profile\",\n        \"black\"\n    ],\n    \"[python]\": {\n        \"editor.codeActionsOnSave\": {\n            \"source.organizeImports\": true\n        }\n    }\n}\n```\n","mtime":"2022-08-13T00:12:20.000+09:00","href":"velog/파이썬 코드를 깔끔하게, 그리고 일관성 있게 작성하는법","data":{"title":"파이썬 코드를 깔끔하게, 그리고 일관성 있게 작성하는법","date":"2021-11-29T23:56:34.516+09:00","tags":["black","isort","python","vscode","@all"],"page":null,"summary":"black과 isort를 vscode에서 사용하자"}},"prev_post":{"name":"파이썬으로 동시성 프로그래밍을 쉽게 하는법 - 2","content":"\n비동기 프로그래밍의 핵심은 무엇일까? 저는 **작업을 생성**하고, 각 작업의 **전환점을 명시**하고, 각 작업간 **정보를 주고받는 것**이라고 생각합니다.\n\n**전환점을 명시**하는 것은 `python`에 특별한 키워드로 추가됐기에, 명확합니다. 각 작업간 전환이 가능하다(`awaitable`이라고 하는 것 같습니다)는 것을 알리는 `async`와, 전환점을 명확하게 알리는 `await`입니다.\n\n그렇다면 **작업을 생성**하고, **정보를 주고받는 것**은 어떻게 해야할까요?\n\n## `anyio`의 작업 생성\n\n`anyio`는 `trio`의 작업 생성 방식을 따라합니다. 그리고 `trio`는 **암시적 동시성**이 없습니다. 따라서 모든 기능은 위에서 아래로 실행합니다.\n\n`trio`는 사용자가 작업을 생성할 때, 그 작업에 대한 책임을 지도록 설계되었습니다. 이 설계는 `async with` 블록으로 나타내며, 이 블록에서 `start_soon`메소드로 호출된 모든 `awaitable` 함수는 동시에 실행되는 하나의 작업으로 생성됩니다. `trio`는 이것을 `nursery`라고 명명했습니다.\n\n`anyio`에서는 이러한 과정을 `task_group`이라 명명해서 보다 직관적으로 알 수 있게 했습니다. 실제 코드로 확인해보겠습니다.\n\n```python\nfrom datetime import datetime\n\nimport anyio\n\n\nasync def just_sleep(num: int, second: float):\n    print(f\"{datetime.today()}:: {num=}, {second=} sleep start\")\n    await anyio.sleep(second)\n    print(f\"{datetime.today()}:: {num=}, {second=} sleep end\")\n\n\nasync def main():\n    async with anyio.create_task_group() as task_group:\n        for num in range(5):\n            task_group.start_soon(just_sleep, num, 5)\n        return\n\n\nif __name__ == \"__main__\":\n    print(f\"{datetime.today()}:: main start\")\n    result = anyio.run(main)\n    print(f\"{datetime.today()}:: main end??? {result=}\")\n```\n\n이 코드에서 실제로 실행되는 함수는 `main` 함수입니다. 이 함수의 코드를 확인해보면, 우선 `async with anyio.create_task_group`으로 `task_group`을 생성합니다. 그리고 이 `task_group` 블록 안에서 `task_group.start_soon`메소드를 이용하여 5개의 `just_sleep`을 호출했습니다.\n\n따라서 이 `task_group` 블록에는, 총 5개의 `just_sleep` 작업이 예정되어있습니다. 하지만 `task_group` 블록을 나가기 전에, `return` 키워드를 작성해서, `task_group` 블록에 5개의 작업을 호출한 직후 해당 함수를 종료하도록 했습니다.\n\n만약 의도한대로 실행된다면, 5개의 `just_sleep` 작업이 생성되지만, 그 직후 main 함수는 `None`을 반환하고, main end??? 는 main start 출력 이후 1초 내에 출력될 것입니다.\n\n```log\n2021-11-29 17:56:17.798277:: main start\n2021-11-29 17:56:17.800793:: num=0, second=5 sleep start\n2021-11-29 17:56:17.800829:: num=1, second=5 sleep start\n2021-11-29 17:56:17.800853:: num=2, second=5 sleep start\n2021-11-29 17:56:17.800869:: num=3, second=5 sleep start\n2021-11-29 17:56:17.800884:: num=4, second=5 sleep start\n2021-11-29 17:56:22.806281:: num=0, second=5 sleep end\n2021-11-29 17:56:22.806401:: num=1, second=5 sleep end\n2021-11-29 17:56:22.806443:: num=2, second=5 sleep end\n2021-11-29 17:56:22.806479:: num=3, second=5 sleep end\n2021-11-29 17:56:22.806513:: num=4, second=5 sleep end\n2021-11-29 17:56:22.807098:: main end??? result=None\n```\n\n하지만 실제 결과는, `return`과 무관하게 생성한 작업이 모두 끝난 이후 `return`이 실행됩니다. 즉, 사용자는 작업을 생성할 때, 각 작업을 어떤식으로든 완료되는 것을 확인 할 의무가 있습니다. 만약 작업 도중 `return`을 실행할 일이 있다면, 그에 맞는 조건을 설정하여 해당 `task_group`을 종료시킨 다음 `return`하는 것이 맞습니다.\n\n말이 길어졌기에, 요약하자면\n\n\u003e 1. `awaitable` 함수는 `async with anyio.create_task_group` 블록 내부에서 `task_group.start_soon` 메소드로 호출한다.\n\u003e 2. 생성된 작업은, 어떤식으로든 완료시켜야 한다.\n\n이 2가지만 기억해도 큰 문제가 없습니다.\n\n## `anyio`의 정보 주고받기\n\nanyio에서 정보를 주고받을때 사용하는 것을 `stream`이라고 합니다. 이 `stream`은 크게 두가지로 분류되는데, 바이트 스트림과 객체 스트림입니다.\n\n객체 스트림은 기존에 사용하던 큐와 거의 같은 형태로 사용이 가능합니다. `stream`의 버퍼 사이즈를 지정하고, 버퍼 사이즈 만큼 객체를 입력하고, 버퍼에 객체가 있으면 그 객체를 가져오는 간단한 방식입니다. `trio`에서는 `channel`이라고 명명합니다.\n\n바이트 스트림은 약간 다릅니다. 만약 사용자가 `b'qwe'`, `b'rty'`라는 두개의 바이트 객체를 입력했다면, 이 스트림에서 객체를 받을 때, `b'qwe'`, `b'rty'`라고 받을 수도 있지만, `b'q'`, `b'wer'`, `b'ty'`라고 받을 수도 있고, `b'qwert'`, `b'y'`라고 받을 수도 있습니다. `trio`에서는 `stream`이라고 명명합니다.\n\n실제로 `stream`을 사용하는 코드로 확인하겠습니다.\n\n```python\nfrom datetime import datetime\nfrom random import uniform\n\nimport anyio\nfrom anyio.abc import ObjectReceiveStream, ObjectSendStream\n\n\nasync def ping(num: int, send: ObjectSendStream):\n    print(f\"{datetime.today()}:: {num=}, ping start\")\n    async with send:\n        sleep_time = uniform(0, 3)\n        await anyio.sleep(sleep_time)\n        await send.send((f\"ping from {num=}, {sleep_time=}\", sleep_time))\n    print(f\"{datetime.today()}:: {num=}, ping end\")\n\n\nasync def pong(receive: ObjectReceiveStream):\n    sleep_time_sum = 0\n    print(f\"{datetime.today()}:: pong start\")\n    async for text, sleep_time in receive:\n        print(f\"{datetime.today()}:: pong:: {text}\")\n        sleep_time_sum += sleep_time\n    print(f\"{datetime.today()}:: pong end:: {sleep_time_sum=}\")\n\n\nasync def main():\n    async with anyio.create_task_group() as task_group:\n        send, receive = anyio.create_memory_object_stream(0)\n        async with send:\n            for num in range(5):\n                task_group.start_soon(ping, num, send.clone())\n        async with receive:\n            task_group.start_soon(pong, receive.clone())\n\n\nif __name__ == \"__main__\":\n    result = anyio.run(main)\n```\n\n우선 `main`함수부터 확인하겠습니다.\n\n`create_task_group`으로 `task_group` 블록을 생성합니다. 그리고 `create_memory_object_stream`으로 각 작업간 정보를 주고받기 위한 `stream`을 생성합니다.\n\n\u003e 이때 생성된 `stream`은 send와 receive 두개로 나뉘어 반환됩니다.\n\n이어서 5개의 `ping`과 1개의 `pong` 작업을 호출해서, 실제로 `main`을 실행할 때 실행될 작업을 지정합니다.\n\n여기서 사용되는 `async with send`와 `async with receive`는 안전한 프로그래밍을 위해 필요한 문법으로, 해당 블록이 끝나면 따로 `close` 메소드를 호출 할 필요 없이, 자동으로 해당 객체를 닫습니다.\n\n그리고 `start_soon`으로 호출되는 각 작업에 send와 receive를 보낼 때 사용되는 `clone`메소드는, 해당 `stream`의 새로운 send와 receive를 생성해서 보내기 위해서 사용됩니다. 만약 send나 receive를 사용하는 작업이 하나가 아닐 때 `clone` 메소드를 사용하지 않는다면, 의도치 않은 `ClosedResourceError`를 만나게 될 수 있습니다.\n\n`main`에서 호출된 작업은 간단합니다.\n`ping`은 0~3초 사이의 랜덤한 시간동안 대기한 다음, 해당 시간에 대한 정보를 send를 이용해서 보냅니다.\n`pong`은 receive를 통해 받은 정보를 출력하고, 합산합니다.\n또한, 각 `ping` 작업은 `main`에서 사용된 방식과 같은 방식으로 `async with` 블록으로 구성되어 있으므로, 따로 `close` 메소드를 호출 할 필요가 없습니다.\n\n이 방식은 상당히 유용한데, 모든 send가 닫히고, 더이상 버퍼에 정보가 없다면 `async for` 블록 또한 자동으로 닫히게 됩니다.\n\n위 코드를 실행해보면 다음과 같은 출력을 확인할 수 있습니다.\n\n```log\n2021-11-29 18:34:55.095995:: num=0, ping start\n2021-11-29 18:34:55.096041:: num=1, ping start\n2021-11-29 18:34:55.096056:: num=2, ping start\n2021-11-29 18:34:55.096068:: num=3, ping start\n2021-11-29 18:34:55.096080:: num=4, ping start\n2021-11-29 18:34:55.096091:: pong start\n2021-11-29 18:34:55.348744:: num=4, ping end\n2021-11-29 18:34:55.348931:: pong:: ping from num=4, sleep_time=0.25142686937439906\n2021-11-29 18:34:56.042114:: num=3, ping end\n2021-11-29 18:34:56.042310:: pong:: ping from num=3, sleep_time=0.9448073290170278\n2021-11-29 18:34:56.779485:: num=1, ping end\n2021-11-29 18:34:56.779686:: pong:: ping from num=1, sleep_time=1.6822150526554853\n2021-11-29 18:34:56.925375:: num=2, ping end\n2021-11-29 18:34:56.925595:: pong:: ping from num=2, sleep_time=1.8275787340996095\n2021-11-29 18:34:57.535689:: num=0, ping end\n2021-11-29 18:34:57.535911:: pong:: ping from num=0, sleep_time=2.4386441219878816\n2021-11-29 18:34:57.536030:: pong end:: sleep_time_sum=7.144672107134403\n```\n\n바이트 스트림 또한 대동소이합니다.\n\n요약하자면\n\n\u003e 1. 바이트 스트림과 객체 스트림으로 정보를 주고받을 수 있다.\n\u003e 2. send와 receive 두개로 나누어 사용한다.\n\u003e 3. send 또는 receive를 사용하는 작업이 여러개라면 `clone` 메소드를 사용한다.\n\u003e 4. `async with`, `async for`를 사용하면 좀 더 깔끔하고 명확하게 작성할 수 있다.\n","mtime":"2022-08-13T00:12:20.000+09:00","href":"velog/파이썬으로 동시성 프로그래밍을 쉽게 하는법 - 2","data":{"title":"파이썬으로 동시성 프로그래밍을 쉽게 하는법 - 2","date":"2021-11-29T18:42:54.419+09:00","tags":["anyio","async","python","@all"],"page":"파이썬 동시성 프로그래밍","summary":"anyio로 작업 생성 + 작업간 정보 주고받기"}},"next_post":{"name":"fastapi 튜토리얼 -1- 초기 설정","content":"\n**`fastapi`** 사용법을 다시 공부할겸, 참고할만한 좋은 [예제](https://www.jeffastor.com/blog/populating-cleaning-jobs-with-user-offers-in-fastapi)가 있어서 이 시리즈를 약간의 변경을 주고 따라가보려 한다.\n지난번처럼 어쩌다 그만둘 수도 있긴 하지만...\n\n---\n\n## 초기 설정\n\n### 파이썬 설정\n\n우선 다음 명령어로 가상 파이썬 환경부터 잡아줬다.\n\n```bash\n❯ pyenv virtualenv 3.10.4 jeffastor_tutor\n❯ pyenv local jeffastor_tutor\n```\n\n실제로는 **`docker`** 로 실행하겠지만, **`vscode`** 를 사용하면서 **`pylance`** 의 자동완성과 타입 추론 기능을 사용하기 위해, 따로 만들었다.\n\n그리고 필수 패키지와 개인적으로 선호하는 **`orjson`** 을 설치한다.\n\n```bash\n❯ poetry init\n❯ poetry add fastapi \"uvicorn[standard]\" orjson\n❯ poetry add --dev black isort\n❯ cat pyproject.toml\n[tool.poetry]\nname = \"jeffastor_tutor\"\nversion = \"0.1.0\"\ndescription = \"\"\nauthors = [\"phi \u003cphi.friday@gmail.com\u003e\"]\n\n[tool.poetry.dependencies]\npython = \"^3.10\"\nfastapi = \"^0.75.2\"\nuvicorn = {extras = [\"standard\"], version = \"^0.17.6\"}\norjson = \"^3.6.8\"\n\n[tool.poetry.dev-dependencies]\nblack = \"^22.3.0\"\nisort = \"^5.10.1\"\n\n[build-system]\nrequires = [\"poetry-core\u003e=1.0.0\"]\nbuild-backend = \"poetry.core.masonry.api\"\n```\n\n\u003e - fastapi - 백엔드 구축에 사용할 프레임워크\n\u003e - uvicorn - fastapi 앱을 사용하기 위한 asgi 서버\n\u003e - orjson - 좀 더 빠르고, 정확하고, 다양하게 파이썬 객체를 json으로 변환해주는 라이브러리\n\n### `fastapi` 기본 구성 설정\n\n**JeffAstor**가 제시한 디렉토리/모듈 구성은 대부분 그대로 가져갈 생각이다.\n\n```bash\n❯ mkdir backend backend/app backend/tests\n❯ mkdir backend/app/api backend/app/core\n❯ touch backend/app/api/__init__.py backend/app/api/server.py\n```\n\n```python\n# backend/app/api/server.py\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom fastapi.responses import ORJSONResponse\n\n\ndef get_application() -\u003e FastAPI:\n    app = FastAPI(title='jeffastor_tutor', default_response_class=ORJSONResponse)\n\n    app.add_middleware(\n        CORSMiddleware,\n        allow_origins=[\"*\"],\n        allow_credentials=True,\n        allow_methods=[\"*\"],\n        allow_headers=[\"*\"],\n    )\n    return app\n\napp = get_application()\n```\n\n`CORSMiddleware`에 대해서는 지금 신경쓸 필요 없으며, 나중에 관련해서 자세히 설명하겠다고 한다.\n\n`default_response_class`는 **`fastapi`** 의 `response`를 직렬화 할 때 **`orjson`** 을 사용하기 위해 `ORJSONResponse`를 지정했다.\n\n### `docker` 설정\n\n이제 서버를 실행할 **`docker`** 를 설정한다.\n\n```bash\n❯ poetry export -f requirements.txt --output backend/requirements.txt --without-hashes\n❯ touch docker-compose.yml backend/Dockerfile backend/.env\n```\n\n```Dockerfile\n# backend/Dockerfile\nFROM python:3.10-slim-bullseye\nWORKDIR /backend\nENV PYTHONDONTWRITEBYTECODE 1\nENV PYTHONBUFFERED 1\n# install system dependencies\n# RUN apt-get update \\\n#   \u0026\u0026 apt-get -y install netcat gcc postgresql \\\n#   \u0026\u0026 apt-get clean\n# install python dependencies\n# RUN pip install --upgrade pip\nCOPY ./requirements.txt /backend/requirements.txt\nRUN pip install -r requirements.txt\nCOPY . /backend\n```\n\n```yaml\n# docker-compose.yml\n# prettier-ignore\nversion: \"3.8\"\nservices:\n  server:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile\n    volumes:\n      - ./backend/:/backend/\n    command: uvicorn app.api.server:app --reload --workers 2 --host 0.0.0.0 --port 8000\n    env_file:\n      - ./backend/.env\n    ports:\n      - 8000:8000\n```\n\nsql 서버는 다른 컨테이너로 관리할 예정이기에 주석처리했다.\n\n이제 **`docker`** 를 실행해보자.\n\n```bash\n❯ docker-compose up --build\n\n```\n\n브라우저에서 `localhost:8000`에 접속해보면\n\n```yaml\n{ 'detail': 'Not Found' }\n```\n\n아직 아무런 라우터를 추가하지 않았기에 나오는 기본값이 출력된다.\n\n## 기본 라우터 생성\n\n서버를 중단하지 않고, 이어서 라우터를 추가한다.\n\n```bash\n❯ mkdir backend/app/api/routes\n❯ touch backend/app/api/routes/__init__.py\n❯ touch backend/app/api/routes/cleanings.py\n```\n\n```python\n# backend/app/api/routes/cleanings.py\nfrom fastapi import APIRouter\n\nrouter = APIRouter()\n\n@router.get(\"/\")\nasync def get_all_cleanings() -\u003e list[dict]:\n    cleanings = [\n        {\"id\": 1, \"name\": \"My house\", \"cleaning_type\": \"full_clean\", \"price_per_hour\": 29.99},\n        {\"id\": 2, \"name\": \"Someone else's house\", \"cleaning_type\": \"spot_clean\", \"price_per_hour\": 19.99}\n    ]\n    return cleanings\n```\n\n```python\n# backend/app/api/routes/__init__.py\nfrom fastapi import APIRouter\n\nfrom .cleanings import router as cleanings_router\n\nrouter = APIRouter()\n\nrouter.include_router(cleanings_router, prefix=\"/cleanings\", tags=[\"cleanings\"])\n```\n\n원문은 절대참조로 작성했지만, **`docker`** 실행 환경에서는 정상적으로 작동하지만, 편집 환경에서는 **`pylance`** 가 정상적으로 인식하지 못하므로 상대참조로 변경했다.\n\n끝으로 `get_application`함수를 수정한다.\n\n```python\n# backend/app/api/server.py\n(...)\nfrom .routes import router as api_router\n\n\ndef get_application() -\u003e FastAPI:\n    app = FastAPI(title='jeffastor_tutor', default_response_class=ORJSONResponse)\n\n    app.add_middleware(\n        CORSMiddleware,\n        allow_origins=[\"*\"],\n        allow_credentials=True,\n        allow_methods=[\"*\"],\n        allow_headers=[\"*\"],\n    )\n\n    app.include_router(api_router, prefix='/api')\n\n    return app\n(...)\n```\n\n**`uvicorn`** 의 `reload` 옵션을 켰기 때문에, 별다른 조작 없이 수정사항이 반영된 상태로 서버가 다시 실행된다. [http://localhost:8000/api/cleanings/](http://localhost:8000/api/cleanings/)에서 다음과 같은 결과를 확인할 수 있다.\n\n```yaml\n[\n  {\n    'id': 1,\n    'name': 'My house',\n    'cleaning_type': 'full_clean',\n    'price_per_hour': 29.99,\n  },\n  {\n    'id': 2,\n    'name': \"Someone else's house\",\n    'cleaning_type': 'spot_clean',\n    'price_per_hour': 19.99,\n  },\n]\n```\n\n다음 챕터에서는 sql 서버를 연결하고, **`pytest`** 를 이용하여 테스트를 진행한다.\n\n참고로, **`docker`** 로 실행된 서버는\n\n```bash\n❯ docker-compose down\n```\n\n으로 종료가 가능하다.\n","mtime":"2022-08-13T00:12:20.000+09:00","href":"velog/fastapi 튜토리얼 -1- 초기 설정","data":{"title":"fastapi 튜토리얼 -1- 초기 설정","date":"2022-04-27T23:30:14.239+09:00","tags":["fastapi","python","@all"],"page":"fastapi 튜토리얼","summary":"fastapi 사용법을 다시 공부할겸, 참고할만한 좋은 예제가 있어서 이 시리즈를 약간의 변경을 주고 따라가보려 한다."}},"page_posts":null},"__N_SSG":true},"page":"/posts/[...name]","query":{"name":["velog","파이썬 코드를 깔끔하게, 그리고 일관성 있게 작성하는법"]},"buildId":"MQ_lMVQgBI0RkmUA6wvVT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>