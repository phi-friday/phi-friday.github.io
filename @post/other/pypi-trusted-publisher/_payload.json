[{"data":1,"prerenderedAt":560},["ShallowReactive",2],{"selected_data_with_surround_/other/pypi-trusted-publisher":3},{"article":4,"surround":554},{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"tags":11,"date":15,"publish":16,"body":17,"_type":548,"_id":549,"_source":550,"_file":551,"_stem":552,"_extension":553},"/other/pypi-trusted-publisher","other",false,"","Github Action과 Trusted Publisher를 사용한 파이썬 패키지 배포 자동화","배포 자동화를 조금 더 안전하게",[12,13,14],"python","pypi","Trusted Publisher","2024-09-02T05:43:47.545Z",true,{"type":18,"children":19,"toc":541},"root",[20,29,44,165,170,218,224,231,251,260,268,280,294,300,317,328,509,530,535],{"type":21,"tag":22,"props":23,"children":25},"element","h2",{"id":24},"패키지-배포는-어렵지-않다",[26],{"type":27,"value":28},"text","패키지 배포는 어렵지 않다",{"type":21,"tag":30,"props":31,"children":32},"p",{},[33,35,42],{"type":27,"value":34},"파이썬 패키지를 배포하는 것은 굉장히 간단하다.\n",{"type":21,"tag":36,"props":37,"children":39},"code",{"className":38},[],[40],{"type":27,"value":41},"pyproject.toml",{"type":27,"value":43},"에 적합한 메타 데이터만 잘 입력되어 있다면,\n다음 명령어로 빌드와 배포를 할 수 있다.",{"type":21,"tag":45,"props":46,"children":50},"pre",{"className":47,"code":48,"language":49,"meta":8,"style":8},"language-bash shiki shiki-themes github-light github-dark","$ python -m build\n$ python -m twine upload dist/* --non-interactive --username __token__ --password \u003Cpypi 토큰>\n","bash",[51],{"type":21,"tag":36,"props":52,"children":53},{"__ignoreMap":8},[54,83],{"type":21,"tag":55,"props":56,"children":59},"span",{"class":57,"line":58},"line",1,[60,66,72,78],{"type":21,"tag":55,"props":61,"children":63},{"style":62},"--shiki-default:#6F42C1;--shiki-dark:#B392F0",[64],{"type":27,"value":65},"$",{"type":21,"tag":55,"props":67,"children":69},{"style":68},"--shiki-default:#032F62;--shiki-dark:#9ECBFF",[70],{"type":27,"value":71}," python",{"type":21,"tag":55,"props":73,"children":75},{"style":74},"--shiki-default:#005CC5;--shiki-dark:#79B8FF",[76],{"type":27,"value":77}," -m",{"type":21,"tag":55,"props":79,"children":80},{"style":68},[81],{"type":27,"value":82}," build\n",{"type":21,"tag":55,"props":84,"children":86},{"class":57,"line":85},2,[87,91,95,99,104,109,114,119,124,129,134,139,145,149,154,160],{"type":21,"tag":55,"props":88,"children":89},{"style":62},[90],{"type":27,"value":65},{"type":21,"tag":55,"props":92,"children":93},{"style":68},[94],{"type":27,"value":71},{"type":21,"tag":55,"props":96,"children":97},{"style":74},[98],{"type":27,"value":77},{"type":21,"tag":55,"props":100,"children":101},{"style":68},[102],{"type":27,"value":103}," twine",{"type":21,"tag":55,"props":105,"children":106},{"style":68},[107],{"type":27,"value":108}," upload",{"type":21,"tag":55,"props":110,"children":111},{"style":68},[112],{"type":27,"value":113}," dist/",{"type":21,"tag":55,"props":115,"children":116},{"style":74},[117],{"type":27,"value":118},"*",{"type":21,"tag":55,"props":120,"children":121},{"style":74},[122],{"type":27,"value":123}," --non-interactive",{"type":21,"tag":55,"props":125,"children":126},{"style":74},[127],{"type":27,"value":128}," --username",{"type":21,"tag":55,"props":130,"children":131},{"style":68},[132],{"type":27,"value":133}," __token__",{"type":21,"tag":55,"props":135,"children":136},{"style":74},[137],{"type":27,"value":138}," --password",{"type":21,"tag":55,"props":140,"children":142},{"style":141},"--shiki-default:#D73A49;--shiki-dark:#F97583",[143],{"type":27,"value":144}," \u003C",{"type":21,"tag":55,"props":146,"children":147},{"style":68},[148],{"type":27,"value":13},{"type":21,"tag":55,"props":150,"children":151},{"style":68},[152],{"type":27,"value":153}," 토",{"type":21,"tag":55,"props":155,"children":157},{"style":156},"--shiki-default:#24292E;--shiki-dark:#E1E4E8",[158],{"type":27,"value":159},"큰",{"type":21,"tag":55,"props":161,"children":162},{"style":141},[163],{"type":27,"value":164},">\n",{"type":21,"tag":30,"props":166,"children":167},{},[168],{"type":27,"value":169},"하지만 보안상 아쉬운 부분이 있는데, 바로 토큰 발행과 보관이다.\n보통 배포를 위한 토큰은 한번 발행하고 오래 사용하게 되는데,\n만약 그 토큰이 제 3자에게 노출된다면, 이는 굉장한 보안 위협으로 다가올 수 있다.",{"type":21,"tag":30,"props":171,"children":172},{},[173,175,180,182,195,197,202,204,209,211,216],{"type":27,"value":174},"이를 해결하기 위해 ",{"type":21,"tag":36,"props":176,"children":178},{"className":177},[],[179],{"type":27,"value":13},{"type":27,"value":181},"에서 제시하는 방법은 ",{"type":21,"tag":183,"props":184,"children":188},"a",{"href":185,"rel":186},"https://openid.net/connect/",[187],"nofollow",[189],{"type":21,"tag":36,"props":190,"children":192},{"className":191},[],[193],{"type":27,"value":194},"OIDC",{"type":27,"value":196},"를 사용하는 것이며,\n이때 ",{"type":21,"tag":36,"props":198,"children":200},{"className":199},[],[201],{"type":27,"value":13},{"type":27,"value":203},"에서 사용하는 ",{"type":21,"tag":36,"props":205,"children":207},{"className":206},[],[208],{"type":27,"value":194},{"type":27,"value":210},"를 ",{"type":21,"tag":36,"props":212,"children":214},{"className":213},[],[215],{"type":27,"value":14},{"type":27,"value":217},"라고 한다.",{"type":21,"tag":22,"props":219,"children":221},{"id":220},"trusted-publisher를-사용하는-방법",[222],{"type":27,"value":223},"Trusted Publisher를 사용하는 방법",{"type":21,"tag":225,"props":226,"children":228},"h3",{"id":227},"_1-trusted-publisher-설정",[229],{"type":27,"value":230},"1. Trusted Publisher 설정",{"type":21,"tag":30,"props":232,"children":233},{},[234,236,241,243,249],{"type":27,"value":235},"이미 배포된 적 있는 패키지라면 다음 ",{"type":21,"tag":36,"props":237,"children":239},{"className":238},[],[240],{"type":27,"value":13},{"type":27,"value":242}," 설정 화면에서 현재 사용중인 ",{"type":21,"tag":36,"props":244,"children":246},{"className":245},[],[247],{"type":27,"value":248},"CI",{"type":27,"value":250}," 서비스를 추가할 수 있다.",{"type":21,"tag":30,"props":252,"children":253},{},[254],{"type":21,"tag":255,"props":256,"children":259},"img",{"alt":257,"src":258},"settings-0","/images/other/pypi-trusted-publisher/pypi-trusted-publisher-0.png",[],{"type":21,"tag":30,"props":261,"children":262},{},[263],{"type":21,"tag":255,"props":264,"children":267},{"alt":265,"src":266},"settings-1","/images/other/pypi-trusted-publisher/pypi-trusted-publisher-1.png",[],{"type":21,"tag":30,"props":269,"children":270},{},[271,278],{"type":21,"tag":183,"props":272,"children":275},{"href":273,"rel":274},"https://docs.pypi.org/trusted-publishers/",[187],[276],{"type":27,"value":277},"공식 문서",{"type":27,"value":279},"에 굉장히 상세하게 작성되어 있으므로, 더 알아보고 싶다면 공식 문서를 확인하면 된다.",{"type":21,"tag":30,"props":281,"children":282},{},[283,285,292],{"type":27,"value":284},"신규 프로젝트를 생성하면서 ",{"type":21,"tag":183,"props":286,"children":289},{"href":287,"rel":288},"https://docs.pypi.org/trusted-publishers/creating-a-project-through-oidc/",[187],[290],{"type":27,"value":291},"함께 적용",{"type":27,"value":293},"할 수도 있다.",{"type":21,"tag":225,"props":295,"children":297},{"id":296},"_2-trusted-publisher-적용",[298],{"type":27,"value":299},"2. Trusted Publisher 적용",{"type":21,"tag":30,"props":301,"children":302},{},[303,308,310,315],{"type":21,"tag":36,"props":304,"children":306},{"className":305},[],[307],{"type":27,"value":14},{"type":27,"value":309},"로 지정한 ",{"type":21,"tag":36,"props":311,"children":313},{"className":312},[],[314],{"type":27,"value":248},{"type":27,"value":316},"서비스에서 토큰을 발행하여 배포가 가능하도록 수정해야한다.",{"type":21,"tag":30,"props":318,"children":319},{},[320,326],{"type":21,"tag":36,"props":321,"children":323},{"className":322},[],[324],{"type":27,"value":325},"Github Action",{"type":27,"value":327},"의 경우 다음과 같은 항목을 추가하면 된다.",{"type":21,"tag":45,"props":329,"children":333},{"className":330,"code":331,"language":332,"meta":8,"style":8},"language-yaml shiki shiki-themes github-light github-dark","# 생략\njobs:\n  publish:\n    # 생략\n    environment: # Trusted Publisher 설정에서 지정한 환경(지정하지 않았다면 생략)\n    permissions:\n      id-token: write # 필수\n\n    steps:\n      # 빌드 과정 생략(필수)\n      - name: Publish package distributions to PyPI\n        uses: pypa/gh-action-pypi-publish@release/v1\n","yaml",[334],{"type":21,"tag":36,"props":335,"children":336},{"__ignoreMap":8},[337,346,360,373,382,401,414,437,446,459,468,491],{"type":21,"tag":55,"props":338,"children":339},{"class":57,"line":58},[340],{"type":21,"tag":55,"props":341,"children":343},{"style":342},"--shiki-default:#6A737D;--shiki-dark:#6A737D",[344],{"type":27,"value":345},"# 생략\n",{"type":21,"tag":55,"props":347,"children":348},{"class":57,"line":85},[349,355],{"type":21,"tag":55,"props":350,"children":352},{"style":351},"--shiki-default:#22863A;--shiki-dark:#85E89D",[353],{"type":27,"value":354},"jobs",{"type":21,"tag":55,"props":356,"children":357},{"style":156},[358],{"type":27,"value":359},":\n",{"type":21,"tag":55,"props":361,"children":363},{"class":57,"line":362},3,[364,369],{"type":21,"tag":55,"props":365,"children":366},{"style":351},[367],{"type":27,"value":368},"  publish",{"type":21,"tag":55,"props":370,"children":371},{"style":156},[372],{"type":27,"value":359},{"type":21,"tag":55,"props":374,"children":376},{"class":57,"line":375},4,[377],{"type":21,"tag":55,"props":378,"children":379},{"style":342},[380],{"type":27,"value":381},"    # 생략\n",{"type":21,"tag":55,"props":383,"children":385},{"class":57,"line":384},5,[386,391,396],{"type":21,"tag":55,"props":387,"children":388},{"style":351},[389],{"type":27,"value":390},"    environment",{"type":21,"tag":55,"props":392,"children":393},{"style":156},[394],{"type":27,"value":395},": ",{"type":21,"tag":55,"props":397,"children":398},{"style":342},[399],{"type":27,"value":400},"# Trusted Publisher 설정에서 지정한 환경(지정하지 않았다면 생략)\n",{"type":21,"tag":55,"props":402,"children":404},{"class":57,"line":403},6,[405,410],{"type":21,"tag":55,"props":406,"children":407},{"style":351},[408],{"type":27,"value":409},"    permissions",{"type":21,"tag":55,"props":411,"children":412},{"style":156},[413],{"type":27,"value":359},{"type":21,"tag":55,"props":415,"children":417},{"class":57,"line":416},7,[418,423,427,432],{"type":21,"tag":55,"props":419,"children":420},{"style":351},[421],{"type":27,"value":422},"      id-token",{"type":21,"tag":55,"props":424,"children":425},{"style":156},[426],{"type":27,"value":395},{"type":21,"tag":55,"props":428,"children":429},{"style":68},[430],{"type":27,"value":431},"write",{"type":21,"tag":55,"props":433,"children":434},{"style":342},[435],{"type":27,"value":436}," # 필수\n",{"type":21,"tag":55,"props":438,"children":440},{"class":57,"line":439},8,[441],{"type":21,"tag":55,"props":442,"children":443},{"emptyLinePlaceholder":16},[444],{"type":27,"value":445},"\n",{"type":21,"tag":55,"props":447,"children":449},{"class":57,"line":448},9,[450,455],{"type":21,"tag":55,"props":451,"children":452},{"style":351},[453],{"type":27,"value":454},"    steps",{"type":21,"tag":55,"props":456,"children":457},{"style":156},[458],{"type":27,"value":359},{"type":21,"tag":55,"props":460,"children":462},{"class":57,"line":461},10,[463],{"type":21,"tag":55,"props":464,"children":465},{"style":342},[466],{"type":27,"value":467},"      # 빌드 과정 생략(필수)\n",{"type":21,"tag":55,"props":469,"children":471},{"class":57,"line":470},11,[472,477,482,486],{"type":21,"tag":55,"props":473,"children":474},{"style":156},[475],{"type":27,"value":476},"      - ",{"type":21,"tag":55,"props":478,"children":479},{"style":351},[480],{"type":27,"value":481},"name",{"type":21,"tag":55,"props":483,"children":484},{"style":156},[485],{"type":27,"value":395},{"type":21,"tag":55,"props":487,"children":488},{"style":68},[489],{"type":27,"value":490},"Publish package distributions to PyPI\n",{"type":21,"tag":55,"props":492,"children":494},{"class":57,"line":493},12,[495,500,504],{"type":21,"tag":55,"props":496,"children":497},{"style":351},[498],{"type":27,"value":499},"        uses",{"type":21,"tag":55,"props":501,"children":502},{"style":156},[503],{"type":27,"value":395},{"type":21,"tag":55,"props":505,"children":506},{"style":68},[507],{"type":27,"value":508},"pypa/gh-action-pypi-publish@release/v1\n",{"type":21,"tag":30,"props":510,"children":511},{},[512,514,520,522,528],{"type":27,"value":513},"빌드 과정은 다른 ",{"type":21,"tag":36,"props":515,"children":517},{"className":516},[],[518],{"type":27,"value":519},"step",{"type":27,"value":521},"에서 이미 실행이 되어 있어야 하며,\n빌드 결과물은 ",{"type":21,"tag":36,"props":523,"children":525},{"className":524},[],[526],{"type":27,"value":527},"dist/*",{"type":27,"value":529}," 하위 경로에 있어야 한다.",{"type":21,"tag":30,"props":531,"children":532},{},[533],{"type":27,"value":534},"이 설정만으로 토큰 발행부터 배포, 토큰 말소까지 자동으로 진행된다.",{"type":21,"tag":536,"props":537,"children":538},"style",{},[539],{"type":27,"value":540},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":8,"searchDepth":384,"depth":384,"links":542},[543,544],{"id":24,"depth":85,"text":28},{"id":220,"depth":85,"text":223,"children":545},[546,547],{"id":227,"depth":362,"text":230},{"id":296,"depth":362,"text":299},"markdown","content:other:pypi-trusted-publisher.md","content","other/pypi-trusted-publisher.md","other/pypi-trusted-publisher","md",[555,556],null,{"_path":557,"title":558,"description":559},"/python/airflow2","airflow에서 간단하게 Task를 스킵하는 방법","TaskFlow API를 사용한다면, `skip_if`와 `run_if`를 사용하자",1725258390897]