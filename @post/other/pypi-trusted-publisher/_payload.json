[{"data":1,"prerenderedAt":553},["ShallowReactive",2],{"selected_data_with_surround_/other/pypi-trusted-publisher":3},{"article":4,"surround":544},{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"tags":11,"date":15,"publish":16,"body":17,"_type":538,"_id":539,"_source":540,"_file":541,"_stem":542,"_extension":543},"/other/pypi-trusted-publisher","other",false,"","Github Action과 Trusted Publisher를 사용한 파이썬 패키지 배포 자동화","배포 자동화를 조금 더 안전하게",[12,13,14],"python","pypi","Trusted Publisher","2024-09-02T05:43:47.545Z",true,{"type":18,"children":19,"toc":531},"root",[20,29,44,155,160,208,214,221,241,250,258,270,284,290,307,318,499,520,525],{"type":21,"tag":22,"props":23,"children":25},"element","h2",{"id":24},"패키지-배포는-어렵지-않다",[26],{"type":27,"value":28},"text","패키지 배포는 어렵지 않다",{"type":21,"tag":30,"props":31,"children":32},"p",{},[33,35,42],{"type":27,"value":34},"파이썬 패키지를 배포하는 것은 굉장히 간단하다.\n",{"type":21,"tag":36,"props":37,"children":39},"code",{"className":38},[],[40],{"type":27,"value":41},"pyproject.toml",{"type":27,"value":43},"에 적합한 메타 데이터만 잘 입력되어 있다면,\n다음 명령어로 빌드와 배포를 할 수 있다.",{"type":21,"tag":45,"props":46,"children":50},"pre",{"className":47,"code":48,"language":49,"meta":8,"style":8},"language-bash shiki shiki-themes github-light github-dark","python -m build\npython -m twine upload dist/* --non-interactive --username __token__ --password \u003Cpypi 토큰>\n","bash",[51],{"type":21,"tag":36,"props":52,"children":53},{"__ignoreMap":8},[54,77],{"type":21,"tag":55,"props":56,"children":59},"span",{"class":57,"line":58},"line",1,[60,65,71],{"type":21,"tag":55,"props":61,"children":63},{"style":62},"--shiki-default:#6F42C1;--shiki-dark:#B392F0",[64],{"type":27,"value":12},{"type":21,"tag":55,"props":66,"children":68},{"style":67},"--shiki-default:#005CC5;--shiki-dark:#79B8FF",[69],{"type":27,"value":70}," -m",{"type":21,"tag":55,"props":72,"children":74},{"style":73},"--shiki-default:#032F62;--shiki-dark:#9ECBFF",[75],{"type":27,"value":76}," build\n",{"type":21,"tag":55,"props":78,"children":80},{"class":57,"line":79},2,[81,85,89,94,99,104,109,114,119,124,129,135,139,144,150],{"type":21,"tag":55,"props":82,"children":83},{"style":62},[84],{"type":27,"value":12},{"type":21,"tag":55,"props":86,"children":87},{"style":67},[88],{"type":27,"value":70},{"type":21,"tag":55,"props":90,"children":91},{"style":73},[92],{"type":27,"value":93}," twine",{"type":21,"tag":55,"props":95,"children":96},{"style":73},[97],{"type":27,"value":98}," upload",{"type":21,"tag":55,"props":100,"children":101},{"style":73},[102],{"type":27,"value":103}," dist/",{"type":21,"tag":55,"props":105,"children":106},{"style":67},[107],{"type":27,"value":108},"*",{"type":21,"tag":55,"props":110,"children":111},{"style":67},[112],{"type":27,"value":113}," --non-interactive",{"type":21,"tag":55,"props":115,"children":116},{"style":67},[117],{"type":27,"value":118}," --username",{"type":21,"tag":55,"props":120,"children":121},{"style":73},[122],{"type":27,"value":123}," __token__",{"type":21,"tag":55,"props":125,"children":126},{"style":67},[127],{"type":27,"value":128}," --password",{"type":21,"tag":55,"props":130,"children":132},{"style":131},"--shiki-default:#D73A49;--shiki-dark:#F97583",[133],{"type":27,"value":134}," \u003C",{"type":21,"tag":55,"props":136,"children":137},{"style":73},[138],{"type":27,"value":13},{"type":21,"tag":55,"props":140,"children":141},{"style":73},[142],{"type":27,"value":143}," 토",{"type":21,"tag":55,"props":145,"children":147},{"style":146},"--shiki-default:#24292E;--shiki-dark:#E1E4E8",[148],{"type":27,"value":149},"큰",{"type":21,"tag":55,"props":151,"children":152},{"style":131},[153],{"type":27,"value":154},">\n",{"type":21,"tag":30,"props":156,"children":157},{},[158],{"type":27,"value":159},"하지만 보안상 아쉬운 부분이 있는데, 바로 토큰 발행과 보관이다.\n보통 배포를 위한 토큰은 한번 발행하고 오래 사용하게 되는데,\n만약 그 토큰이 제 3자에게 노출된다면, 이는 굉장한 보안 위협으로 다가올 수 있다.",{"type":21,"tag":30,"props":161,"children":162},{},[163,165,170,172,185,187,192,194,199,201,206],{"type":27,"value":164},"이를 해결하기 위해 ",{"type":21,"tag":36,"props":166,"children":168},{"className":167},[],[169],{"type":27,"value":13},{"type":27,"value":171},"에서 제시하는 방법은 ",{"type":21,"tag":173,"props":174,"children":178},"a",{"href":175,"rel":176},"https://openid.net/connect/",[177],"nofollow",[179],{"type":21,"tag":36,"props":180,"children":182},{"className":181},[],[183],{"type":27,"value":184},"OIDC",{"type":27,"value":186},"를 사용하는 것이며,\n이때 ",{"type":21,"tag":36,"props":188,"children":190},{"className":189},[],[191],{"type":27,"value":13},{"type":27,"value":193},"에서 사용하는 ",{"type":21,"tag":36,"props":195,"children":197},{"className":196},[],[198],{"type":27,"value":184},{"type":27,"value":200},"를 ",{"type":21,"tag":36,"props":202,"children":204},{"className":203},[],[205],{"type":27,"value":14},{"type":27,"value":207},"라고 한다.",{"type":21,"tag":22,"props":209,"children":211},{"id":210},"trusted-publisher를-사용하는-방법",[212],{"type":27,"value":213},"Trusted Publisher를 사용하는 방법",{"type":21,"tag":215,"props":216,"children":218},"h3",{"id":217},"_1-trusted-publisher-설정",[219],{"type":27,"value":220},"1. Trusted Publisher 설정",{"type":21,"tag":30,"props":222,"children":223},{},[224,226,231,233,239],{"type":27,"value":225},"이미 배포된 적 있는 패키지라면 다음 ",{"type":21,"tag":36,"props":227,"children":229},{"className":228},[],[230],{"type":27,"value":13},{"type":27,"value":232}," 설정 화면에서 현재 사용중인 ",{"type":21,"tag":36,"props":234,"children":236},{"className":235},[],[237],{"type":27,"value":238},"CI",{"type":27,"value":240}," 서비스를 추가할 수 있다.",{"type":21,"tag":30,"props":242,"children":243},{},[244],{"type":21,"tag":245,"props":246,"children":249},"img",{"alt":247,"src":248},"settings-0","../../public/images/other/pypi-trusted-publisher/pypi-trusted-publisher-0.png",[],{"type":21,"tag":30,"props":251,"children":252},{},[253],{"type":21,"tag":245,"props":254,"children":257},{"alt":255,"src":256},"settings-1","../../public/images/other/pypi-trusted-publisher/pypi-trusted-publisher-1.png",[],{"type":21,"tag":30,"props":259,"children":260},{},[261,268],{"type":21,"tag":173,"props":262,"children":265},{"href":263,"rel":264},"https://docs.pypi.org/trusted-publishers/",[177],[266],{"type":27,"value":267},"공식 문서",{"type":27,"value":269},"에 굉장히 상세하게 작성되어 있으므로, 더 알아보고 싶다면 공식 문서를 확인하면 된다.",{"type":21,"tag":30,"props":271,"children":272},{},[273,275,282],{"type":27,"value":274},"신규 프로젝트를 생성하면서 ",{"type":21,"tag":173,"props":276,"children":279},{"href":277,"rel":278},"https://docs.pypi.org/trusted-publishers/creating-a-project-through-oidc/",[177],[280],{"type":27,"value":281},"함께 적용",{"type":27,"value":283},"할 수도 있다.",{"type":21,"tag":215,"props":285,"children":287},{"id":286},"_2-trusted-publisher-적용",[288],{"type":27,"value":289},"2. Trusted Publisher 적용",{"type":21,"tag":30,"props":291,"children":292},{},[293,298,300,305],{"type":21,"tag":36,"props":294,"children":296},{"className":295},[],[297],{"type":27,"value":14},{"type":27,"value":299},"로 지정한 ",{"type":21,"tag":36,"props":301,"children":303},{"className":302},[],[304],{"type":27,"value":238},{"type":27,"value":306},"서비스에서 토큰을 발행하여 배포가 가능하도록 수정해야한다.",{"type":21,"tag":30,"props":308,"children":309},{},[310,316],{"type":21,"tag":36,"props":311,"children":313},{"className":312},[],[314],{"type":27,"value":315},"Github Action",{"type":27,"value":317},"의 경우 다음과 같은 항목을 추가하면 된다.",{"type":21,"tag":45,"props":319,"children":323},{"className":320,"code":321,"language":322,"meta":8,"style":8},"language-yaml shiki shiki-themes github-light github-dark","# 생략\njobs:\n  publish:\n    # 생략\n    environment: # Trusted Publisher 설정에서 지정한 환경(지정하지 않았다면 생략)\n    permissions:\n      id-token: write # 필수\n\n    steps:\n      # 빌드 과정 생략(필수)\n      - name: Publish package distributions to PyPI\n        uses: pypa/gh-action-pypi-publish@release/v1\n","yaml",[324],{"type":21,"tag":36,"props":325,"children":326},{"__ignoreMap":8},[327,336,350,363,372,391,404,427,436,449,458,481],{"type":21,"tag":55,"props":328,"children":329},{"class":57,"line":58},[330],{"type":21,"tag":55,"props":331,"children":333},{"style":332},"--shiki-default:#6A737D;--shiki-dark:#6A737D",[334],{"type":27,"value":335},"# 생략\n",{"type":21,"tag":55,"props":337,"children":338},{"class":57,"line":79},[339,345],{"type":21,"tag":55,"props":340,"children":342},{"style":341},"--shiki-default:#22863A;--shiki-dark:#85E89D",[343],{"type":27,"value":344},"jobs",{"type":21,"tag":55,"props":346,"children":347},{"style":146},[348],{"type":27,"value":349},":\n",{"type":21,"tag":55,"props":351,"children":353},{"class":57,"line":352},3,[354,359],{"type":21,"tag":55,"props":355,"children":356},{"style":341},[357],{"type":27,"value":358},"  publish",{"type":21,"tag":55,"props":360,"children":361},{"style":146},[362],{"type":27,"value":349},{"type":21,"tag":55,"props":364,"children":366},{"class":57,"line":365},4,[367],{"type":21,"tag":55,"props":368,"children":369},{"style":332},[370],{"type":27,"value":371},"    # 생략\n",{"type":21,"tag":55,"props":373,"children":375},{"class":57,"line":374},5,[376,381,386],{"type":21,"tag":55,"props":377,"children":378},{"style":341},[379],{"type":27,"value":380},"    environment",{"type":21,"tag":55,"props":382,"children":383},{"style":146},[384],{"type":27,"value":385},": ",{"type":21,"tag":55,"props":387,"children":388},{"style":332},[389],{"type":27,"value":390},"# Trusted Publisher 설정에서 지정한 환경(지정하지 않았다면 생략)\n",{"type":21,"tag":55,"props":392,"children":394},{"class":57,"line":393},6,[395,400],{"type":21,"tag":55,"props":396,"children":397},{"style":341},[398],{"type":27,"value":399},"    permissions",{"type":21,"tag":55,"props":401,"children":402},{"style":146},[403],{"type":27,"value":349},{"type":21,"tag":55,"props":405,"children":407},{"class":57,"line":406},7,[408,413,417,422],{"type":21,"tag":55,"props":409,"children":410},{"style":341},[411],{"type":27,"value":412},"      id-token",{"type":21,"tag":55,"props":414,"children":415},{"style":146},[416],{"type":27,"value":385},{"type":21,"tag":55,"props":418,"children":419},{"style":73},[420],{"type":27,"value":421},"write",{"type":21,"tag":55,"props":423,"children":424},{"style":332},[425],{"type":27,"value":426}," # 필수\n",{"type":21,"tag":55,"props":428,"children":430},{"class":57,"line":429},8,[431],{"type":21,"tag":55,"props":432,"children":433},{"emptyLinePlaceholder":16},[434],{"type":27,"value":435},"\n",{"type":21,"tag":55,"props":437,"children":439},{"class":57,"line":438},9,[440,445],{"type":21,"tag":55,"props":441,"children":442},{"style":341},[443],{"type":27,"value":444},"    steps",{"type":21,"tag":55,"props":446,"children":447},{"style":146},[448],{"type":27,"value":349},{"type":21,"tag":55,"props":450,"children":452},{"class":57,"line":451},10,[453],{"type":21,"tag":55,"props":454,"children":455},{"style":332},[456],{"type":27,"value":457},"      # 빌드 과정 생략(필수)\n",{"type":21,"tag":55,"props":459,"children":461},{"class":57,"line":460},11,[462,467,472,476],{"type":21,"tag":55,"props":463,"children":464},{"style":146},[465],{"type":27,"value":466},"      - ",{"type":21,"tag":55,"props":468,"children":469},{"style":341},[470],{"type":27,"value":471},"name",{"type":21,"tag":55,"props":473,"children":474},{"style":146},[475],{"type":27,"value":385},{"type":21,"tag":55,"props":477,"children":478},{"style":73},[479],{"type":27,"value":480},"Publish package distributions to PyPI\n",{"type":21,"tag":55,"props":482,"children":484},{"class":57,"line":483},12,[485,490,494],{"type":21,"tag":55,"props":486,"children":487},{"style":341},[488],{"type":27,"value":489},"        uses",{"type":21,"tag":55,"props":491,"children":492},{"style":146},[493],{"type":27,"value":385},{"type":21,"tag":55,"props":495,"children":496},{"style":73},[497],{"type":27,"value":498},"pypa/gh-action-pypi-publish@release/v1\n",{"type":21,"tag":30,"props":500,"children":501},{},[502,504,510,512,518],{"type":27,"value":503},"빌드 과정은 다른 ",{"type":21,"tag":36,"props":505,"children":507},{"className":506},[],[508],{"type":27,"value":509},"step",{"type":27,"value":511},"에서 이미 실행이 되어 있어야 하며,\n빌드 결과물은 ",{"type":21,"tag":36,"props":513,"children":515},{"className":514},[],[516],{"type":27,"value":517},"dist/*",{"type":27,"value":519}," 하위 경로에 있어야 한다.",{"type":21,"tag":30,"props":521,"children":522},{},[523],{"type":27,"value":524},"이 설정만으로 토큰 발행부터 배포, 토큰 말소까지 자동으로 진행된다.",{"type":21,"tag":526,"props":527,"children":528},"style",{},[529],{"type":27,"value":530},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":8,"searchDepth":374,"depth":374,"links":532},[533,534],{"id":24,"depth":79,"text":28},{"id":210,"depth":79,"text":213,"children":535},[536,537],{"id":217,"depth":352,"text":220},{"id":286,"depth":352,"text":289},"markdown","content:other:pypi-trusted-publisher.md","content","other/pypi-trusted-publisher.md","other/pypi-trusted-publisher","md",[545,549],{"_path":546,"title":547,"description":548},"/python/use_uv","poetry, rye 대신 uv를 사용하자","rye 개발진이 넘어가래요",{"_path":550,"title":551,"description":552},"/python/airflow2","airflow에서 간단하게 Task를 스킵하는 방법","TaskFlow API를 사용한다면, `skip_if`와 `run_if`를 사용하자",1726213404173]