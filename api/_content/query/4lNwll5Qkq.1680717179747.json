{"_path":"/other/wsl2-pid-1-systemd","_dir":"other","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"wsl2에서 pid 1을 systemd로 변경하기","description":"잘 만들어놓은 배포판을 가져다 쓰자","tags":["windows","wsl"],"page":null,"date":"2022-08-14T22:13:27.850+09:00","publish":true,"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"systemd로-인한-에러"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"systemd"}]},{"type":"text","value":"로 인한 에러"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wsl2"}]},{"type":"text","value":"(이하 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wsl"}]},{"type":"text","value":")를 그냥 실행할 경우, 다음과 같은 에러를 겪을 때가 있다."}]},{"type":"element","tag":"code","props":{"code":"System has not been booted with systemd as init system (PID 1). Can't operate.\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"System"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"has"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"not"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"been"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"booted"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"with"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"systemd"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"init"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"system"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"PID"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"). "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"Can't operate."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이는 pid 1번이 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"systemd"}]},{"type":"text","value":" 가 아니어서 생기는 문제로, 해결하기 위해서는 "},{"type":"element","tag":"a","props":{"href":"https://github.com/arkane-systems/genie","rel":["nofollow"]},"children":[{"type":"text","value":"genie"}]},{"type":"text","value":"와 같은 별도의 프로그램을 실행해줘야 했다. 하지만 최근 처음부터 이를 해결한 상태로 wsl을 실행하는 프로젝트를 발견했는데, 바로 "},{"type":"element","tag":"a","props":{"href":"https://github.com/nullpo-head/wsl-distrod","rel":["nofollow"]},"children":[{"type":"text","value":"Distrod"}]},{"type":"text","value":"다."}]},{"type":"element","tag":"h1","props":{"id":"distrod를-사용하자"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Distrod"}]},{"type":"text","value":"를 사용하자"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Distrod"}]},{"type":"text","value":"를 설치하는 방법은 크게 두가지로 나뉘는데,\n하나는 이미 해당 패치가 적용된 배포판을 사용하거나,\n기존에 사용하던 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wsl"}]},{"type":"text","value":"환경에 해당 패치를 적용하는 것이다."}]},{"type":"element","tag":"h2","props":{"id":"신규-설치"},"children":[{"type":"text","value":"신규 설치"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/nullpo-head/wsl-distrod/releases/latest/download/distrod_wsl_launcher-x86_64.zip","rel":["nofollow"]},"children":[{"type":"text","value":"링크"}]},{"type":"text","value":"의 압축 파일을 해제하면, 단일 exe 파일이 존재하는데, 해당 실행 파일을 실행시키면 끝이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"굉장히 다양한 배포판(아치, 데비안, 젠투, 보이드 등)을 지원하기에, 대부분의 경우, 선택권을 제한당한다는 기분은 느끼지 못할 것이다."}]},{"type":"element","tag":"h2","props":{"id":"기존-환경에-패치"},"children":[{"type":"text","value":"기존 환경에 패치"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이것 또한 아주 간단하다."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"패치 스크립트를 다운로드 한 다음, 실행한다.(아직 적용되지 않았다.)"}]}]},{"type":"element","tag":"code","props":{"code":"curl -L -O \"https://raw.githubusercontent.com/nullpo-head/wsl-distrod/main/install.sh\"\nchmod +x install.sh\nsudo ./install.sh install\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"-L"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"-O"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"\"https://raw.githubusercontent.com/nullpo-head/wsl-distrod/main/install.sh\""}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"chmod"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"+x"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"install.sh"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"./install.sh"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"install"}]}]}]}]}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"wsl이 처음 실행됐을 때, 다음 명령어를 관리자 권한으로 실행하던가,"}]}]},{"type":"element","tag":"code","props":{"code":"/opt/distrod/bin/distrod enable\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"/opt/distrod/bin/distrod"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"enable"}]}]}]}]}]},{"type":"element","tag":"ol","props":{"start":3},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"또는 다음 명령어로 윈도우 스케쥴러에 자동으로 해당 패치가 정상적으로 실행될 수 있도록 한다."}]}]},{"type":"element","tag":"code","props":{"code":"/opt/distrod/bin/distrod enable --start-on-windows-boot\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"/opt/distrod/bin/distrod"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"enable"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"--start-on-windows-boot"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이제 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ps -ef | head -n 2"}]},{"type":"text","value":"으로 확인해보면,"}]},{"type":"element","tag":"code","props":{"code":"UID          PID    PPID  C STIME TTY          TIME CMD\nroot           1       0  0 21:34 ?        00:00:00 /sbin/init systemd.setenv=WSL_DISTRO_NAME=Distrod systemd.setenv=WSL_INTEROP=/run/WSL/11_interop systemd.setenv=WSLENV=WT_SESSION::WT_PROFILE_ID --unit=multi-user.target\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"UID"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"PID"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"PPID"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"C"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"STIME"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"TTY"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"TIME"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"CMD"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cae142"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"           "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"       "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"21"}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"34"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"?"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-c029aa"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-c029aa"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-c029aa"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"/sbin/init"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"systemd.setenv=WSL_DISTRO_NAME=Distrod"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"systemd.setenv=WSL_INTEROP=/run/WSL/11_interop"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d62beb"},"children":[{"type":"text","value":"systemd.setenv=WSLENV=WT_SESSION::WT_PROFILE_ID"}]},{"type":"element","tag":"span","props":{"class":"ct-dd6b17"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-752f26"},"children":[{"type":"text","value":"--unit=multi-user.target"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"위와 같이 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"distrod"}]},{"type":"text","value":"의 패치가 적용된 것을 확인할 수 있다."}]},{"type":"element","tag":"h2","props":{"id":"윈도우11은-주의"},"children":[{"type":"text","value":"윈도우11은 주의"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"distrod"}]},{"type":"text","value":"의 기능 중, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wsl"}]},{"type":"text","value":"의 특정 포트를 외부로 포워딩 할 수 있는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"portproxy"}]},{"type":"text","value":"라는 서비스가 있는데, 윈도우 11에서는 정상적으로 작동하지 않는 "},{"type":"element","tag":"a","props":{"href":"https://github.com/nullpo-head/wsl-distrod/blob/main/docs/references.md#know-bugs","rel":["nofollow"]},"children":[{"type":"text","value":"버그"}]},{"type":"text","value":"가 있다고 한다."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-c029aa{color:#CF222E}\n.ct-752f26{color:#0550AE}\n.ct-d62beb{color:#0A3069}\n.ct-dd6b17{color:#24292F}\n.ct-cae142{color:#953800}\n.dark .ct-cae142{color:#FFA657}\n.dark .ct-dd6b17{color:#C9D1D9}\n.dark .ct-d62beb{color:#A5D6FF}\n.dark .ct-752f26{color:#79C0FF}\n.dark .ct-c029aa{color:#FF7B72}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"신규-설치","depth":2,"text":"신규 설치"},{"id":"기존-환경에-패치","depth":2,"text":"기존 환경에 패치"},{"id":"윈도우11은-주의","depth":2,"text":"윈도우11은 주의"}]}},"_type":"markdown","_id":"content:other:wsl2에서 pid 1을 systemd로 변경하기.md","_source":"content","_file":"other/wsl2에서 pid 1을 systemd로 변경하기.md","_extension":"md"}