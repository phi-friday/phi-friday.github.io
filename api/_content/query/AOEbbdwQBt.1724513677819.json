{"_path":"/python/airflow2","_dir":"python","_draft":false,"_partial":false,"_locale":"","title":"airflow에서 간단하게 Task를 스킵하는 방법","description":"TaskFlow API를 사용한다면, `skip_if`와 `run_if`를 사용하자","tags":["python","airflow"],"date":"2024-08-09T08:40:32.711Z","publish":true,"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"airflow-210의-신기능-skip_if-run_if"},"children":[{"type":"text","value":"airflow 2.10의 신기능 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"skip_if"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"run_if"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"최근 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"skip_if"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"run_if"}]},{"type":"text","value":"에 대한 pr을 요청했고, 여러 검토를 거쳐서 수락됐다.\n직접 작성하기도 했고, 2.10 출시와 함께 곧 사용 가능할 예정이므로,\n이와 관련하여 간략하게 글을 작성하기로 했다."}]},{"type":"element","tag":"h3","props":{"id":"skip_if란"},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"skip_if"}]},{"type":"text","value":"란"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"skip_if"}]},{"type":"text","value":"는 조건을 만족할 때, 지정한 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"를 스킵하도록 하는 데코레이터다.\n사용 예시는 다음과 같다."}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes github-light github-dark","code":"@task.skip_if(lambda context: context[\"task_instance\"].task_id == \"skip\")\n@task.bash()\ndef echo() -> str:\n    return \"echo 'run'\"\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"@task.skip_if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"lambda"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" context: context["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"task_instance\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"].task_id "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"skip\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"@task.bash"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" echo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"echo 'run'\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Context"}]},{"type":"text","value":"를 사용할 수 있으므로,\n현재 실행중인 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"DagRun"}]},{"type":"text","value":" 또는 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"TaskInstance"}]},{"type":"text","value":"등을 참조하여 조건문을 실행할 수 있다."}]},{"type":"element","tag":"h3","props":{"id":"run_if란"},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"run_if"}]},{"type":"text","value":"란"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"run_if"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"skip_if"}]},{"type":"text","value":"와 동일한 방식으로 사용하며,\n조건을 만족하는 경우에만 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"를 실행하도록 한다.\n사용 예시는 다음과 같다."}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes github-light github-dark","code":"@task.run_if(lambda context: context[\"task_instance\"].task_id == \"run\")\n@task.bash()\ndef echo() -> str:\n    return \"echo 'run'\"\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"@task.run_if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"lambda"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" context: context["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"task_instance\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"].task_id "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"run\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"@task.bash"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" echo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"echo 'run'\"\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"taskflow-api가-아닌-경우"},"children":[{"type":"text","value":"TaskFlow API가 아닌 경우"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"skip_if"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"run_if"}]},{"type":"text","value":"는 TaskFlow API에서만 사용 할 수 있다.\n그렇지 않을 경우 에러가 발생하도록 작성했다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이 기능은 신기능이긴 하지만, 특수한 기능이라기 보다는 단순한 문법 설탕에 가깝기 때문이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Operator"}]},{"type":"text","value":"의 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pre_execute"}]},{"type":"text","value":"를 사용하여 구현하였으니,\nTaskFlow API가 아니라면, "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pre_execute"}]},{"type":"text","value":"를 사용하여 직접 구현 할 수 있다."}]},{"type":"element","tag":"h2","props":{"id":"마치며"},"children":[{"type":"text","value":"마치며"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"airflow"}]},{"type":"text","value":"같은 거대한 프로젝트에 신기능을 추가하는 pr이 수락된 경험은 처음이다.\n이번 pr을 통과시키며 느낀 점이지만, 거대한 커뮤니티를 가진 프로젝트인 만큼, 굉장히 탄탄한 프로세스를 가지고 있는 것 같다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이렇게 유지관리가 잘 되고, 빠른 속도로 발전하는 것을 보면, 특별한 문제가 없다면 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"airflow"}]},{"type":"text","value":"를 계속 사용하지 않을까."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"airflow-210의-신기능-skip_if-run_if","depth":2,"text":"airflow 2.10의 신기능 skip_if, run_if","children":[{"id":"skip_if란","depth":3,"text":"skip_if란"},{"id":"run_if란","depth":3,"text":"run_if란"},{"id":"taskflow-api가-아닌-경우","depth":3,"text":"TaskFlow API가 아닌 경우"}]},{"id":"마치며","depth":2,"text":"마치며"}]}},"_type":"markdown","_id":"content:python:airflow2.md","_source":"content","_file":"python/airflow2.md","_extension":"md"}