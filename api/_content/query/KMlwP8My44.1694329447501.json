{"_path":"/python/async","_dir":"python","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"python의 비동기에 대한 얕은 이해","description":"코드 중심으로 알아보는 비동기","tags":["python","async"],"date":"2023-07-31T09:51:28.303Z","publish":true,"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"파이썬의-비동기-라이브러리-asyncio"},"children":[{"type":"text","value":"파이썬의 비동기 라이브러리 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"파이썬에서 비동기를 객체를 생성하는 가장 간단한 방법은 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"키워드를 사용하는 것이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이를 위해 기본 라이브러리로 제공되는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"를 사용하자."}]},{"type":"element","tag":"code","props":{"code":"import asyncio\n\n\nasync def test() -> None:\n    await asyncio.sleep(1)\n\n\nasync def main() -> None:\n    await test()\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n","filename":"main.py","language":"python","meta":"[main.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" test()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"동기 함수와는 다르게 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.run"}]},{"type":"text","value":"함수로 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main()"}]},{"type":"text","value":" 코루틴을 실행하는 형태로 구성된다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"정말로 비동기로 작동하는지 확인하기 위해, 다음과 같이 새로 작성한 코드를 실행해보자."}]},{"type":"element","tag":"code","props":{"code":"import asyncio\nimport logging\nimport random\nimport sys\n\nlogger = logging.getLogger()\nlogger.setLevel(logging.INFO)\nlogger.addHandler(logging.StreamHandler(sys.stdout))\n\n\nasync def test(x: int) -> None:\n    logger.info(\"start: %d\", x)\n    await asyncio.sleep(random.random())\n    logger.info(\"end: %d\", x)\n\n\nasync def main() -> None:\n    await asyncio.gather(*(test(x) for x in range(10)))\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n","filename":"main2.py","language":"python","meta":"[main2.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" random"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" sys"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging.getLogger()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.setLevel(logging."}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"INFO"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.addHandler(logging.StreamHandler(sys.stdout))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(x: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":") -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"start: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"%d"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":", x)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep(random.random())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"%d"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":", x)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.gather("}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(test(x) "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" x "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"여기서 사용된 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.gather"}]},{"type":"text","value":"는 여러개의 코루틴을 동시에 대기할 수 있도록 한다."}]},{"type":"element","tag":"alert","props":{"type":"info"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.11부터는 TaskGroup을 사용할 것을 권장한다."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"위 스크립트를 실행하면, 다음과 같이 비동기로 실행되는 것을 확인할 수 있다."}]},{"type":"element","tag":"code","props":{"code":"❯ poetry run python main2.py\nstart: 0\nstart: 1\nstart: 2\nstart: 3\nstart: 4\nstart: 5\nstart: 6\nstart: 7\nstart: 8\nstart: 9\nend: 9\nend: 8\nend: 6\nend: 3\nend: 4\nend: 0\nend: 1\nend: 2\nend: 5\nend: 7\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"❯"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"poetry"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"python"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"main2.py"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"0"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"2"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"3"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"4"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"5"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"6"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"7"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"8"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"start:"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"9"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"9"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"8"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"6"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"3"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"4"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"0"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"2"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"5"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"end: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"7"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"왜-asynciorun을-실행해야-하는가"},"children":[{"type":"text","value":"왜 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.run"}]},{"type":"text","value":"을 실행해야 하는가"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asnyc"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":" 키워드를 사용한 함수가 실행되면, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Coroutine"}]},{"type":"text","value":"(이하 코루틴)객체가 생성된다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"코루틴은 생성과 동시에 실행되는 객체가 아니며,\n이벤트 루프에 예약된 상태도 아니다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이러한 코루틴을 실행하기 위해 이벤트루프를 생성하고,\n이벤트루프에 작업을 예약하고,\n이벤트루트의 작업을 순차적으로 실행하는 일련의 과정을\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.run"}]},{"type":"text","value":"이 담당한다고 볼 수있다."}]},{"type":"element","tag":"h2","props":{"id":"대기할-수-있는-awaitable객체"},"children":[{"type":"text","value":"대기할 수 있는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Awaitable"}]},{"type":"text","value":"객체"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"코루틴이 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"키워드를 사용하여 대기할 수 있는 이유는,\n코루틴에 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"__await__"}]},{"type":"text","value":"이라는 메소드가 정의되어 있기 때문이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이러한 객체를 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Awaitable"}]},{"type":"text","value":" 객체라고 하며, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"typing"}]},{"type":"text","value":" 모듈에서도 확인할 수 있다.\n정말 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"__await__"}]},{"type":"text","value":"만 있으면 가능한지 확인해보자."}]},{"type":"element","tag":"code","props":{"code":"import asyncio\nfrom typing import Any, Generator\n\n\nclass Await:\n    def __await__(self) -> Generator[Any, None, int]:\n        for num in range(5):\n            print(num)\n            yield None\n        return 1\n\n\nasync def main() -> None:\n    await Await()\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n\n# ❯ poetry run python main3.py\n# 0\n# 1\n# 2\n# 3\n# 4\n","filename":"main3.py","language":"python","meta":"[main3.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" typing "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" Any, Generator"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"Await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__await__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(self) -> Generator[Any, "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"]:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" num "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"):"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"print"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(num)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" Await()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# ❯ poetry run python main3.py"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# 0"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# 1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# 2"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# 3"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# 4"}]}]}]}]}]},{"type":"element","tag":"alert-outer","props":{"type":"info"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Await"}]},{"type":"text","value":"객체를 곧바로 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.run"}]},{"type":"text","value":"에서 사용하지 않고,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"함수에서 생성하여 사용하는 이유는,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.run"}]},{"type":"text","value":"에서 코루틴이 아니면 에러를 발생시키기 때문이다."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"즉, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"은 사실 제너레이터를 활용한\n컨텍스트 스위칭에 대한 문법 설탕이라는 것을 알 수 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이러한 문법 설탕이 추가되기 전까지는,\n제너레이터 문법인 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"yield from"}]},{"type":"text","value":"을 사용했다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"물론 이러한 사실은 알면 좋지만 별로 중요하지 않다.\n대부분의 경우 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"__await__"}]},{"type":"text","value":"를 직접 정의하기는 커녕\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"도 구경하기 어려우며,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"을 사용한 코루틴만 사용할 것이다."}]},{"type":"element","tag":"h3","props":{"id":"콜백-형태의-future"},"children":[{"type":"text","value":"콜백 형태의 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"의 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"concurrent.futures"}]},{"type":"text","value":"의 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"를 본따 만들어졌다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"concurrent.futures"}]},{"type":"text","value":"의 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"는 쓰레드를 제어하기 위해 만들어졌고,\n멀티쓰레드 환경의 비동기 제어가 싱글쓰레드 환경으로 확장된 것으로 볼 수도 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"앞서 말했듯이, 대부분의 경우 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"에 대해 알 필요가 없고,\n구버전 파이썬을 사용한다면 모를까, 이제는 사용할 일도 없는 객체다."}]},{"type":"element","tag":"h3","props":{"id":"future를-상속받는-task"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"를 상속받는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"를 상속받아 구현한 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Awaitable"}]},{"type":"text","value":"한 객체다.\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"js"}]},{"type":"text","value":"의 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":"처럼, 생성됐다면 이미 이벤트루프에 예약된 상태다."}]},{"type":"element","tag":"alert","props":{"type":"info"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"는 생성했지만, 이벤트루프에 예약되어 있지 않을 수 있다."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"따라서 다음과 같은 코드는, 정상적으로 실행된다."}]},{"type":"element","tag":"code","props":{"code":"import asyncio\nimport logging\nimport sys\n\nlogger = logging.getLogger()\nlogger.setLevel(logging.INFO)\nlogger.addHandler(logging.StreamHandler(sys.stdout))\n\n\nasync def test() -> None:\n    logger.info(\"start\")\n    await asyncio.sleep(1)\n    logger.info(\"done!\")\n\n\nasync def main() -> None:\n    coro = test()\n    _ = asyncio.create_task(coro)\n    logger.info(\"before sleep\")\n    await asyncio.sleep(2)\n    logger.info(\"after sleep\")\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n#  ❯ poetry run python main4.py\n#  before sleep\n#  start\n#  done!\n#  after sleep\n","filename":"main4.py","language":"python","meta":"[main4.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" sys"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging.getLogger()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.setLevel(logging."}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"INFO"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.addHandler(logging.StreamHandler(sys.stdout))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"start\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"done!\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    coro "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" test()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    _ "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.create_task(coro)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"before sleep\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"after sleep\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"#  ❯ poetry run python main4.py"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"#  before sleep"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"#  start"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"#  done!"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"#  after sleep"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":" 또는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"yield from"}]},{"type":"text","value":" 또는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"__await__"}]},{"type":"text","value":"메소드를 직업 호출하지 않았지만,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"로 정의된 비동기 함수는 정상적으로 실행됐다.\n왜냐하면 신규 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"객체를 생성했고,\n이후 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await asyncio.sleep(2)"}]},{"type":"text","value":"를 통해 콘텍스트 스위칭을 유발했기 때문이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"정리하자면 다음과 같다."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"함수를 실행하여 코루틴을 생성한다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"생성한 코루틴을 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.create_task"}]},{"type":"text","value":"함수를 사용하여, 이벤트루프에 예약한다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"create_task"}]},{"type":"text","value":"함수가 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"객체를 반환한다.(의도적으로 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"_"}]},{"type":"text","value":"를 사용하여 무시하였다.)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"아직 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"함수가 콘텍스트를 점유중이므로, 앞서 생성한 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 실행되지 않았다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await asyncio.sleep(2)"}]},{"type":"text","value":"를 통해, 콘텍스트 점유를 해제한다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"앞서 생성한 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"로 콘텍스트가 변경된다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"이하 생략"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"즉, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"이 콘텍스트 스위칭에 대한 문법 설탕이자,\n동시에 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"를 생성하는 문법 설탕인 것을 알 수 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"여기서 한가지 궁금한 점이 생긴다."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"한번 생성한 코루틴은, 한번만 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"으로 대기할 수 있다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"한번 생성한 코루틴은, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"를 생성할 수 있다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Awaitable"}]},{"type":"text","value":"이므로 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"으로 대기할 수 있다."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이전의 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main4.py"}]},{"type":"text","value":" 스크립트에서 코루틴 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"coro"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"create_task"}]},{"type":"text","value":"함수를 통해\n이미 실행된 상태다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이후 생성한 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"를 대기하는 것이 가능할까?"}]},{"type":"element","tag":"code","props":{"code":"import asyncio\nimport logging\nimport sys\n\nlogger = logging.getLogger()\nlogger.setLevel(logging.INFO)\nlogger.addHandler(logging.StreamHandler(sys.stdout))\n\n\nasync def test() -> int:\n    logger.info(\"start\")\n    await asyncio.sleep(1)\n    logger.info(\"done!\")\n    return 1\n\n\nasync def main() -> None:\n    coro = test()\n    task = asyncio.create_task(coro)\n\n    logger.info(\"before sleep\")\n\n    queue = asyncio.Queue(1)\n    task.add_done_callback(lambda task: queue.put_nowait(task.result()))\n\n    value = await task\n\n    logger.info(\"after sleep\")\n\n    result = task.result()\n    queue_value = await queue.get()\n    logger.info(\"value=%r, result=%r, queue_value=%r\", value, result, queue_value)\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n# ❯ poetry run python main5.py\n# before sleep\n# start\n# done!\n# after sleep\n# value=1, result=1, queue_value=1\n","filename":"main5.py","language":"python","meta":"[main5.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" sys"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging.getLogger()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.setLevel(logging."}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"INFO"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.addHandler(logging.StreamHandler(sys.stdout))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"start\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"done!\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    coro "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" test()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    task "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.create_task(coro)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"before sleep\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    queue "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.Queue("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    task.add_done_callback("}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"lambda"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" task: queue.put_nowait(task.result()))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    value "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" task"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"after sleep\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    result "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" task.result()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    queue_value "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" queue.get()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"value="}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"%r"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":", result="}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"%r"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":", queue_value="}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"%r"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":", value, result, queue_value)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# ❯ poetry run python main5.py"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# before sleep"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# start"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# done!"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# after sleep"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# value=1, result=1, queue_value=1"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"가능하다. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 코루틴을 이벤트 루프에 예약하는 객체지, 코루틴 그 자체가 아니기 때문이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"그렇기에 단 한번 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"으로 대기할 수 있다.\n동시에 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"이기에, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"result"}]},{"type":"text","value":" 메소드를 사용하여 값을 가져올 수도 있으며\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"add_done_callback"}]},{"type":"text","value":" 메소드를 사용하여, 콜백을 추가할 수도 있다."}]},{"type":"element","tag":"h2","props":{"id":"future와-task는-언제-사용할까"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 언제 사용할까"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":" 또는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 대부분의 경우 직접 사용할 일이 없다.\n하지만 저수준 api를 다뤄야 하거나, 효율적인 코드를 목표로 한다면,\n필연적으로 다뤄야 하는 순간이 온다."}]},{"type":"element","tag":"h3","props":{"id":"task가-필요한-상황"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"가 필요한 상황"}]},{"type":"element","tag":"code","props":{"code":"from __future__ import annotations\n\nimport asyncio\nimport random\nfrom typing import Awaitable\n\n\nasync def test(value: int) -> int:\n    mod = value % 10\n    rand = random.randint(1, 10)\n    await asyncio.sleep(1)\n    if mod > rand:\n        error_msg = f\"mod > {rand}\"\n        raise ValueError(error_msg)\n    return mod\n\n\nasync def shield(coro: Awaitable[int]) -> int | None:\n    try:\n        return await asyncio.shield(coro)\n    except ValueError:\n        return None\n\n\nasync def main() -> None:\n    coros = [test(int(random.random() * 100)) for _ in range(10)]\n    result = await asyncio.gather(*(shield(coro) for coro in coros))\n    print(result)\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n# ❯ poetry run python main6.py\n# [2, 1, None, 2, None, 3, 8, 2, 3, None]\n","filename":"main6.py","language":"python","meta":"[main6.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__future__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" annotations"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" random"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" typing "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" Awaitable"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(value: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":") -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    mod "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" value "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"%"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    rand "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" random.randint("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" mod "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" rand:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        error_msg "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"f"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"mod > "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"rand"}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\""}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"raise"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"ValueError"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(error_msg)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" mod"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"shield"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(coro: Awaitable["}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"]) -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.shield(coro)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"except"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"ValueError"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    coros "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" [test("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(random.random() "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"100"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")) "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" _ "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")]"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    result "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.gather("}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(shield(coro) "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" coro "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" coros))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"print"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(result)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# ❯ poetry run python main6.py"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# [2, 1, None, 2, None, 3, 8, 2, 3, None]"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"위와 같은 상황이 있을 때,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"함수에서 에러가 발생하면 None값이 아닌 -1을 반환받고 싶다고 하자."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"가장 간단한 방법은 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"shield"}]},{"type":"text","value":"를 수정하는 것이고,\n그 다음으로는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"를 수정하는 것이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"하지만 위 스크립트는 굉장히 간단하게 작성된 스크립트라 그런 것이고,\n손대면 손댈수록 너무 복잡해져서 수정하기 힘들거나,\n특수한 사정으로 인해 수정 자체가 불가능한 경우가 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"그럴때 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"에 콜백을 추가하여 문제를 해결할 수 있다."}]},{"type":"element","tag":"code","props":{"code":"from __future__ import annotations\n\nimport asyncio\nimport random\nfrom collections import deque\nfrom functools import partial\nfrom typing import Awaitable\n\n\nasync def test(value: int) -> int:\n    mod = value % 10\n    rand = random.randint(1, 10)\n    await asyncio.sleep(1)\n    if mod > rand:\n        error_msg = f\"mod > {rand}\"\n        raise ValueError(error_msg)\n    return mod\n\n\nasync def shield(coro: Awaitable[int]) -> int | None:\n    try:\n        return await asyncio.shield(coro)\n    except ValueError:\n        return None\n\n\ndef add(task: asyncio.Task[int], queue: asyncio.Queue[int]) -> None:\n    if task.exception():\n        queue.put_nowait(-1)\n        return\n    queue.put_nowait(task.result())\n\n\nasync def main() -> None:\n    queue = asyncio.Queue()\n    add_in_queue = partial(add, queue=queue)\n    coros = [test(int(random.random() * 100)) for _ in range(10)]\n    tasks = deque()\n    for coro in coros:\n        task = asyncio.create_task(coro)\n        task.add_done_callback(add_in_queue)\n        tasks.append(task)\n\n    await asyncio.gather(*(shield(task) for task in tasks))\n    result = [queue.get_nowait() for _ in range(10)]\n    print(result)\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n# ❯ poetry run python main6-2.py\n# [0, -1, 2, -1, 3, 1, 8, -1, -1, -1]\n","filename":"main6-2.py","language":"python","meta":"[main6-2.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__future__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" annotations"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" random"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" collections "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" deque"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" functools "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" partial"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" typing "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" Awaitable"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(value: "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":") -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    mod "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" value "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"%"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    rand "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" random.randint("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" mod "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" rand:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        error_msg "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"f"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"mod > "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"rand"}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\""}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"raise"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"ValueError"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(error_msg)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" mod"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"shield"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(coro: Awaitable["}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"]) -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.shield(coro)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"except"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"ValueError"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(task: asyncio.Task["}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"], queue: asyncio.Queue["}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"]) -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" task.exception():"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        queue.put_nowait("}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    queue.put_nowait(task.result())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    queue "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.Queue()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    add_in_queue "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" partial(add, "}]},{"type":"element","tag":"span","props":{"class":"ct-ff220a"},"children":[{"type":"text","value":"queue"}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"queue)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    coros "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" [test("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(random.random() "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"100"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")) "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" _ "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")]"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    tasks "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" deque()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" coro "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" coros:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        task "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.create_task(coro)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        task.add_done_callback(add_in_queue)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        tasks.append(task)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.gather("}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(shield(task) "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" task "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" tasks))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    result "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" [queue.get_nowait() "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" _ "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")]"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"print"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(result)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# ❯ poetry run python main6-2.py"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# [0, -1, 2, -1, 3, 1, 8, -1, -1, -1]"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"핵심 로직이라 할 수 있는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"shield"}]},{"type":"text","value":"를 수정하지 않고,\n콜백을 사용하여 문제를 해결할 수 있다."}]},{"type":"element","tag":"h3","props":{"id":"future가-필요한-상황"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"가 필요한 상황"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"가 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"를 상속받았기에, 대부분의 경우 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"에서 문제가 해결된다.\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"의 결정적인 차이점은\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"는 이벤트루프에 예약되지 않은 상태가 존재한다는 것이다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"코루틴이 비동기 작업에 대한 정의라면\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 코루틴의 실재이고,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"의 선물이다.\n따라서 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"를 사용한다면, 비동기 작업이 선언 또는 실행되기 이전에\n콜백을 정의하고 추가하여 제공할 수 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이러한 방법은 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"의 내부 함수를 구현하는데 많이 사용되는데,\n그 중 하나인 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wait_for"}]},{"type":"text","value":"를 좀 더 알아보기 쉽게 나타내면 다음과 같다."}]},{"type":"element","tag":"code","props":{"code":"from __future__ import annotations\n\nimport asyncio\nimport logging\nimport sys\nfrom functools import partial\nfrom typing import Any, Awaitable\n\nlogger = logging.getLogger()\nlogger.setLevel(logging.INFO)\nlogger.addHandler(logging.StreamHandler(sys.stdout))\n\n\ndef release(waiter: asyncio.Future[Any], *args: Any) -> None:\n    if not waiter.done():\n        waiter.set_result(None)\n\n\nasync def cancel(future: asyncio.Future[Any]) -> None:\n    loop = asyncio.get_running_loop()\n    waiter = loop.create_future()\n    callback = partial(release, waiter)\n    future.add_done_callback(callback)\n\n    try:\n        future.cancel()\n        await waiter\n    finally:\n        future.remove_done_callback(callback)\n\n\nasync def wait_for(coro: Awaitable[Any]) -> None:\n    logger.info(\"wait\")\n\n    loop = asyncio.get_running_loop()\n    waiter = loop.create_future()\n    callback = partial(release, waiter)\n    future = asyncio.ensure_future(coro)\n    future.add_done_callback(callback)\n\n    try:\n        await waiter\n    except asyncio.CancelledError:\n        if future.done():\n            return\n        future.remove_done_callback(callback)\n        await cancel(future)\n        raise\n\n    if not future.done():\n        future.remove_done_callback(callback)\n        await cancel(future)\n        raise RuntimeError\n\n\nasync def test() -> None:\n    logger.info(\"start\")\n    await asyncio.sleep(3)\n    logger.info(\"end\")\n\n\nasync def main() -> None:\n    coro = test()\n    task = asyncio.create_task(coro)\n    await asyncio.gather(task, wait_for(task), wait_for(task), wait_for(task))\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n# ❯ poetry run python main7.py\n# start\n# wait\n# wait\n# wait\n# end\n","filename":"main7.py","language":"python","meta":"[main7.py]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__future__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" annotations"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" sys"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" functools "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" partial"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" typing "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" Any, Awaitable"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" logging.getLogger()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.setLevel(logging."}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"INFO"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"logger.addHandler(logging.StreamHandler(sys.stdout))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"release"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(waiter: asyncio.Future[Any], "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"args: Any) -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"not"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" waiter.done():"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        waiter.set_result("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"cancel"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(future: asyncio.Future[Any]) -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    loop "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.get_running_loop()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    waiter "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" loop.create_future()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    callback "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" partial(release, waiter)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    future.add_done_callback(callback)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        future.cancel()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" waiter"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"finally"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        future.remove_done_callback(callback)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"wait_for"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"(coro: Awaitable[Any]) -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"wait\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    loop "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.get_running_loop()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    waiter "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" loop.create_future()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    callback "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" partial(release, waiter)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    future "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.ensure_future(coro)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    future.add_done_callback(callback)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" waiter"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"except"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.CancelledError:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" future.done():"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"return"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        future.remove_done_callback(callback)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" cancel(future)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"raise"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"not"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" future.done():"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        future.remove_done_callback(callback)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" cancel(future)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"raise"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"RuntimeError"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"start\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.sleep("}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    logger.info("}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"end\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f62a22"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"() -> "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    coro "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" test()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    task "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.create_task(coro)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" asyncio.gather(task, wait_for(task), wait_for(task), wait_for(task))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0ff764"},"children":[{"type":"text","value":"__name__"}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64600b"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f46ebe"},"children":[{"type":"text","value":"\"__main__\""}]},{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-faa0c5"},"children":[{"type":"text","value":"    asyncio.run(main())"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# ❯ poetry run python main7.py"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# start"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# wait"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# wait"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# wait"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e7e9d2"},"children":[{"type":"text","value":"# end"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wait_for"}]},{"type":"text","value":"의 실제 구현은 더 정교하지만, 읽기 쉽도록 일부 코드를 수정했다.\n위와 같은 형태로 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wait_for"}]},{"type":"text","value":"를 사용하지 않는다면, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"task"}]},{"type":"text","value":"를 2번 이상 실행하게 되고,\n동일한 코루틴을 2번 이상 실행할 수 없다는 에러가 발생한다."}]},{"type":"element","tag":"h2","props":{"id":"요약하자면"},"children":[{"type":"text","value":"요약하자면"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":" 키워드로 비동기 함수를 정의하여 코루틴을 생성하고,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio.run"}]},{"type":"text","value":"으로 실행한다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"js"}]},{"type":"text","value":"의 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":"와 비슷한 객체는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"를 사용하면 콜백을 활용할 수 있다."}]}]},{"type":"element","tag":"h3","props":{"id":"추가하자면"},"children":[{"type":"text","value":"추가하자면"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"기본 라이브러리인 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":" 위주로 작성된 글이지만,\n비동기 라이브러리는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"만이 있는 것은 아니다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"twisted"}]},{"type":"text","value":"나 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"curio"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"trio"}]},{"type":"text","value":"등이 있으며,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"trio"}]},{"type":"text","value":"의 로직을 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"에 적용한 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"anyio"}]},{"type":"text","value":"도 있다."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"anyio"}]},{"type":"text","value":"를 사용하면 비동기 로직 구현 후,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"trio"}]},{"type":"text","value":"중 어떤 것이든 선택하여 사용할 수 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2.x에서는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"curio"}]},{"type":"text","value":"도 지원했지만,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"curio"}]},{"type":"text","value":"의 구현 방식에 따른 개발에 어려움이 있어서 3.x부터 제외됐다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"twisted"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"anyio"}]},{"type":"text","value":"에서 사용하는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sniffio"}]},{"type":"text","value":"에서 지원하지 않아서\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"anyio"}]},{"type":"text","value":"에서도 지원하지 않는다."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"모든 라이브러리는 코루틴에 대해서는 공유하지만,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Future"}]},{"type":"text","value":"와 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Task"}]},{"type":"text","value":"는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"에 정의된 객체이므로,\n따로 정의한 객체를 사용할 수 있다.\n따라서 만약 다른 라이브러리를 사용한다면,\n그 라이브러리에 맞는 방법을 잘 알아보고 사용해야 한다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"나는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"anyio"}]},{"type":"text","value":"를 주로 사용하는데,\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"TaskGroup"}]},{"type":"text","value":"과 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CancelScope"}]},{"type":"text","value":"가 마음에 들었기 때문이다.\n특히 이 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"TaskGroup"}]},{"type":"text","value":"은 3.11부터는 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":"에 적용된 개념이기도 하니,\n만약 3.11이상의 버전을 사용한다면 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"gather"}]},{"type":"text","value":" 대신 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"TaskGroup"}]},{"type":"text","value":"을 사용하자."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"왜 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"TaskGroup"}]},{"type":"text","value":"이 좋은지, 왜 사용해야 하는지는\n"},{"type":"element","tag":"a","props":{"href":"https://blog.lablup.com/posts/2022/03/29/PersistentTaskGroup/","rel":["nofollow"]},"children":[{"type":"text","value":"이 글"}]},{"type":"text","value":"에서 상세하게 설명해준다."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-e7e9d2{color:#6E7781}\n.ct-ff220a{color:#953800}\n.ct-f46ebe{color:#0A3069}\n.ct-0ff764{color:#0550AE}\n.ct-f62a22{color:#8250DF}\n.ct-faa0c5{color:#24292F}\n.ct-64600b{color:#CF222E}\n.dark .ct-64600b{color:#FF7B72}\n.dark .ct-faa0c5{color:#C9D1D9}\n.dark .ct-f62a22{color:#D2A8FF}\n.dark .ct-0ff764{color:#79C0FF}\n.dark .ct-f46ebe{color:#A5D6FF}\n.dark .ct-ff220a{color:#FFA657}\n.dark .ct-e7e9d2{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"파이썬의-비동기-라이브러리-asyncio","depth":2,"text":"파이썬의 비동기 라이브러리 asyncio","children":[{"id":"왜-asynciorun을-실행해야-하는가","depth":3,"text":"왜 asyncio.run을 실행해야 하는가"}]},{"id":"대기할-수-있는-awaitable객체","depth":2,"text":"대기할 수 있는 Awaitable객체","children":[{"id":"콜백-형태의-future","depth":3,"text":"콜백 형태의 Future"},{"id":"future를-상속받는-task","depth":3,"text":"Future를 상속받는 Task"}]},{"id":"future와-task는-언제-사용할까","depth":2,"text":"Future와 Task는 언제 사용할까","children":[{"id":"task가-필요한-상황","depth":3,"text":"Task가 필요한 상황"},{"id":"future가-필요한-상황","depth":3,"text":"Future가 필요한 상황"}]},{"id":"요약하자면","depth":2,"text":"요약하자면","children":[{"id":"추가하자면","depth":3,"text":"추가하자면"}]}]}},"_type":"markdown","_id":"content:python:async.md","_source":"content","_file":"python/async.md","_extension":"md"}