{"_path":"/other/pypi-trusted-publisher","_dir":"other","_draft":false,"_partial":false,"_locale":"","title":"Github Action과 Trusted Publisher를 사용한 파이썬 패키지 배포 자동화","description":"배포 자동화를 조금 더 안전하게","tags":["python","pypi","Trusted Publisher"],"date":"2024-09-02T05:43:47.545Z","publish":true,"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"패키지-배포는-어렵지-않다"},"children":[{"type":"text","value":"패키지 배포는 어렵지 않다"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"파이썬 패키지를 배포하는 것은 굉장히 간단하다.\n"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pyproject.toml"}]},{"type":"text","value":"에 적합한 메타 데이터만 잘 입력되어 있다면,\n다음 명령어로 빌드와 배포를 할 수 있다."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"$ python -m build\n$ python -m twine upload dist/* --non-interactive --username __token__ --password <pypi 토큰>\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" python"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -m"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" python"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -m"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" twine"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" upload"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" dist/"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --non-interactive"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --username"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" __token__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --password"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"pypi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" 토"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"큰"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"하지만 보안상 아쉬운 부분이 있는데, 바로 토큰 발행과 보관이다.\n보통 배포를 위한 토큰은 한번 발행하고 오래 사용하게 되는데,\n만약 그 토큰이 제 3자에게 노출된다면, 이는 굉장한 보안 위협으로 다가올 수 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이를 해결하기 위해 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pypi"}]},{"type":"text","value":"에서 제시하는 방법은 "},{"type":"element","tag":"a","props":{"href":"https://openid.net/connect/","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"OIDC"}]}]},{"type":"text","value":"를 사용하는 것이며,\n이때 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pypi"}]},{"type":"text","value":"에서 사용하는 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"OIDC"}]},{"type":"text","value":"를 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Trusted Publisher"}]},{"type":"text","value":"라고 한다."}]},{"type":"element","tag":"h2","props":{"id":"trusted-publisher를-사용하는-방법"},"children":[{"type":"text","value":"Trusted Publisher를 사용하는 방법"}]},{"type":"element","tag":"h3","props":{"id":"_1-trusted-publisher-설정"},"children":[{"type":"text","value":"1. Trusted Publisher 설정"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이미 배포된 적 있는 패키지라면 다음 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pypi"}]},{"type":"text","value":" 설정 화면에서 현재 사용중인 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"CI"}]},{"type":"text","value":" 서비스를 추가할 수 있다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"settings-0","src":"/images/other/pypi-trusted-publisher/pypi-trusted-publisher-0.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"settings-1","src":"/images/other/pypi-trusted-publisher/pypi-trusted-publisher-1.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://docs.pypi.org/trusted-publishers/","rel":["nofollow"]},"children":[{"type":"text","value":"공식 문서"}]},{"type":"text","value":"에 굉장히 상세하게 작성되어 있으므로, 더 알아보고 싶다면 공식 문서를 확인하면 된다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"신규 프로젝트를 생성하면서 "},{"type":"element","tag":"a","props":{"href":"https://docs.pypi.org/trusted-publishers/creating-a-project-through-oidc/","rel":["nofollow"]},"children":[{"type":"text","value":"함께 적용"}]},{"type":"text","value":"할 수도 있다."}]},{"type":"element","tag":"h3","props":{"id":"_2-trusted-publisher-적용"},"children":[{"type":"text","value":"2. Trusted Publisher 적용"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Trusted Publisher"}]},{"type":"text","value":"로 지정한 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"CI"}]},{"type":"text","value":"서비스에서 토큰을 발행하여 배포가 가능하도록 수정해야한다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Github Action"}]},{"type":"text","value":"의 경우 다음과 같은 항목을 추가하면 된다."}]},{"type":"element","tag":"pre","props":{"className":"language-yaml shiki shiki-themes github-light github-dark","code":"# 생략\njobs:\n  publish:\n    # 생략\n    environment: # Trusted Publisher 설정에서 지정한 환경(지정하지 않았다면 생략)\n    permissions:\n      id-token: write # 필수\n\n    steps:\n      # 빌드 과정 생략(필수)\n      - name: Publish package distributions to PyPI\n        uses: pypa/gh-action-pypi-publish@release/v1\n","language":"yaml","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# 생략\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  publish"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    # 생략\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    environment"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# Trusted Publisher 설정에서 지정한 환경(지정하지 않았다면 생략)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    permissions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      id-token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"write"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":" # 필수\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    steps"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"      # 빌드 과정 생략(필수)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Publish package distributions to PyPI\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        uses"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"pypa/gh-action-pypi-publish@release/v1\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"빌드 과정은 다른 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"step"}]},{"type":"text","value":"에서 이미 실행이 되어 있어야 하며,\n빌드 결과물은 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dist/*"}]},{"type":"text","value":" 하위 경로에 있어야 한다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이 설정만으로 토큰 발행부터 배포, 토큰 말소까지 자동으로 진행된다."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"패키지-배포는-어렵지-않다","depth":2,"text":"패키지 배포는 어렵지 않다"},{"id":"trusted-publisher를-사용하는-방법","depth":2,"text":"Trusted Publisher를 사용하는 방법","children":[{"id":"_1-trusted-publisher-설정","depth":3,"text":"1. Trusted Publisher 설정"},{"id":"_2-trusted-publisher-적용","depth":3,"text":"2. Trusted Publisher 적용"}]}]}},"_type":"markdown","_id":"content:other:pypi-trusted-publisher.md","_source":"content","_file":"other/pypi-trusted-publisher.md","_stem":"other/pypi-trusted-publisher","_extension":"md"}