const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CLwVkRoh.js","./entry.4uPfcvK_.css","./B3BTRj2M.js","./ByCLuGj7.js","./6QC3LxT-.js","./BqB4qWRx.js","./w7tsP3IZ.js","./DMnvl1Tm.js","./y84pF9wB.js","./header.Bvq2yFZ7.css","./BtkwSMtQ.js","./body.BtuWHAZE.css","./BdqzWlNb.js","./C4TqD77C.js","./footer.Dsvu2t9t.css","./Cw4dhq_N.js","./RAiF-tRO.js"])))=>i.map(i=>d[i]);
import{c as O,d as A,u as B,a as $,r as v,w as j,b as q,e as F,f as k,g as d,h as p,i as w,j as m,k as M,F as N,l as H,o as h,m as W,n as a,_ as i,p as U}from"./CLwVkRoh.js";import{_ as G}from"./ByCLuGj7.js";import{u as J}from"./6QC3LxT-.js";import{g as K}from"./BqB4qWRx.js";import{u as Q,q as P}from"./w7tsP3IZ.js";import{p as X,v as Y}from"./y84pF9wB.js";function Z(t,e=500){if(!t)throw O({statusCode:Math.floor(e),statusMessage:`invaild article type: ${typeof t}`});return t}const tt=/\d{4}-[01]{1}\d{1}-[0-3]{1}\d{1}/,et=t=>{var e;return t=(e=t.match(tt))==null?void 0:e.at(0)},b=A({id:"current_url",state:()=>({route_path:null}),getters:{path:t=>X(t.route_path||""),prefix:t=>{var e;return"/"+(((e=t.route_path)==null?void 0:e.split("/").at(1))??"")}},actions:{sync_route(){const{path:t}=B();this.route_path=t},validate_url(t){Y(t,this.path)}}}),g=["h1","h2","h3","h4","h5"],z=(t,e)=>e?(e.endsWith("/")||(e=e+"/"),t?e.startsWith("/")?t+e:t+"/"+e:e):"",L=t=>t.map(e=>{let n=[e];if(e.children){const r=L(e.children);n=[e,...r]}return n}).flat(1),V=t=>{if(!t.children)return[];let e=[];for(const n of t.children){if(n.type==="text"){e=[...e,n.value];continue}e=[...e,...V(n)]}return e},nt=A({id:"current_article",state:()=>({nullable_article:null,prev:null,next:null,active_toc_ids:new Set}),getters:{article:t=>Z(t.nullable_article),date:t=>{var e;return et(((e=t.nullable_article)==null?void 0:e.date)||"")},title:t=>{var e;return((e=t.nullable_article)==null?void 0:e.title)||""},tags:t=>{var e;return((e=t.nullable_article)==null?void 0:e.tags)||[]},description:t=>{var e;return((e=t.nullable_article)==null?void 0:e.description)||""},prev_path:t=>{var n;const e=b();return z(e.prefix,(n=t.prev)==null?void 0:n._path)},next_path:t=>{var n;const e=b();return z(e.prefix,(n=t.next)==null?void 0:n._path)},toc_tags:()=>g,toc_links:t=>{var e;return((e=t.nullable_article)==null?void 0:e.body.children.filter(n=>g.indexOf(n.tag??"")>=0).map(n=>{var r;return{id:(r=n.props)==null?void 0:r.id,depth:g.indexOf(n.tag??"")+1,text:V(n).join("")}}))??[]},active_toc_ids_array:t=>[...t.active_toc_ids],flatten_toc_links:()=>L},actions:{set_article(t){this.nullable_article=t||null,this.active_toc_ids.clear()},set_prev(t){this.prev=t||null},set_next(t){this.next=t||null},sync_article(t){this.set_article(t==null?void 0:t.article)},sync_surround(t){var e,n;this.set_prev((e=t==null?void 0:t.surround)==null?void 0:e[0]),this.set_next((n=t==null?void 0:t.surround)==null?void 0:n[1])},set_active_toc_id(t){this.active_toc_ids.clear(),this.active_toc_ids.add(t.id)}}}),rt=a(()=>i(()=>import("./CLwVkRoh.js").then(t=>t.au),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.default||t)),ot=a(()=>i(()=>import("./B3BTRj2M.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9]),import.meta.url).then(t=>t.default||t)),st=a(()=>i(()=>import("./BtkwSMtQ.js"),__vite__mapDeps([10,0,1,3,4,5,6,7,8,11]),import.meta.url).then(t=>t.default||t)),_t=a(()=>i(()=>import("./BdqzWlNb.js"),__vite__mapDeps([12,13,0,1,8,3,4,5,6,7,14]),import.meta.url).then(t=>t.default||t)),at=a(()=>i(()=>import("./Cw4dhq_N.js"),__vite__mapDeps([15,3,0,1,16]),import.meta.url).then(t=>t.default||t)),it={id:"main"},lt={key:1},ct={class:"article-main"},ut=$({__name:"[...slug]",async setup(t){let e,n;const r=H(),l=nt(),o=b(),f=v(null),C=v(null),R=J(C,{threshold:.1}),c=v(!1);j(R,s=>{console.info("show: %s, lock: %s",s,c.value),!c.value&&(c.value=s)}),o.sync_route(),o.validate_url(r.public.post_prefix);const E=K(),{data:y}=([e,n]=q(async()=>Q(`selected_data_with_surround_${o.path}`,async()=>{const s={},u=P(E).where({_path:o.path}).findOne().then(_=>s.article=_),x=P(E).only(["_path","title","description"]).findSurround(o.path).then(_=>s.surround=_);return await Promise.all([u,x]),s})),e=await e,n(),e);return y.value||(console.error("Article not found, path: %s",o.path),f.value=O({statusCode:404})),l.sync_article(y.value),l.sync_surround(y.value),F({title:`${r.public.name} - ${l.title}`,meta:[{hid:"description",name:"description",content:l.description}]}),(s,u)=>{const x=rt,_=ot,S=st,D=_t,I=at,T=G;return h(),k(N,null,[d("main",it,[p(f)?(h(),w(x,{key:0,error:p(f),path:p(o).path},null,8,["error","path"])):(h(),k("div",lt,[d("div",ct,[m(_),u[0]||(u[0]=d("hr",null,null,-1)),m(S),m(D)]),m(T,null,{default:M(()=>[p(c)?(h(),w(I,{key:0})):W("",!0)]),_:1})]))]),d("div",{ref_key:"comment_flag",ref:C},null,512)],64)}}}),dt=U(ut,[["__scopeId","data-v-e9b67573"]]),vt=Object.freeze(Object.defineProperty({__proto__:null,default:dt},Symbol.toStringTag,{value:"Module"}));export{vt as _,nt as u};
