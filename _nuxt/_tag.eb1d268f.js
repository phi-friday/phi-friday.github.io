import{a as z,$ as K,o as u,f as p,l as x,y as B,i as e,E as $,u as s,F as A,D as T,L as D,b as y,ay as I,ah as Q,r as N,H as M,N as P,ai as U,az as X,p as F,e as H,aw as O,al as Y,P as Z,ap as tt,S as et,aq as at,a6 as st,aA as nt}from"./entry.a909e591.js";import{_ as V}from"./one.vue.30cfe030.js";import{_ as ot}from"./pagination.cae65a1b.js";import{u as rt}from"./asyncData.33f0c997.js";import{g as lt}from"./query.f5aceab6.js";import{q as ct}from"./query.8ee6e2dd.js";import{r as it}from"./data_type.9bdab8d3.js";/* empty css                       */import"./utils.cc42cb99.js";const _t={class:"wrapper"},ut={class:"text-2xl font-semibold"},pt={class:"flex-wrap article-tags"},dt={class:"font-mono text-sm font-thin text-slate-400"},gt=z({__name:"item",props:{article:null,post_prefix:null,tag_prefix:null},setup(q){var w;const d=q,l=d.article,r=/\d{4}-[01]{1}\d{1}-[0-3]{1}\d{1}/;if(!r.test(l.date))throw K({statusCode:400,statusMessage:`invalid date string: ${l.date}`});const g=(w=l.date.match(r))==null?void 0:w.at(0),b=[...new Set(l.tags)].sort((n,i)=>n.localeCompare(i)),c=(n,i,f=void 0)=>{let o=f;return o||(i==="post"?o=d.post_prefix:o=d.tag_prefix),!n||!o?n??void 0:n.startsWith("/")?o+n:o+"/"+n};return(n,i)=>{const f=V,o=D;return u(),p("div",null,[x(o,{to:c(s(l)._path,"post")},{default:B(()=>[e("div",_t,[e("header",null,[e("h1",ut,$(s(l).title),1),e("p",null,$(s(l).description),1),e("ul",pt,[(u(!0),p(A,null,T(s(b),(a,m)=>(u(),p("div",{key:m},[x(f,{tag:a,add_tag:!0},null,8,["tag"])]))),128))]),e("p",dt," created at: "+$(s(g)),1)])])]),_:1},8,["to"])])}}}),ft={class:"mb-2"},mt={class:"flex row-span-1 row-start-1 gap-x-2"},vt=e("span",null," Reset",-1),xt=e("span",null,"Tags",-1),ht=z({__name:"select",props:{tag_data:null},setup(q){const d=q,l=H(),r=(o,a=void 0)=>o.map(h=>{let _=h;return h[a]&&(_=r(h[a])),_}).flat(1),g=()=>{O(new Set)},b=y(()=>{const o=I();return[...new Set(r(d.tag_data,"tags"))].filter(a=>typeof a=="string").map(a=>[a,o.value.get(a)??0]).sort((a,m)=>a[1]===m[1]?a[0].localeCompare(m[0]):m[1]>a[1]?1:-1)}),c=Q(),w=()=>{Y(!c.value,c)},n=N(),i=N(),f=()=>{var o,a;c.value?(o=n.value)==null||o.appendChild(i.value):(a=n.value)==null||a.removeChild(i.value)};return M(()=>f()),P(()=>c.value,()=>f()),(o,a)=>{const m=D,h=V;return u(),p(A,null,[e("div",ft,[e("div",mt,[e("div",{class:"cta w-icon",onClick:g},[x(m,{to:`${s(l).public.tag_prefix}`},{default:B(()=>[x(s(U),{class:"icon solid"}),vt]),_:1},8,["to"])]),e("button",{onClick:w,class:"cta w-icon"},[x(s(X),{class:"icon solid"}),xt])])]),e("div",{class:F(["tag-list",{active:s(c)}]),ref_key:"tag_parent_ref",ref:n},[e("ul",{class:"flex flex-wrap article-tags",ref_key:"tag_ref",ref:i},[(u(!0),p(A,null,T(s(b),([_,C],S)=>(u(),p("div",{key:S},[x(h,{class:"font-semibold",tag:_,count:C,add_tag:!0},null,8,["tag","count"])]))),128))],512)],2)],64)}}}),yt={class:"page-heading"},wt={class:"wrapper"},kt={class:"text-5xl font-extrabold"},bt={class:"page-section"},$t={key:0,class:"article-list"},qt={key:1},Bt=z({__name:"@tag",async setup(q){let d,l;const r=Z(),g=H(),b=()=>{let t;return!r.query.page||Array.isArray(r.query.page)?t=1:t=Number(r.query.page),t||(t=1),t},c=g.public.default_limit,w=()=>{const t=b();return g.public.default_skip+c*(t-1)},n=N(),i=()=>{n.value=w()};i();const f=tt(),o=y(()=>[...f.value].sort((t,v)=>t.localeCompare(v))),a=lt(),{data:m}=([d,l]=et(()=>rt("maybe_tagged_data",()=>ct(a).only(["title","description","tags","_path","date"]).skip(g.public.default_skip).find())),d=await d,l(),d),h=it(m),_=y(()=>h.value.filter(t=>{var v;return(v=t.tags)==null?void 0:v.length})),C=y(()=>I().value.size>0),S=()=>{if(C.value)return;const t=new Map;_.value.forEach(v=>{v.tags.forEach(k=>{t.set(k,(t.get(k)??0)+1)})}),nt(t)},E=y(()=>{S();const t=f.value;return t.size===0?_.value.slice(n.value,n.value+c):_.value.filter(v=>[...new Set(v.tags)].filter(k=>t.has(k)).length==t.size).slice(n.value,n.value+c)});M(()=>{if(r.query.select&&!Array.isArray(r.query.select)){for(const t of _.value)if(t.tags&&t.tags.includes(r.query.select)){O(new Set([r.query.select]));break}}}),P(()=>r.query,()=>{i()});const W=at(),j=y(()=>`All tagged posts: ${W.value}`),L=y(()=>{if(f.value.size>0)return`Selected tags: ${o.value}`});return st({title:`${g.public.name} - All tagged posts`,meta:[{hid:"description",name:"description",content:"All posts with tags"}]}),(t,v)=>{const k=ht,G=gt,J=ot;return u(),p("main",null,[e("header",yt,[e("div",wt,[e("h1",kt,$(s(j)),1),e("p",{class:F(["text-lg font-medium",{"text-transparent":s(L)===null}])},$(s(L)||"â €"),3)])]),e("div",null,[e("section",bt,[x(k,{tag_data:s(_)},null,8,["tag_data"]),s(E).length>0?(u(),p("ul",$t,[(u(!0),p(A,null,T(s(E),R=>(u(),p("li",{key:R._path,class:"article-item"},[x(G,{article:R,post_prefix:s(g).public.post_prefix,tag_prefix:s(g).public.tag_prefix},null,8,["article","post_prefix","tag_prefix"])]))),128))])):(u(),p("p",qt,"No articles found."))]),x(J,{count_data:s(_),how:"tag"},null,8,["count_data"])])])}}});export{Bt as default};
