const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AkLkSB23.js","./entry.4uPfcvK_.css","./H7yg4poA.js","./Cbjf8FdJ.js","./DuYGsJhg.js","./BqB4qWRx.js","./DJDzQ3lG.js","./tF6KBZ20.js","./CifCdGcD.js","./header.Bvq2yFZ7.css","./C90svcNT.js","./body.BtuWHAZE.css","./BtQFg3s8.js","./B5dy3Bo6.js","./footer.Dsvu2t9t.css","./BfDZF6lL.js","./ppsPqNWM.js"])))=>i.map(i=>d[i]);
import{c as A,d as L,u as B,a as j,r as v,b as F,w as M,e as P,f as N,g as k,h as d,i as p,j as w,k as m,l as H,F as W,m as U,o as h,n as G,p as a,_ as i,q as J}from"./AkLkSB23.js";import{_ as K}from"./Cbjf8FdJ.js";import{u as Q}from"./DuYGsJhg.js";import{g as X}from"./BqB4qWRx.js";import{u as Y,q as z}from"./DJDzQ3lG.js";import{p as Z,v as tt}from"./CifCdGcD.js";function et(t,e=500){if(!t)throw A({statusCode:Math.floor(e),statusMessage:`invaild article type: ${typeof t}`});return t}const nt=/\d{4}-[01]{1}\d{1}-[0-3]{1}\d{1}/,rt=t=>{var e;return t=(e=t.match(nt))==null?void 0:e.at(0)},b=L({id:"current_url",state:()=>({route_path:null}),getters:{path:t=>Z(t.route_path||""),prefix:t=>{var e;return"/"+(((e=t.route_path)==null?void 0:e.split("/").at(1))??"")}},actions:{sync_route(){const{path:t}=B();this.route_path=t},validate_url(t){tt(t,this.path)}}}),g=["h1","h2","h3","h4","h5"],O=(t,e)=>e?(e.endsWith("/")||(e=e+"/"),t?e.startsWith("/")?t+e:t+"/"+e:e):"",V=t=>t.map(e=>{let n=[e];if(e.children){const r=V(e.children);n=[e,...r]}return n}).flat(1),R=t=>{if(!t.children)return[];let e=[];for(const n of t.children){if(n.type==="text"){e=[...e,n.value];continue}e=[...e,...R(n)]}return e},ot=L({id:"current_article",state:()=>({nullable_article:null,prev:null,next:null,active_toc_ids:new Set}),getters:{article:t=>et(t.nullable_article),date:t=>{var e;return rt(((e=t.nullable_article)==null?void 0:e.date)||"")},title:t=>{var e;return((e=t.nullable_article)==null?void 0:e.title)||""},tags:t=>{var e;return((e=t.nullable_article)==null?void 0:e.tags)||[]},description:t=>{var e;return((e=t.nullable_article)==null?void 0:e.description)||""},prev_path:t=>{var n;const e=b();return O(e.prefix,(n=t.prev)==null?void 0:n._path)},next_path:t=>{var n;const e=b();return O(e.prefix,(n=t.next)==null?void 0:n._path)},toc_tags:()=>g,toc_links:t=>{var e;return((e=t.nullable_article)==null?void 0:e.body.children.filter(n=>g.indexOf(n.tag??"")>=0).map(n=>{var r;return{id:(r=n.props)==null?void 0:r.id,depth:g.indexOf(n.tag??"")+1,text:R(n).join("")}}))??[]},active_toc_ids_array:t=>[...t.active_toc_ids],flatten_toc_links:()=>V},actions:{set_article(t){this.nullable_article=t||null,this.active_toc_ids.clear()},set_prev(t){this.prev=t||null},set_next(t){this.next=t||null},sync_article(t){this.set_article(t==null?void 0:t.article)},sync_surround(t){var e,n;this.set_prev((e=t==null?void 0:t.surround)==null?void 0:e[0]),this.set_next((n=t==null?void 0:t.surround)==null?void 0:n[1])},set_active_toc_id(t){this.active_toc_ids.clear(),this.active_toc_ids.add(t.id)}}}),st=a(()=>i(()=>import("./AkLkSB23.js").then(t=>t.au),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.default||t)),_t=a(()=>i(()=>import("./H7yg4poA.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9]),import.meta.url).then(t=>t.default||t)),at=a(()=>i(()=>import("./C90svcNT.js"),__vite__mapDeps([10,0,1,3,4,5,6,7,8,11]),import.meta.url).then(t=>t.default||t)),it=a(()=>i(()=>import("./BtQFg3s8.js"),__vite__mapDeps([12,13,0,1,8,3,4,5,6,7,14]),import.meta.url).then(t=>t.default||t)),lt=a(()=>i(()=>import("./BfDZF6lL.js"),__vite__mapDeps([15,3,0,1,16]),import.meta.url).then(t=>t.default||t)),ct={id:"main"},ut={key:1},dt={class:"article-main"},pt=j({__name:"[...slug]",async setup(t){let e,n;const r=U(),l=ot(),o=b(),f=v(null),C=v(null),S=Q(C,{threshold:.1}),c=v(!1),D=F();o.sync_route(),o.validate_url(r.public.post_prefix);const E=X(),{data:y}=([e,n]=M(async()=>Y(`selected_data_with_surround_${o.path}`,async()=>{const s={},u=z(E).where({_path:o.path}).findOne().then(_=>s.article=_),x=z(E).only(["_path","title","description"]).findSurround(o.path).then(_=>s.surround=_);return await Promise.all([u,x]),s})),e=await e,n(),e);return y.value||(console.error("Article not found, path: %s",o.path),f.value=A({statusCode:404})),l.sync_article(y.value),l.sync_surround(y.value),P(S,s=>{c.value||(c.value=s)}),P(()=>D.path,()=>{c.value=!1}),N({title:`${r.public.name} - ${l.title}`,meta:[{hid:"description",name:"description",content:l.description}]}),(s,u)=>{const x=st,_=_t,I=at,T=it,$=lt,q=K;return h(),k(W,null,[d("main",ct,[p(f)?(h(),w(x,{key:0,error:p(f),path:p(o).path},null,8,["error","path"])):(h(),k("div",ut,[d("div",dt,[m(_),u[0]||(u[0]=d("hr",null,null,-1)),m(I),m(T)]),m(q,null,{default:H(()=>[p(c)?(h(),w($,{key:0})):G("",!0)]),_:1})]))]),d("div",{ref_key:"comment_flag",ref:C},null,512)],64)}}}),mt=J(pt,[["__scopeId","data-v-23ed9311"]]),bt=Object.freeze(Object.defineProperty({__proto__:null,default:mt},Symbol.toStringTag,{value:"Module"}));export{bt as _,ot as u};
